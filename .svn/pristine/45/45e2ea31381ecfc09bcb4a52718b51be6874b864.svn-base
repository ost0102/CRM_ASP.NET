#CrmInvoiceMgt@DeleteData
--CrmInvoiceMgt@DeleteDataBEGIN INSERT INTO AC_CODE3_LOG@DL_YJITEXP (CUST                          ,COMN_CD                          ,AROC                          ,MODIFYGB                          ,INDIVIDUAL                          ,SINGLEPUB                          ,SDATE                          ,BILL_AMT                          ,BILL_VAT                          ,TAXDD                          ,DEPTCD                          ,PRJCD                          ,STANDARD_LIST                          ,RMK                          ,USERID                          ,USERDT                          ,UP_GB                          ,UPID                          ,UPDT)   SELECT CUST          ,COMN_CD          ,AROC          ,MODIFYGB          ,INDIVIDUAL          ,SINGLEPUB          ,SDATE          ,BILL_AMT          ,BILL_VAT          ,TAXDD          ,DEPTCD          ,PRJCD          ,STANDARD_LIST          ,RMK          ,USERID          ,USERDT          ,'U'          ,'@USR_ID'          ,TO_CHAR(SYSDATE,'YYYYMMDDhh24miss')     FROM AC_CODE3@DL_YJITEXP    WHERE CUST = '@DB_CUST'       AND COMN_CD = '@DB_COMN_CD'       AND AROC = '@DB_AROC';/* 2 */DELETE FROM AC_CODE3@DL_YJITEXP where CUST = '@DB_CUST' AND COMN_CD = '@DB_COMN_CD' AND AROC = '@DB_AROC';END;
#CrmInvoiceMgt@Print
--CrmInvoiceMgt@PrintSELECT TRIM(A.CUST ) AS CUST        ,TRIM(A.BILL_AMT ) AS BILL_AMT        ,TRIM(A.BILL_VAT ) AS BILL_VAT        ,TRIM(A.RMK) AS RMK         ,TRIM(B.FDESC) AS FDESC        ,TRIM(C.NAME2) AS CUST_LOC_NM    FROM AC_CODE3@DL_YJITEXP A,         CO_FREIGHT@DL_YJITEXP B,         CO_CUSTOMER@DL_YJITEXP C,         CO_PROJECT@DL_YJITEXP D   WHERE     A.CUST = '@CUST_CD'         AND A.AROC = B.FCODE(+)         AND A.CUST = C.CODE(+)         AND A.PRJCD = D.RFNO(+)ORDER BY INDIVIDUAL, SINGLEPUB, AROC
#CrmInvoiceMgt@PrintCertificate
--CrmInvoiceMgt@PrintCertificate   SELECT CODE        ,DAENM        ,NAME2     FROM CO_CUSTOMER@DL_YJITEXP     WHERE CODE = '@CUST_CD'
#CrmInvoiceMgt@SaveData
--CrmInvoiceMgt@SaveDataBEGININSERT INTO AC_CODE3_LOG@DL_YJITEXP (CUST                          ,COMN_CD                          ,AROC                          ,MODIFYGB                          ,INDIVIDUAL                          ,SINGLEPUB                          ,SDATE                          ,BILL_AMT                          ,BILL_VAT                          ,TAXDD                          ,DEPTCD                          ,PRJCD                          ,STANDARD_LIST                          ,RMK                          ,USERID                          ,USERDT                          ,UP_GB                          ,UPID                          ,UPDT)   SELECT CUST          ,COMN_CD          ,AROC          ,MODIFYGB          ,INDIVIDUAL          ,SINGLEPUB          ,SDATE          ,BILL_AMT          ,BILL_VAT          ,TAXDD          ,DEPTCD          ,PRJCD          ,STANDARD_LIST          ,RMK          ,USERID          ,USERDT          ,'U'          ,'@USR_ID'          ,TO_CHAR(SYSDATE,'YYYYMMDDhh24miss')     FROM AC_CODE3@DL_YJITEXP    WHERE CUST = '@DB_CUST'       AND COMN_CD = '@DB_COMN_CD'       AND AROC = '@DB_AROC'      AND ( AROC <> '@AROC'      OR PRJCD <> '@PRJCD'      OR SINGLEPUB <> '@SINGLEPUB'      OR BILL_AMT <> '@BILL_AMT'      OR BILL_VAT <> '@BILL_VAT');    /* 2 */DELETE FROM AC_CODE3@DL_YJITEXP where CUST = '@DB_CUST' AND COMN_CD = '@DB_COMN_CD' AND AROC = '@DB_AROC';/* 3 */ INSERT INTO AC_CODE3@DL_YJITEXP (CUST,                      COMN_CD,                      AROC,                      MODIFYGB,                      INDIVIDUAL,                      SINGLEPUB,                      SDATE,                      BILL_AMT,                      BILL_VAT,                      TAXDD,                      DEPTCD,                      PRJCD,                      STANDARD_LIST,                      RMK,                      USERID,                      USERDT)     VALUES ( '@CUST'             ,'@COMN_CD'             ,'@AROC'             ,'@MODIFYGB'             ,'@INDIVIDUAL'             ,'@SINGLEPUB'             ,'@SDATE'             ,NVL(@BILL_AMT,0)             ,NVL(@BILL_VAT,0)             ,'@TAXDD'             ,'@DEPTCD'             ,'@PRJCD'             ,'@STANDARD_LIST'             ,'@RMK'             ,'@USR_ID'             ,TO_CHAR(SYSDATE,'YYYYMMDD')             );END;
#CrmInvoiceMgt@Search
--CrmInvoiceMgt@SearchSELECT DD.CODE              ,C.CUST_CD       /*       ,C.CUST_NM        --,TAXADR       ,UFN_FORMAT(C.CRN ,'CRN') AS CRN       ,C.CUST_ADDR       ,C.CUST_LOC_NM       ,C.TEL_NO       ,C.FAX_NO       ,C.BIZ_TYPE       ,C.BIZ_COND       ,C.SALES_NM2       ,CUSTMEN       ,C.CEO */       --,UFN_FORMAT(CHDATE,0) AS CHDATE       ,UFN_FORMAT(CC.CHDATE,'DATE') AS CHDATE       ,DD.NAME2 as CUST_LOC_NM        ,UFN_FORMAT(CREDIT,0) AS CREDIT       ,DD.TAXADR AS CUST_ADDR       ,DD.DAENM AS CEO       ,DD.BSTYP AS BIZ_TYPE       ,DD.BSGOD AS BIZ_COND       ,DD.TELNO AS TEL_NO       ,DD.REGNO AS CRN       ,DD.CALLMEN          ,DD.POSSIBLE       ,DD.RECOVERY       ,DD.CUSTMEN        ,DD.FINALTEL       ,DD.FINALDT       ,DD.TALKLST       ,BB.TAXAMT       ,DD.ENDDT        ,X.TANM        ,X.E_MAIL AS EMAIL       ,SSALESNM  AS SALES_NM2       ,CC.CHDATE       ,CASE WHEN C.BANK_YN = 'N'             THEN 'No'             WHEN C.BANK_YN = 'Y'             THEN 'Yes'             ELSE ''             END AS BANK_YN        ,CASE WHEN C.BANK_TYPE = 'A'             THEN '계좌자동이체'             WHEN C.BANK_TYPE = 'B'             THEN '신용카드'             ELSE ''             END AS BANK_TYPE          ,CASE WHEN C.BANK_DAY IS NOT NULL             THEN BANK_DAY || '일'               ELSE ''             END AS BANK_DAY   FROM (  SELECT CUST                 , SUM (BILL_AMT + BILL_VAT) AS TAXAMT            FROM AC_CODE2@DL_YJITEXP           WHERE EDATE > '2018'              AND CUST = '@CUST_CD'        GROUP BY CUST) BB,       (SELECT  CHDATE               ,COCD               ,CREDIT          FROM AC_CHIT2@DL_YJITEXP         WHERE ACTCD = '1115'             AND CREDIT <> 0            AND RFNO || RFSEQ || SEQ IN                      (  SELECT MAX (RFNO || RFSEQ || SEQ)                           FROM AC_CHIT2@DL_YJITEXP                          WHERE     ACTCD = '1115'                            AND CREDIT <> 0                            AND COCD IN (SELECT COCD                                           FROM (  SELECT COCD                                                         ,SUM (DEBIT - CREDIT)AS AMT                                                     FROM AC_CHIT2@DL_YJITEXP                                                    WHERE ACTCD = '1115'                                                      AND COCD = '@CUST_CD'                                                 GROUP BY COCD)                                              WHERE AMT <> 0)                       GROUP BY COCD)) CC       ,CO_CUSTOMER@DL_YJITEXP DD       ,CO_SALES@DL_YJITEXP EE       ,CO_CUST2@DL_YJITEXP X        ,CRM_CUST_MST C WHERE     DD.CODE = BB.CUST(+)       AND DD.CODE = CC.COCD(+)       AND DD.CODE = X.CODE(+)       AND X.TASEQ = '01'        AND DD.CODE = '@CUST_CD'       AND DD.SALESCD = EE.SSALESCD(+)       AND C.CUST_CD  = TRIM(DD.CODE)
#CrmInvoiceMgt@SearchInv
 --CrmInvoiceMgt@SearchInv   SELECT 'N' AS CHK_FLAG   		,TRIM(A.CUST ) AS CUST		,TRIM(A.AROC ) AS AROC		,TRIM(A.INDIVIDUAL ) AS INDIVIDUAL		,TRIM(A.SINGLEPUB) AS SINGLEPUB 		,TRIM(A.SDATE) AS SDATE 		,TRIM(A.BILL_AMT ) AS BILL_AMT		,TRIM(A.BILL_VAT ) AS BILL_VAT		,TRIM(A.TAXDD) AS TAXDD 		,TRIM(A.DEPTCD ) AS DEPTCD		,TRIM(A.PRJCD) AS PRJCD 		,TRIM(A.RMK) AS RMK 		,TRIM(A.USERID ) AS USERID		,TRIM(A.USERDT ) AS USERDT		,TRIM(A.MODIFYGB ) AS MODIFYGB		,TRIM(A.COMN_CD) AS COMN_CD 		,TRIM(A.STANDARD_LIST) AS STANDARD_LIST          ,TRIM(B.FDESC) AS FDESC        ,TRIM(C.DEPTNM) AS DEPTNM        ,TRIM(D.TITLE) AS TITLE          ,(SELECT MAX(CD_NM)           FROM MDM_COM_CODE X          WHERE X.GRP_CD = 'C01'            AND X.COMN_CD = A.COMN_CD) AS COMN_NM 		,TRIM(A.CUST ) AS DB_CUST		,TRIM(A.AROC ) AS DB_AROC		,TRIM(A.COMN_CD) AS DB_COMN_CD     FROM AC_CODE3@DL_YJITEXP A,         CO_FREIGHT@DL_YJITEXP B,         CO_DEPT@DL_YJITEXP C,         CO_PROJECT@DL_YJITEXP D   WHERE     A.CUST = '@CUST_CD'         AND A.AROC = B.FCODE(+)         AND A.DEPTCD = C.DEPT(+)         AND A.PRJCD = D.RFNO(+)ORDER BY INDIVIDUAL, SINGLEPUB, AROC
#CrmInvoiceMgt@SearchService
--CrmInvoiceMgt@SearchServiceSELECT A.CUST_CD     , A.SEQ     , A.SVC_CD     , A.DEPT_CD     , A.SALES_NM     , A.CTRT_STRT_YMD     , A.CTRT_END_YMD     , A.TAX_AMT     , A.TAX_START_YMD     , A.RMK     , A.INS_USR     , TO_CHAR(A.INS_DATE,'YYYY-MM-DD hh24:mi:ss') AS INS_DATE     , A.UPD_USR     , TO_CHAR(A.UPD_DATE,'YYYY-MM-DD hh24:mi:ss') AS UPD_DATE  FROM CRM_CUST_SVC A       LEFT OUTER JOIN MDM_COM_CODE B               ON A.SVC_CD = B.COMN_CD              AND B.GRP_CD = 'C01' WHERE A.CUST_CD = '@CUST_CD' ORDER BY B.SORT 
#CrmInvoiceMgt@UpdateLog
 --CrmInvoiceMgt@UpdateLog SELECT A.*,         B.FDESC,         C.DEPTNM,         D.TITLE    FROM AC_CODE3_LOG@DL_YJITEXP A,         CO_FREIGHT@DL_YJITEXP B,         CO_DEPT@DL_YJITEXP C,         CO_PROJECT@DL_YJITEXP D   WHERE     A.CUST = '@CUST_CD'         AND A.AROC = B.FCODE(+)         AND A.DEPTCD = C.DEPT(+)         AND A.PRJCD = D.RFNO(+)ORDER BY A.UPDT DESC,         INDIVIDUAL,         SINGLEPUB,         AROC
#CrmInvoiceMgt@UpdateTaxInfo
  --CrmInvoiceMgt@UpdateTaxInfo   BEGIN   DELETE FROM CO_CUST2@DL_YJITEXP        WHERE CODE = '@CUST_CD'          AND TASEQ = '01';    INSERT INTO CO_CUST2@DL_YJITEXP        (   CODE          ,TASEQ          ,TANM          ,E_MAIL          ,TELNO          ,TAX_CK          ,USERID,USERDT        )     VALUES ( '@CUST_CD'             ,'01'             ,CASE WHEN '@TANM' = '' OR '@TANM' IS NULL                   THEN ' '                   ELSE '@TANM'              END              ,CASE WHEN '@E_MAIL' = '' OR '@E_MAIL' IS NULL                   THEN ' '                   ELSE '@E_MAIL'              END               ,CASE WHEN '@TELNO' = '' OR '@TELNO' IS NULL                   THEN ' '                   ELSE '@TELNO'              END              ,'@TAX_CK'              ,'@USR_ID'             ,TO_CHAR(sysdate, 'YYYYMMDD')          );            UPDATE CO_CUSTOMER@DL_YJITEXP     SET ENDDT = '@ENDDT'        ,ENDUSERID = '@USR_ID'        ,ENDUSERDT = TO_CHAR(SYSDATE, 'YYYYMMDDhh24miss')   WHERE CODE =  '@CUST_CD';     END;
#CrmInvoiceMgt@XmlSchema
<MAIN>SELECT '' AS CUST_LOC_NM     , 0 AS BILL_AMT     , 0 AS BILL_VAT     , '' AS RMK     , '' AS FDESC  FROM DUAL;
