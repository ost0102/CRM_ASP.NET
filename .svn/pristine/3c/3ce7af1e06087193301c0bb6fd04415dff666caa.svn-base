#CrmWBSMgt@Delete
--CrmWBSMgt@DeleteDELETE  FROM CRM_WBS_DTL WHERE MNGT_NO = '@MNGT_NO'   AND SEQ = '@SEQ'
#CrmWBSMgt@DeleteWBS
--CrmWBSMgt@DeleteWBSDELETE  FROM CRM_WBS_MST WHERE MNGT_NO = '@MNGT_NO'
#CrmWBSMgt@Save
--CrmWBSMgt@SaveMERGE INTO CRM_WBS_DTL DUSING (       SELECT '@MNGT_NO' AS MNGT_NO            , '@SEQ' AS SEQ            , '@GRP_CD' AS GRP_CD            , '@ACT_CD' AS ACT_CD            , '@JOB_TYPE' AS JOB_TYPE            , '@JOB_NM' AS JOB_NM            , '@LOC_CD' AS LOC_CD            , '@DEPT_CD' AS DEPT_CD            , '@DEPT_PIC_NM' AS DEPT_PIC_NM            , '@CUST_PIC_NM' AS CUST_PIC_NM            , '@PLAN_FM_YMD' AS PLAN_FM_YMD            , '@PLAN_TO_YMD' AS PLAN_TO_YMD            , '@PROC_FM_YMD' AS PROC_FM_YMD            , '@PROC_TO_YMD' AS PROC_TO_YMD            , '@WORK_RATE' AS WORK_RATE            , '@TEST_FM_YMD' AS TEST_FM_YMD            , '@TEST_TO_YMD' AS TEST_TO_YMD            , '@PROC_RATE' AS PROC_RATE            , '@RMK' AS RMK            , '@SORT_SEQ' AS SORT_SEQ            , '@SSN_USR_ID' AS INS_USR            , TO_CHAR(SYSDATE,'yyyyMMdd') AS INS_YMD            , TO_CHAR(SYSDATE,'HH24MISS') AS INS_HM            , '@SSN_USR_ID' AS UPD_USR            , TO_CHAR(SYSDATE,'yyyyMMdd') AS UPD_YMD            , TO_CHAR(SYSDATE,'HH24MISS') AS UPD_HM         FROM DUAL      ) S ON (D.MNGT_NO = S.MNGT_NO       	  AND D.SEQ = S.SEQ)WHEN MATCHED THEN     UPDATE         SET D.UPD_USR = S.UPD_USR          , D.UPD_YMD = S.UPD_YMD          , D.UPD_HM = S.UPD_HM       [GRP_CD], D.GRP_CD = S.GRP_CD[/GRP_CD]       [ACT_CD], D.ACT_CD = S.ACT_CD[/ACT_CD]       [JOB_TYPE], D.JOB_TYPE = S.JOB_TYPE[/JOB_TYPE]       [JOB_NM], D.JOB_NM = S.JOB_NM[/JOB_NM]       [LOC_CD], D.LOC_CD = S.LOC_CD[/LOC_CD]       [DEPT_CD], D.DEPT_CD = S.DEPT_CD[/DEPT_CD]       [DEPT_PIC_NM], D.DEPT_PIC_NM = S.DEPT_PIC_NM[/DEPT_PIC_NM]       [CUST_PIC_NM], D.CUST_PIC_NM = S.CUST_PIC_NM[/CUST_PIC_NM]       [PLAN_FM_YMD], D.PLAN_FM_YMD = S.PLAN_FM_YMD[/PLAN_FM_YMD]       [PLAN_TO_YMD], D.PLAN_TO_YMD = S.PLAN_TO_YMD[/PLAN_TO_YMD]       [PROC_FM_YMD], D.PROC_FM_YMD = S.PROC_FM_YMD[/PROC_FM_YMD]       [PROC_TO_YMD], D.PROC_TO_YMD = S.PROC_TO_YMD[/PROC_TO_YMD]       [WORK_RATE], D.WORK_RATE = TO_DATE(S.PROC_TO_YMD,'YYYYMMDD') - TO_DATE(S.PROC_FM_YMD,'YYYYMMDD') + 1[/WORK_RATE]       [TEST_FM_YMD], D.TEST_FM_YMD = S.TEST_FM_YMD[/TEST_FM_YMD]       [TEST_TO_YMD], D.TEST_TO_YMD = S.TEST_TO_YMD[/TEST_TO_YMD]       [PROC_RATE], D.PROC_RATE = S.PROC_RATE[/PROC_RATE]       [RMK], D.RMK = S.RMK[/RMK]       [SORT_SEQ], D.SORT_SEQ = S.SORT_SEQ[/SORT_SEQ]WHEN NOT MATCHED THEN     INSERT (         D.INS_USR, D.INS_YMD, D.INS_HM       , D.MNGT_NO       , D.SEQ       [GRP_CD], D.GRP_CD[/GRP_CD]       [ACT_CD], D.ACT_CD[/ACT_CD]
       [JOB_TYPE], D.JOB_TYPE[/JOB_TYPE]       [JOB_NM], D.JOB_NM[/JOB_NM]       [LOC_CD], D.LOC_CD[/LOC_CD]       [DEPT_CD], D.DEPT_CD[/DEPT_CD]       [DEPT_PIC_NM], D.DEPT_PIC_NM [/DEPT_PIC_NM]       [CUST_PIC_NM], D.CUST_PIC_NM [/CUST_PIC_NM]       [PLAN_FM_YMD], D.PLAN_FM_YMD [/PLAN_FM_YMD]       [PLAN_TO_YMD], D.PLAN_TO_YMD [/PLAN_TO_YMD]       [PROC_FM_YMD], D.PROC_FM_YMD [/PROC_FM_YMD]       [PROC_TO_YMD], D.PROC_TO_YMD [/PROC_TO_YMD]       [WORK_RATE], D.WORK_RATE [/WORK_RATE]       [TEST_FM_YMD], D.TEST_FM_YMD [/TEST_FM_YMD]       [TEST_TO_YMD], D.TEST_TO_YMD [/TEST_TO_YMD]       [PROC_RATE], D.PROC_RATE [/PROC_RATE]       [RMK], D.RMK [/RMK]       [SORT_SEQ], D.SORT_SEQ [/SORT_SEQ]     ) VALUES (         S.INS_USR, S.INS_YMD, S.INS_HM       , S.MNGT_NO       , (SELECT NVL(MAX(Z.SEQ),0)+1 FROM CRM_WBS_DTL Z WHERE Z.MNGT_NO = '@MNGT_NO')       [GRP_CD], S.GRP_CD[/GRP_CD]       [ACT_CD], S.ACT_CD[/ACT_CD]
       [JOB_TYPE], S.JOB_TYPE[/JOB_TYPE]       [JOB_NM], S.JOB_NM[/JOB_NM]       [LOC_CD], S.LOC_CD[/LOC_CD]       [DEPT_CD], S.DEPT_CD[/DEPT_CD]       [DEPT_PIC_NM], S.DEPT_PIC_NM [/DEPT_PIC_NM]       [CUST_PIC_NM], S.CUST_PIC_NM [/CUST_PIC_NM]       [PLAN_FM_YMD], S.PLAN_FM_YMD [/PLAN_FM_YMD]       [PLAN_TO_YMD], S.PLAN_TO_YMD [/PLAN_TO_YMD]       [PROC_FM_YMD], S.PROC_FM_YMD [/PROC_FM_YMD]       [PROC_TO_YMD], S.PROC_TO_YMD [/PROC_TO_YMD]       [WORK_RATE] ,  TO_DATE(S.PROC_TO_YMD,'YYYYMMDD') - TO_DATE(S.PROC_FM_YMD,'YYYYMMDD') + 1 [/WORK_RATE]       [TEST_FM_YMD], S.TEST_FM_YMD [/TEST_FM_YMD]       [TEST_TO_YMD], S.TEST_TO_YMD [/TEST_TO_YMD]       [PROC_RATE], S.PROC_RATE [/PROC_RATE]       [RMK], S.RMK [/RMK]       [SORT_SEQ], S.SORT_SEQ [/SORT_SEQ]     )  
#CrmWBSMgt@SaveWBS
--CrmWBSMgt@SaveWBSMERGE INTO CRM_WBS_MST DUSING (       SELECT '@MNGT_NO' AS MNGT_NO            , '@PROJECT_NM' AS PROJECT_NM            , '@USR_ID' AS USR_ID            , '@FM_YMD' AS FM_YMD            , '@TO_YMD' AS TO_YMD            , '@RMK' AS RMK            , '@SSN_USR_ID' AS INS_USR            , TO_CHAR(SYSDATE,'yyyyMMdd') AS INS_YMD            , TO_CHAR(SYSDATE,'HH24MISS') AS INS_HM            , '@SSN_USR_ID' AS UPD_USR            , TO_CHAR(SYSDATE,'yyyyMMdd') AS UPD_YMD            , TO_CHAR(SYSDATE,'HH24MISS') AS UPD_HM         FROM DUAL      ) S ON (D.MNGT_NO = S.MNGT_NO)WHEN MATCHED THEN     UPDATE         SET D.UPD_USR = S.UPD_USR          , D.UPD_YMD = S.UPD_YMD          , D.UPD_HM = S.UPD_HM       [PROJECT_NM], D.PROJECT_NM = S.PROJECT_NM[/PROJECT_NM]       [USR_ID], D.USR_ID = S.USR_ID[/USR_ID]       [FM_YMD], D.FM_YMD = S.FM_YMD[/FM_YMD]       [TO_YMD], D.TO_YMD = S.TO_YMD[/TO_YMD]       [PROC_RATE], D.PROC_RATE = S.PROC_RATE[/PROC_RATE]       [RMK], D.RMK = S.RMK[/RMK]WHEN NOT MATCHED THEN     INSERT (         D.INS_USR, D.INS_YMD, D.INS_HM       , D.MNGT_NO       [PROJECT_NM], D.PROJECT_NM[/PROJECT_NM]       [USR_ID], D.USR_ID[/USR_ID]       [FM_YMD], D.FM_YMD[/FM_YMD]       [TO_YMD], D.TO_YMD[/TO_YMD]       [PROC_RATE], D.PROC_RATE[/PROC_RATE]       [RMK], D.RMK [/RMK]     ) VALUES (         S.INS_USR, S.INS_YMD, S.INS_HM       , S.MNGT_NO       [PROJECT_NM], S.PROJECT_NM[/PROJECT_NM]       [USR_ID], S.USR_ID[/USR_ID]       [FM_YMD], S.FM_YMD[/FM_YMD]       [TO_YMD], S.TO_YMD[/TO_YMD]       [PROC_RATE], S.PROC_RATE[/PROC_RATE]       [RMK], S.RMK [/RMK]     )
#CrmWBSMgt@Search
--CrmWBSMgt@SearchSELECT A.MNGT_NO     , A.PROJECT_NM     , A.USR_ID     , A.FM_YMD     , A.TO_YMD     , A.PROC_RATE AS PROC_RATE     , A.RMK     , A.FM_YMD AS DB_FM_YMD     , (SELECT B.LOC_NM FROM CRM_USR_MST B WHERE B.USR_ID = A.INS_USR) AS INS_USR     , TO_CHAR(TO_DATE(A.INS_YMD,'YYYYMMDD'),'YYYY-MM-DD') || ' ' ||       TO_CHAR(TO_DATE(A.INS_HM,'HH24MISS'), 'HH24:MI:SS') AS INS_YMD     , (SELECT B.LOC_NM FROM CRM_USR_MST B WHERE B.USR_ID = A.UPD_USR) AS UPD_USR     , TO_CHAR(TO_DATE(A.UPD_YMD,'YYYYMMDD'),'YYYY-MM-DD') || ' ' ||       TO_CHAR(TO_DATE(A.UPD_HM,'HH24MISS'), 'HH24:MI:SS') AS UPD_YMD  FROM CRM_WBS_MST A WHERE 1 = 1 AND A.FM_YMD IS NOT NULL [DATE_TYPE_REG]     AND A.INS_YMD BETWEEN '@DATE_FM' AND '@DATE_TO' [/DATE_TYPE_REG] [DATE_TYPE_FM] 	 AND A.FM_YMD BETWEEN '@DATE_FM' AND '@DATE_TO' [/DATE_TYPE_FM] [DATE_TYPE_TO] 	 AND A.TO_YMD BETWEEN '@DATE_FM' AND '@DATE_TO' [/DATE_TYPE_TO] [DATE_TYPE_FT] 	AND (FM_YMD >= '@DATE_FM' OR FM_YMD <= '@DATE_TO') AND TO_YMD >= '@DATE_FM' AND FM_YMD <= '@DATE_TO' [/DATE_TYPE_FT] [SEARCH_KEY]   [SEARCH_TYPE_A]     AND (A.PROJECT_NM LIKE '%@SEARCH_KEY%'          OR A.INS_USR IN (SELECT Z.USR_ID FROM CRM_USR_MST Z WHERE LOC_NM LIKE '%@SEARCH_KEY%'))   [/SEARCH_TYPE_A]   [SEARCH_TYPE_T]     AND A.PROJECT_NM LIKE '%@SEARCH_KEY%'   [/SEARCH_TYPE_T]   [SEARCH_TYPE_U]     AND A.INS_USR IN (SELECT Z.USR_ID FROM CRM_USR_MST Z WHERE LOC_NM LIKE '%@SEARCH_KEY%')   [/SEARCH_TYPE_U] [/SEARCH_KEY] [COM_Y] 	AND A.PROC_RATE = 100 [/COM_Y] [COM_N] 	AND A.PROC_RATE <> 100 [/COM_N] [MNGT_NO]    AND MNGT_NO = '@MNGT_NO' [/MNGT_NO] [PROJECT_NM]    AND PROJECT_NM = '@PROJECT_NM' [/PROJECT_NM] [DEPT_CD]   [DEPT_TYPE_I]     --AND A.USR_ID IN (SELECT Z.USR_ID FROM CRM_USR_MST Z WHERE Z.DEPT_CD = '@DEPT_CD')     AND A.USR_ID IN (SELECT Z.LOC_NM FROM CRM_USR_MST Z WHERE Z.DEPT_CD = '@DEPT_CD')   [/DEPT_TYPE_I] [/DEPT_CD] ORDER BY A.MNGT_NO DESC
#CrmWBSMgt@SearchDetail
--CrmWBSMgt@SearchDetailSELECT 'N' AS CHK	 , A.MNGT_NO     , A.SEQ     , A.GRP_CD     , A.ACT_CD     , (SELECT B.CD_NM FROM MDM_COM_CODE B WHERE B.GRP_CD = 'W03' AND B.COMN_CD = A.ACT_CD AND ROWNUM = 1) AS ACT_NM     , A.JOB_TYPE     , A.JOB_NM     , A.LOC_CD     , A.DEPT_CD     , A.DEPT_PIC_NM     , A.CUST_PIC_NM     , A.PLAN_FM_YMD     , A.PLAN_TO_YMD     , A.PROC_FM_YMD     , A.PROC_TO_YMD     , A.WORK_RATE     , A.TEST_FM_YMD     , A.TEST_TO_YMD     , A.PROC_RATE     , A.SORT_SEQ     , A.RMK     --최대 최소 구하기      --, (SELECT LEAST(MIN(A.PLAN_FM_YMD),MIN(A.PROC_FM_YMD),MIN(A.TEST_FM_YMD)) FROM CRM_WBS_DTL A WHERE A.MNGT_NO = '@MNGT_NO') AS MIN_FM_YMD     --, (SELECT GREATEST(MAX(A.PLAN_TO_YMD),MAX(A.PROC_TO_YMD),MAX(A.TEST_TO_YMD)) FROM CRM_WBS_DTL A WHERE A.MNGT_NO = '@MNGT_NO') AS MAX_TO_YMD     , (SELECT B.LOC_NM FROM CRM_USR_MST B WHERE B.USR_ID = A.INS_USR) AS INS_USR     , TO_CHAR(TO_DATE(A.INS_YMD,'YYYYMMDD'),'YYYY-MM-DD') || ' ' ||       TO_CHAR(TO_DATE(A.INS_HM,'HH24MISS'), 'HH24:MI:SS') AS INS_YMD     , (SELECT B.LOC_NM FROM CRM_USR_MST B WHERE B.USR_ID = A.UPD_USR) AS UPD_USR     , TO_CHAR(TO_DATE(A.UPD_YMD,'YYYYMMDD'),'YYYY-MM-DD') || ' ' ||       TO_CHAR(TO_DATE(A.UPD_HM,'HH24MISS'), 'HH24:MI:SS') AS UPD_YMD  FROM CRM_WBS_DTL A WHERE 1 = 1 [MNGT_NO]   AND A.MNGT_NO = '@MNGT_NO' [/MNGT_NO] ORDER BY A.GRP_CD ASC,A.ACT_CD ASC,A.SORT_SEQ ASC, PLAN_FM_YMD, PLAN_TO_YMD
#CrmWBSMgt@SearchYMD
--CrmWBSMgt@SearchYMD  SELECT MAX(B.FM_YMD) AS FM_YMD     , MAX(B.TO_YMD) AS TO_YMD     , NVL(MIN(A.PLAN_FM_YMD),'0') AS PLAN_FM_YMD     , NVL(MAX(A.PLAN_TO_YMD),'0') AS PLAN_TO_YMD     , NVL(MIN(A.PROC_FM_YMD),'0') AS PROC_FM_YMD     , NVL(MAX(A.PROC_TO_YMD),'0') AS PROC_TO_YMD     , NVL(MIN(A.TEST_FM_YMD),'0') AS TEST_FM_YMD     , NVL(MAX(A.TEST_TO_YMD),'0') AS TEST_TO_YMD  FROM CRM_WBS_DTL A     , CRM_WBS_MST B  WHERE 1=1  AND B.MNGT_NO = '@MNGT_NO'  AND A.MNGT_NO(+) = B.MNGT_NO
#CrmWBSMgt@UpdateComRate
--CrmWBSMgt@UpdateComRate UPDATE CRM_WBS_MST    	SET PROC_RATE = (SELECT ROUND(SUM(C.PROC_RATE)/COUNT(*)*2,-1)/2 FROM CRM_WBS_DTL C WHERE C.MNGT_NO = '@MNGT_NO')  WHERE	MNGT_NO = '@MNGT_NO'
#CrmWBSMgt@UpdateYMD
--CrmWBSMgt@UpdateYMDBEGIN	UPDATE CRM_WBS_DTL	SET PLAN_FM_YMD = CASE	                  WHEN PLAN_FM_YMD IS NULL THEN NULL	                  ELSE TO_CHAR(TO_DATE(PLAN_FM_YMD,'yyyyMMdd') + '@FM_DAY','yyyymmdd')	                  END	  , PROC_FM_YMD = CASE	                  WHEN PROC_FM_YMD IS NULL THEN NULL	                  ELSE TO_CHAR(TO_DATE(PROC_FM_YMD,'yyyyMMdd') + '@FM_DAY','yyyymmdd')	                  END	  , TEST_FM_YMD = CASE	                  WHEN TEST_FM_YMD IS NULL THEN NULL	                  ELSE TO_CHAR(TO_DATE(TEST_FM_YMD,'yyyyMMdd') + '@FM_DAY','yyyymmdd')	                  END	  , PLAN_TO_YMD = CASE	                 WHEN PLAN_TO_YMD IS NULL THEN NULL	                 ELSE TO_CHAR(TO_DATE(PLAN_TO_YMD,'yyyyMMdd') + '@FM_DAY','yyyymmdd')	                 END	  , PROC_TO_YMD = CASE	                 WHEN PROC_TO_YMD IS NULL THEN NULL	                 ELSE TO_CHAR(TO_DATE(PROC_TO_YMD,'yyyyMMdd') + '@FM_DAY','yyyymmdd')	                 END	  , TEST_TO_YMD = CASE	                 WHEN TEST_TO_YMD IS NULL THEN NULL	                 ELSE TO_CHAR(TO_DATE(TEST_TO_YMD,'yyyyMMdd') + '@FM_DAY','yyyymmdd')	                 END	WHERE MNGT_NO = '@MNGT_NO';		UPDATE CRM_WBS_DTL	SET    WORK_RATE = CASE	                   WHEN PROC_FM_YMD IS NULL OR PROC_TO_YMD IS NULL THEN NULL	                   ELSE TO_DATE(PROC_TO_YMD,'yyyyMMdd') - TO_DATE(PROC_FM_YMD,'yyyyMMdd')+1	                   END	WHERE  MNGT_NO='@MNGT_NO';END;
