#EchAccountExcelUpDown@InsertAFR
-- EchAccountExcelUpDown@InsertAFRBEGIN	[AFR_CLEAR]		DELETE ECH_KL_AFR_ACC WHERE KEY_YM = '@DOC_YYYYMM';	[/AFR_CLEAR]		[INSERT_MOD]	INSERT INTO ECH_KL_AFR_ACC (	    KEY_YM, INV_YM, KL_AFR_ID, KL_CUST_NM, KL_BL_CNT, KL_4CODE, KL_ACC_AMT, KL_COMMISSION	  , CRM_CUST_CD, CRM_CUST_NM, CHAIN_BL_CNT	)	VALUES (	    '@DOC_YYYYMM', '@INV_YM', '@KLNET_ID', '@KLNET_CUST_NM', '@KL_HBL_COUNT', '@CUSTOMS_4CODE', @KLNET_ACC_AMT, '@KLNET_COMMISSION'	  , '@CUST_CD', '@CUST_LOC_NM', '@CHAIN_HBL_COUNT'	);	[/INSERT_MOD]	[UPDATE_MOD]	UPDATE ECH_KL_AFR_ACC SET				CRM_CUST_CD = '@CUST_CD'			,	CRM_CUST_NM = '@CUST_LOC_NM'			,	CHAIN_BL_CNT = '@CHAIN_HBL_COUNT'	 WHERE KEY_YM = '@DOC_YYYYMM'	   AND KL_AFR_ID = '@KLNET_ID';	[/UPDATE_MOD]END;
#EchAccountExcelUpDown@InsertMFCS
-- EchAccountExcelUpDown@InsertMFCSBEGIN	[MFCS_ACC_CLEAR]		DELETE ECH_KL_MFCS_TOT_ACC WHERE KEY_YM = '@DOC_YYYYMM';	[/MFCS_ACC_CLEAR]		[INSERT_MOD]		INSERT INTO ECH_KL_MFCS_TOT_ACC (			  KEY_YM, INV_YM, KL_SEND_ID, KL_RECV_ID, KL_DOC_NM, KL_SEND_RECV			, KL_TOT_SND_BYTE, KL_ACC_SND_BYTE, KL_ACC_AMT, KL_COMMISSION			, KL_REMARK, CHAIN_TOT_BYTE, KL_4CODE, CRM_CUST_CD, CRM_CUST_NM		) VALUES (			  '@DOC_YYYYMM'			, '@INV_YM'			, '@SND_ID'			, '@RECV_ID'			, '@DOC_NM'			, '@SEND_RECV'			,  @TOT_SND_BYTE			,  @ACC_SND_BYTE			,  @ACC_AMT			,  @COMMISSION			, '@REMARK'			,  @CHAIN_TOT_BYTE			, '@CUSTOMS_4CODE'			, '@CUST_CD'			, '@CUST_LOC_NM'		);	[/INSERT_MOD]		[UPDATE_MOD]		UPDATE ECH_KL_MFCS_TOT_ACC SET			 	CHAIN_TOT_BYTE = @CHAIN_TOT_BYTE			,	KL_TOT_SND_BYTE = @TOT_SND_BYTE			,	KL_ACC_SND_BYTE = @ACC_SND_BYTE			,	KL_ACC_AMT = @ACC_AMT			,	KL_COMMISSION = @COMMISSION			,	KL_REMARK = '@REMARK'			,   CRM_CUST_CD = '@CUST_CD'			,   CRM_CUST_NM = '@CUST_LOC_NM'			,   KL_4CODE = '@CUSTOMS_4CODE'	 	 WHERE KEY_YM = '@DOC_YYYYMM'	   	   AND KL_SEND_ID = '@SND_ID'	       AND KL_RECV_ID = '@RECV_ID'	       AND KL_DOC_NM = '@DOC_NM'	       AND KL_SEND_RECV = '@SEND_RECV';	[/UPDATE_MOD]END;
#EchAccountExcelUpDown@InsertUDR
--EchAccountExcelUpDown@InsertUDRBEGIN	[UDR_SELECT_CLEAR]		DELETE ECH_KL_MFCS_DETAIL_TMP WHERE KEY_YM = '@DOC_YYYYMM' AND INSERT_USER = '@USER_ID' ;	[/UDR_SELECT_CLEAR]		[UDR_SELECT_LST]		INSERT INTO ECH_KL_MFCS_DETAIL_TMP (				  KEY_YM, INV_YM, KL_4CODE, KL_SEND_ID, KL_RECV_ID, KL_THIS_IPM, KL_DOC_NM				, KL_DOC_BGM, KL_SEND_RECV, KL_SND_BYTE, KL_KEY_NO, SND_CK, KL_DOC_ITEM				, INSERT_USER, INSERT_YYYYMMDD		) 		VALUES (				  '@DOC_YYYYMM'				, '@INV_YM'				, '@CUSTOMS_4CODE'				, '@SND_ID'				, '@RECV_ID'				, '@THIS_IPM'				, '@DOC_NM'				, '@BGM'				, '@SND_RECV'				,  @SND_BYTE				, '@KEY_NO'				, 'Y'				, '@DOC_ITEM'				, '@USER_ID'				,  TO_CHAR(sysdate,'YYYYMMDD')				);	[/UDR_SELECT_LST]		[UDR_INSERT_CLEAR]		DELETE ECH_KL_MFCS_DETAIL_ACC WHERE KEY_YM = '@DOC_YYYYMM' ;	[/UDR_INSERT_CLEAR]		[INSERT_MOD]		INSERT INTO ECH_KL_MFCS_DETAIL_ACC (				  KEY_YM, INV_YM, KL_4CODE, KL_SEND_ID, KL_RECV_ID, KL_THIS_IPM, KL_DOC_NM				, KL_DOC_BGM, KL_SEND_RECV, KL_SND_BYTE, KL_KEY_NO, KL_DOC_ITEM				, CRM_CUST_CD, CRM_CUST_NM, CHAIN_SND_BYTE		) 		SELECT 				  KEY_YM, INV_YM, KL_4CODE, KL_SEND_ID, KL_RECV_ID, KL_THIS_IPM, KL_DOC_NM				, KL_DOC_BGM, KL_SEND_RECV, KL_SND_BYTE, KL_KEY_NO, KL_DOC_ITEM				, CRM_CUST_CD, CRM_CUST_NM, CHAIN_SND_BYTE		  FROM ECH_KL_MFCS_DETAIL_TMP		 WHERE KEY_YM = '@DOC_YYYYMM'		   AND INSERT_USER = '@USER_ID';			[/INSERT_MOD]		[UPDATE_MOD]		UPDATE ECH_KL_MFCS_DETAIL_ACC SET				CRM_CUST_CD = '@CUST_CD'			,	CRM_CUST_NM = '@CUST_LOC_NM'			,	CHAIN_SND_BYTE = @CHAIN_SND_BYTE			,	KL_4CODE = '@CUSTOMS_4CODE'			,	KL_SND_BYTE = @SND_BYTE			,	KL_KEY_NO = '@KEY_NO'	 	 WHERE KEY_YM = '@DOC_YYYYMM'	   	   AND KL_SEND_ID = '@SND_ID'	       AND KL_RECV_ID = '@RECV_ID'	       AND KL_THIS_IPM = '@THIS_IPM'	       AND KL_DOC_NM = '@DOC_NM';	[/UPDATE_MOD]END;
#EchAccountExcelUpDown@SearchAccount
--EchAccountExcelUpDown@SearchAccountSELECT        AC.INV_YMD     , AC.CUST_CD     , AC.CUST_NM     , SUM(AC.AFR_AMT)     AS AFR_AMT     , SUM(AC.MFCS_AMT)    AS MFCS_AMT     , AC.CRM_CUST_CD  FROM  (		SELECT 			   TO_CHAR(SYSDATE,'YYYYMM')||'20' AS INV_YMD			 , ERP.CUST_CD    		AS CUST_CD			 , A.KL_ACC_AMT 	AS AFR_AMT			 , 0 				AS MFCS_AMT			 , A.CRM_CUST_NM	AS CUST_NM			 , A.CRM_CUST_CD		  FROM ECH_KL_AFR_ACC A		  			LEFT OUTER JOIN CRM_CUST_MST C ON A.CRM_CUST_CD = C.CUST_CD AND C.USE_YN = 'Y'                      LEFT OUTER JOIN MDM_CUST_MST@DL_ELVIS ERP ON REPLACE(ERP.CRN,'-','') = C.CRN                                                                 AND ERP.CUST_CD = C.CUST_CD		 WHERE 1 = 1		   AND CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN A.KEY_YM 		 			ELSE A.INV_YM END >= '@S_STR_YM'		   [S_END_YM]		   		AND CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN A.KEY_YM 		 				 ELSE A.INV_YM END <= '@S_END_YM'		   [/S_END_YM]		   [S_CUST_CD]		   		AND A.CRM_CUST_CD = '@S_CUST_CD'		   [/S_CUST_CD]		   [S_CUST_NM]		   		AND A.CRM_CUST_NM LIKE '%@S_CUST_NM%'		   [/S_CUST_NM]		   [S_CUSTOMS_4CD]		   		AND A.KL_4CODE = '@S_CUSTOMS_4CD'		   [/S_CUSTOMS_4CD]				UNION ALL				SELECT 			   TO_CHAR(SYSDATE,'YYYYMM')||'20' AS INV_YMD			 , ERP.CUST_CD         AS CUST_CD			 , 0 				AS AFR_AMT			 , A.KL_ACC_AMT 	AS MFCS_AMT			 , A.CRM_CUST_NM			 , A.CRM_CUST_CD		  FROM ECH_KL_MFCS_TOT_ACC A		  			LEFT OUTER JOIN CRM_CUST_MST C ON A.CRM_CUST_CD = C.CUST_CD AND C.USE_YN = 'Y'                      LEFT OUTER JOIN MDM_CUST_MST@DL_ELVIS ERP ON REPLACE(ERP.CRN,'-','') = C.CRN                                                                 AND ERP.CUST_CD = C.CUST_CD		 WHERE 1 = 1		   AND CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN A.KEY_YM 		 			ELSE A.INV_YM END >= '@S_STR_YM'		   [S_END_YM]		   		AND CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN A.KEY_YM 		 				 ELSE A.INV_YM END <= '@S_END_YM'		   [/S_END_YM]		   [S_CUST_CD]		   		AND A.CRM_CUST_CD = '@S_CUST_CD'		   [/S_CUST_CD]		   [S_CUST_NM]		   		AND A.CRM_CUST_NM LIKE '%@S_CUST_NM%'		   [/S_CUST_NM]		   [S_CUSTOMS_4CD]		   		AND A.KL_4CODE = '@S_CUSTOMS_4CD'		   [/S_CUSTOMS_4CD]	) ACGROUP BY 	   AC.CUST_CD	 , AC.CUST_NM	 , AC.CRM_CUST_CD	 , AC.INV_YMDORDER BY 	   AC.CUST_CD	 , AC.CUST_NM	 , AC.CRM_CUST_CD	 , AC.INV_YMD
#EchAccountExcelUpDown@SearchAFR
--EchAccountExcelUpDown@SearchAFR[ECH_KL_AFR_ACC]-- Insert/Update 체크SELECT KEY_YM  FROM ECH_KL_AFR_ACC WHERE KEY_YM = '@DOC_YYYYMM'   --AND KL_AFR_ID = '@KLNET_ID'[/ECH_KL_AFR_ACC][SendData]-- CHAIN 전송건수 확인WITH T_HBL AS (    SELECT MAX(M_STXID) AS M_STXID, M_SHBL_NO      FROM ECH_SEASTAT_MST@ELVIS_CHAIN     WHERE M_SFORWARDERCODE = '@CUSTOMS_4CD'        AND M_STXID LIKE '@DOC_YYYYMM%'
       AND M_SDCTIME < TO_CHAR(ADD_MONTHS('@DOC_YYYYMM'||'01',1),'yyyy-MM-dd')       AND M_SDOCTYPE IN ('SOAHR','SOCHR')    GROUP BY M_SHBL_NO)SELECT A.M_SSNDRTPCODE, COUNT(B.M_SHBL_NO) AS BL_COUNT  FROM TTXSTAT@ELVIS_CHAIN A             LEFT OUTER JOIN T_HBL B ON A.M_STXID = B.M_STXID  WHERE A.M_STXID LIKE '@DOC_YYYYMM%'    AND A.M_SSNDRTPCODE = '@CUSTOMS_4CD'    AND A.M_SDOCNAME IN ('SOAHR','SOCHR')GROUP BY A.M_SSNDRTPCODE[/SendData][CRMCode]-- CRM 거래처코드, 명, CHAIN ID 확인WITH T_CUST AS (	SELECT MAX(CUST_CD) AS CUST_CD	  FROM CRM_CUST_MST	 WHERE CHAIN_ID = '@CUSTOMS_4CD' ), 	 T_CUSTID AS (	SELECT MAX(CUST_CD) AS CUST_CD	  FROM CRM_CUST_EDI	 WHERE EDI_SYS_CD = '@SND_GUBUN' AND SENDER_ID = '@KL_SNDID')SELECT  CASE WHEN C.B_CUST_CD IS NULL             THEN C.A_CUST_CD              ELSE C.B_CUST_CD END AS CUST_CD      , C.CUST_LOC_NM      , C.CHAIN_ID  FROM    (        SELECT               T.CUST_CD AS A_CUST_CD             , '' AS B_CUST_CD             , A.CUST_LOC_NM             , A.CHAIN_ID          FROM CRM_CUST_MST A                   INNER JOIN T_CUST T ON A.CUST_CD = T.CUST_CD        UNION        SELECT               '' AS A_CUST_CD               , E.CUST_CD AS B_CUST_CD             , A.CUST_LOC_NM             , A.CHAIN_ID          FROM CRM_CUST_MST A                  INNER JOIN T_CUSTID E ON A.CUST_CD = E.CUST_CD    )  C    [/CRMCode][SelectAFR]-- 등록된 자료 조회SELECT KEY_YM 		AS DOC_YYYYMM 	 , INV_YM 		AS INV_YM	 , KL_AFR_ID 	AS SND_ID	 , KL_CUST_NM 	AS KLNET_CUST_NM	 , KL_BL_CNT 	AS KL_HBL_COUNT	 , KL_4CODE 	AS CUSTOMS_4CODE	 , KL_ACC_AMT 	AS KLNET_ACC_AMT	 , KL_COMMISSION AS KLNET_COMMISSION	 , CRM_CUST_CD 	AS CUST_CD	 , CRM_CUST_NM 	AS CUST_LOC_NM	 , CHAIN_BL_CNT AS CHAIN_HBL_COUNT	 , CASE WHEN KL_BL_CNT <> CHAIN_BL_CNT THEN 'Y' ELSE ' ' END AS BL_CNT_CK  FROM ECH_KL_AFR_ACC WHERE 	CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN KEY_YM 		 ELSE INV_YM END >= '@DOC_STR_YYYYMM' [END_YMD] 		AND CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN KEY_YM 		 		 ELSE INV_YM END <= '@DOC_END_YYYYMM' [/END_YMD] [CUST_CD]   		AND CRM_CUST_CD = '@CUST_CD' [/CUST_CD] [CUST_NM]   		AND CRM_CUST_NM LIKE '%@CUST_LOC_NM%' [/CUST_NM] [CUSTOMS_4CODE]   		AND CRM_CUST_NM = '@CUSTOMS_4CODE' [/CUSTOMS_4CODE] [/SelectAFR]
#EchAccountExcelUpDown@SearchMFCS
--EchAccountExcelUpDown@SearchMFCS[ECH_MFCS_DETAIL]-- Insert/Update 체크	SELECT KEY_YM  	  FROM ECH_KL_MFCS_DETAIL_ACC 	 WHERE KEY_YM = '@DOC_YYYYMM'   	   AND KL_THIS_IPM = '@THIS_IPM'       AND KL_SEND_ID = '@SND_ID'       AND KL_RECV_ID = '@RECV_ID'       AND KL_DOC_NM = '@DOC_NM'[/ECH_MFCS_DETAIL][ECH_MFCS_ACC]-- Insert/Update 체크	SELECT KEY_YM  	  FROM ECH_KL_MFCS_TOT_ACC	 WHERE KEY_YM = '@DOC_YYYYMM'	   AND KL_SEND_ID = '@SND_ID'	   AND KL_RECV_ID = '@RECV_ID'	   AND KL_DOC_NM = '@DOC_NM'	   AND KL_SEND_RECV = '@SEND_RECV'[/ECH_MFCS_ACC][SelectMFCSDetail]		SELECT    KEY_YM 		AS DOC_YYYYMM				, INV_YM		AS INV_YM				, KL_4CODE 		AS CUSTOMS_4CODE				, KL_SEND_ID 	AS SND_ID				, KL_RECV_ID 	AS RECV_ID				, KL_THIS_IPM 	AS THIS_IPM				, KL_DOC_NM 	AS DOC_NM				, KL_DOC_BGM 	AS BGM				, KL_SEND_RECV 	AS SND_RECV				, KL_SND_BYTE 	AS SND_BYTE				, KL_KEY_NO 	AS KEY_NO				, KL_DOC_ITEM 	AS DOC_ITEM				, CRM_CUST_CD 	AS CUST_CD				, CRM_CUST_NM 	AS CUST_LOC_NM				, CHAIN_SND_BYTE AS CHAIN_SND_BYTE				, CASE WHEN NVL(CHAIN_SND_BYTE,0) = 0 THEN 'N' ELSE 'Y' END AS SND_CK		  FROM ECH_KL_MFCS_DETAIL_ACC		 WHERE 1 = 1		   AND CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN KEY_YM 		 			ELSE INV_YM END >= '@DOC_STR_YYYYMM'		 [END_YMD]		 		AND CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN KEY_YM 		 				 ELSE INV_YM END <= '@DOC_END_YYYYMM'		 [/END_YMD]		 [CUST_CD]		   		AND CRM_CUST_CD = '@CUST_CD'		 [/CUST_CD]		 [CUST_NM]		   		AND CRM_CUST_NM LIKE '%@CUST_LOC_NM%'		 [/CUST_NM]		 [CUSTOMS_4CODE]		   		AND KL_4CODE = '@CUSTOMS_4CODE'		 [/CUSTOMS_4CODE][/SelectMFCSDetail][SelectMFCS]		SELECT    KEY_YM 		AS DOC_YYYYMM				, INV_YM		AS INV_YM				, KL_4CODE 		AS CUSTOMS_4CODE				, KL_SEND_ID 	AS SND_ID				, KL_RECV_ID 	AS RECV_ID				, KL_DOC_NM 	AS DOC_NM				, KL_SEND_RECV 	AS SND_RECV				, KL_TOT_SND_BYTE AS TOT_SND_BYTE				, KL_ACC_SND_BYTE AS ACC_SND_BYTE				, KL_ACC_AMT 	AS ACC_AMT				, KL_COMMISSION AS COMMISSION				, KL_REMARK 	AS REMARK				, CRM_CUST_CD 	AS CUST_CD				, CRM_CUST_NM 	AS CUST_LOC_NM		  FROM ECH_KL_MFCS_TOT_ACC		 WHERE 1 = 1		   AND CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN KEY_YM 		 			ELSE INV_YM END >= '@DOC_STR_YYYYMM'		 [END_YMD]		 		AND CASE WHEN '@SEARCH_TYPE' = 'SND_YM' THEN KEY_YM 		 				 ELSE INV_YM END <= '@DOC_END_YYYYMM'		 [/END_YMD]		 [CUST_CD]		   		AND CRM_CUST_CD = '@CUST_CD'		 [/CUST_CD]		 [CUST_NM]		   		AND CRM_CUST_NM LIKE '%@CUST_LOC_NM%'		 [/CUST_NM]		 [CUSTOMS_4CODE]		   		AND KL_4CODE = '@CUSTOMS_4CODE'		 [/CUSTOMS_4CODE][/SelectMFCS][SEL_UDR_TMP]	SELECT 		   KEY_YM 		AS DOC_YYYYMM		 , INV_YM		AS INV_YM		 , KL_4CODE 	AS CUSTOMS_4CODE		 , KL_SEND_ID 	AS SND_ID		 , KL_RECV_ID 	AS RECV_ID		 , KL_THIS_IPM 	AS THIS_IPM		 , KL_DOC_NM 	AS DOC_NM		 , KL_DOC_BGM 	AS BGM		 , KL_SEND_RECV AS SND_RECV		 , KL_SND_BYTE 	AS SND_BYTE		 , KL_KEY_NO 	AS KEY_NO		 , KL_DOC_ITEM  AS DOC_ITEM		 , CRM_CUST_CD 	AS CUST_CD		 , CRM_CUST_NM 	AS CUST_LOC_NM		 , CHAIN_SND_BYTE		 , SND_CK	  FROM ECH_KL_MFCS_DETAIL_TMP	 WHERE 1 = 1	   AND KEY_YM = '@DOC_YYYYMM'	   AND INSERT_USER = '@USER_ID'	   [/SEL_UDR_TMP][UDR_SELECT_CLEAR]	SELECT * FROM ECH_KL_MFCS_DETAIL_TMP WHERE KEY_YM = '@DOC_YYYYMM' AND INSERT_USER = '@USER_ID' AND ROWNUM = 1[/UDR_SELECT_CLEAR][UDR_SAVE_CLEAR]	SELECT * FROM ECH_KL_MFCS_DETAIL_ACC WHERE KEY_YM = '@DOC_YYYYMM' AND ROWNUM = 1[/UDR_SAVE_CLEAR]
