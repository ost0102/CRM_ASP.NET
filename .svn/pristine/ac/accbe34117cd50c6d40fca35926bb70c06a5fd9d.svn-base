#EchCustomerMgt@SaveEch
--EchCustomerMgt@SaveEchBEGIN[ELVIS_CHAIN]				[NACCS_UP]					UPDATE ECH_NACCS_CODE@ELVIS_CHAIN SET					M_SSEND_ID = '@NACCS_ID'				  , M_SSEND_PW = '@NACCS_PWD'				  , M_SCODE = '@NACCS_CD'				  , M_SEMAIL_ADR = '@NACCS_EMAIL'			 WHERE M_STPCODE = '@CUSTOMS_CD';					[/NACCS_UP]				[NACCS_IN]			INSERT INTO ECH_NACCS_CODE@ELVIS_CHAIN (  M_STPCODE,  M_SSEND_ID,  M_SSEND_PW,  M_SCODE,  M_SEMAIL_ADR,  M_SSMS,  M_SEMAIL_YN,  M_SSMS_YN) 					VALUES ('@CUSTOMS_CD','@NACCS_ID','@NACCS_PWD','@NACCS_CD','@NACCS_EMAIL','','','');		[/NACCS_IN]				[PIMA_UP]			UPDATE ECH_AIR_PIMA@ELVIS_CHAIN SET M_SPIMACODE = '@PIMA_FWB', M_S6CODE = '@PIMA_SIX_CODE' WHERE M_STPCODE = '@CUSTOMS_CD' AND M_SDOCNAME = 'FWB';			UPDATE ECH_AIR_PIMA@ELVIS_CHAIN SET M_SPIMACODE = '@PIMA_FHL', M_S6CODE = '@PIMA_SIX_CODE' WHERE M_STPCODE = '@CUSTOMS_CD' AND M_SDOCNAME = 'ARAMS';			UPDATE ECH_AIR_PIMA@ELVIS_CHAIN SET M_SPIMACODE = '@PIMA_FHL', M_S6CODE = '@PIMA_SIX_CODE' WHERE M_STPCODE = '@CUSTOMS_CD' AND M_SDOCNAME = 'OMFCS';		[/PIMA_UP]				[PIMA_IN]			INSERT INTO ECH_AIR_PIMA@ELVIS_CHAIN (M_STPCODE,M_SDOCNAME,M_SPIMACODE,M_S6CODE) VALUES ('@CUSTOMS_CD','FWB',      '@PIMA_FWB',   '@PIMA_SIX_CODE');			INSERT INTO ECH_AIR_PIMA@ELVIS_CHAIN (M_STPCODE,M_SDOCNAME,M_SPIMACODE,M_S6CODE) VALUES ('@CUSTOMS_CD','ARAMS',    '@PIMA_FHL','@PIMA_SIX_CODE');			INSERT INTO ECH_AIR_PIMA@ELVIS_CHAIN (M_STPCODE,M_SDOCNAME,M_SPIMACODE,M_S6CODE) VALUES ('@CUSTOMS_CD','OMFCS',    '@PIMA_FHL','@PIMA_SIX_CODE');		[/PIMA_IN]				[VENDER_UP]			UPDATE ECH_VANDER_MST@ELVIS_CHAIN SET M_SRCVRTPCODE = '@RECV_ID', M_SSRID = '@SEND_ID' WHERE M_STPCODE = '@CUSTOMS_CD' AND M_SDOCNAME = '@DOC_NM';			[FTP]				UPDATE ECH_VANDER_MST@ELVIS_CHAIN SET M_SFTPID = '@FTP_ID', M_SFTPPW = '@FTP_PWD'  WHERE M_STPCODE = '@CUSTOMS_CD' AND M_SDOCNAME = '@DOC_NM';			{/FTP]		[/VENDER_UP][/ELVIS_CHAIN][B2B_ENGIN][/B2B_ENGIN]END;
#EchCustomerMgt@Search
--EchCustomerMgt@Search[MAIN]	WITH T_PIMA AS (	          SELECT    M_STPCODE	                  , M_SPIMACODE AS FWB_PIMA	                  , (SELECT M_SPIMACODE FROM ECH_AIR_PIMA@ELVIS_CHAIN WHERE M_STPCODE = FWB.M_STPCODE AND M_SDOCNAME = 'ARAMS') AS FHL_PIMA	                  , M_S6CODE 	            FROM ECH_AIR_PIMA@ELVIS_CHAIN FWB	           WHERE FWB.M_SDOCNAME = 'FWB'	)	, T_KTAIR_ID AS (	SELECT A.M_STPCODE	     , B.M_SSRID	     , A.M_SFTPID	     , A.M_SFTPPW	  FROM ECH_VANDER_MST@ELVIS_CHAIN A	            INNER JOIN TTP_EDIFACT@ELVIS_CHAIN B ON A.M_STPCODE = B.M_STPCODE AND B.M_SSTANDARD = 'KTAEDIFACT'	 WHERE M_SDOCNAME = 'AIRDO' AND SUBSTR(M_SRCVRTPCODE,1,5) = 'KTNET'	)	, T_KTSEA_ID AS (	SELECT A.M_STPCODE	     , B.M_SSRID	     , A.M_SFTPID	     , A.M_SFTPPW	  FROM ECH_VANDER_MST@ELVIS_CHAIN A	            INNER JOIN TTP_EDIFACT@ELVIS_CHAIN B ON A.M_STPCODE = B.M_STPCODE AND B.M_SSTANDARD = 'KTSEDIFACT'	 WHERE M_SDOCNAME = 'SOMFC' AND SUBSTR(M_SRCVRTPCODE,1,5) = 'KTNET'	) 	, T_KLAIR_ID AS (	SELECT A.M_STPCODE	     , B.M_SSRID	  FROM ECH_VANDER_MST@ELVIS_CHAIN A	            INNER JOIN TTP_EDIFACT@ELVIS_CHAIN B ON A.M_STPCODE = B.M_STPCODE AND B.M_SSTANDARD = 'KLAEDIFACT'	 WHERE M_SDOCNAME = 'AIRDO' AND SUBSTR(M_SRCVRTPCODE,1,5) = 'KLNET'	)	, T_KLSEA_ID AS (	SELECT A.M_STPCODE	     , B.M_SSRID	  FROM ECH_VANDER_MST@ELVIS_CHAIN A	            INNER JOIN TTP_EDIFACT@ELVIS_CHAIN B ON A.M_STPCODE = B.M_STPCODE AND B.M_SSTANDARD = 'KLSEDIFACT'	 WHERE M_SDOCNAME = 'SOMFC' AND SUBSTR(M_SRCVRTPCODE,1,5) = 'KLNET'	)			SELECT			CRM.CUST_LOC_NM 	AS CUST_NM		  , CRM.CUST_LOC_NM 	AS CUST_LOC_NM		  , CRM.CUST_CD			AS CUST_CD		  , CRM.CUSTOMS_CD 		AS CUSTOMS_CD		  , CRM.CHAIN_ID 		AS CHAIN_ID		  , CRM.CHAIN_PWD 		AS CHAIN_PWD		  , P.FWB_PIMA			AS PIMA_FWB		  , P.FHL_PIMA			AS PIMA_FHL		  , P.M_S6CODE			AS PIMA_SIX_CD		  , KT_A.M_SSRID		AS KT_AIR_ID		  , KT_S.M_SSRID		AS KT_SEA_ID		  , KL_A.M_SSRID		AS KL_AIR_ID		  , KL_S.M_SSRID		AS KL_SEA_ID		  , J.M_SSEND_ID		AS NACCS_ID		  , J.M_SSEND_PW		AS NACCS_PWD		  , J.M_SCODE			AS NACCS_CODE		  , J.M_SCODE			AS NACCS_CD		  , J.M_SEMAIL_ADR		AS NACCS_EMAIL		  , CRM.CHAIN_START_YMD		  , CRM.CHAIN_END_YMD          , CASE WHEN KT_S.M_SFTPID IS NULL THEN KT_A.M_SFTPID ELSE KT_S.M_SFTPID END        AS KT_FTP_ID
          , CASE WHEN KT_S.M_SFTPPW IS NULL THEN KT_A.M_SFTPPW ELSE KT_S.M_SFTPPW END       AS KT_FTP_PWD	  FROM CRM_CUST_MST CRM	  			LEFT OUTER JOIN T_PIMA P ON CRM.CHAIN_ID = P.M_STPCODE	  			LEFT OUTER JOIN ECH_NACCS_CODE@ELVIS_CHAIN J ON CRM.CHAIN_ID = J.M_STPCODE	  			LEFT OUTER JOIN T_KTAIR_ID KT_A ON CRM.CHAIN_ID = KT_A.M_STPCODE	  			LEFT OUTER JOIN T_KTSEA_ID KT_S ON CRM.CHAIN_ID = KT_S.M_STPCODE	  			LEFT OUTER JOIN T_KLAIR_ID KL_A ON CRM.CHAIN_ID = KL_A.M_STPCODE	  			LEFT OUTER JOIN T_KLSEA_ID KL_S ON CRM.CHAIN_ID = KL_S.M_STPCODE	 WHERE 1 = 1		AND CRM.CHAIN_ID IS NOT NULL		[CUST_CD]				AND CRM.CUST_CD = '@CUST_CD'		[/CUST_CD]		[4CODE]				AND CRM.CHAIN_ID = '@CUSTOMS_CD'		[/4CODE]		[CUST_NM]				AND CRM.CHAIN_ID LIKE '%@CUST_NM%'		[/CUST_NM]	   	    [SEARCH_KEY]		   AND ( 1 != 1		   OR CRM.CUST_CD LIKE '%@SEARCH_KEY%'		   OR CRM.CUST_NM LIKE '%@SEARCH_KEY%'		   OR CRM.CUST_LOC_NM LIKE '%@SEARCH_KEY%'		   OR CRM.CHAIN_ID LIKE '%@SEARCH_KEY%'		  )		[/SEARCH_KEY][/MAIN][DOC_DETAIL]	SELECT M_STPCODE  	     , M_SDOCNAME	     , CASE WHEN M_SDOCNAME = 'AIRDO' THEN '항공 D/O'	            ELSE (CASE WHEN M_SDOCNAME = 'AIRDC' THEN '항공 D/O 취소'	                       ELSE (CASE WHEN M_SDOCNAME = 'ARDCD' THEN '하기배정 신고'	                                  ELSE (CASE WHEN M_SDOCNAME = 'ARAMS' THEN '항공 AMS'	                                             ELSE (CASE WHEN M_SDOCNAME = 'OMFCS' THEN '항공 수출적하목록'	                                                        ELSE (CASE WHEN M_SDOCNAME = 'ICMOD' THEN '항공 수입적하 정정'	                                                                   ELSE (CASE WHEN M_SDOCNAME = 'OCMOD' THEN '항공 수출적하 정정'	                                                                              ELSE (CASE WHEN M_SDOCNAME = 'FWB' THEN 'FWB'	            ELSE (CASE WHEN M_SDOCNAME = 'SIMFC' THEN '해운 수입적하목록'	                       ELSE (CASE WHEN M_SDOCNAME = 'SOMFC' THEN '해운 수출적하목록'	                                  ELSE (CASE WHEN M_SDOCNAME = 'SIMOD' THEN  '해운 수입적하 정정'	                                             ELSE (CASE WHEN M_SDOCNAME = 'SOMOD' THEN  '해운 수출적하 정정'	                                                        ELSE (CASE WHEN M_SDOCNAME = 'SOAHR' THEN  '해운 AFR 원본'	                                                                   ELSE (CASE WHEN M_SDOCNAME = 'SOCHR' THEN  '해운 AFR 수정본'	                                                                              ELSE (CASE WHEN M_SDOCNAME = 'SOCMP' THEN  '해운 AFR 확정'	                                                                                         ELSE (CASE WHEN M_SDOCNAME = 'SOBLL' THEN  '해운 AFR 삭제'	                                                                                                    ELSE (CASE WHEN M_SDOCNAME = 'SRAMS' THEN  '해운 AMS'	                                                                                                               ELSE M_SDOCNAME END)	                                                                                                    END)	                                                                                         END)	                                                                              END)	                                                                   END)	                                                        END)	                                             END)	                                  END)	                       END)	            END)	                                                                                  	                                                                              END)	                                                                   END)	                                                       END)	                                            END)	                                  END)	                       END)	            END AS M_SDOCNAME_NM	     , SUBSTR(M_SRCVRTPCODE,1,5) AS M_SRCVRTPCODE_NM                                 	     , M_SRCVRTPCODE 	     , M_SFTPID 	     , M_SFTPPW 	FROM ECH_VANDER_MST@ELVIS_CHAIN   WHERE M_STPCODE = '@CUSTOMS_CD'   [/DOC_DETAIL][PIMA_CK]	SELECT * FROM ECH_AIR_PIMA@ELVIS_CHAIN WHERE M_STPCODE = '@CUSTOMS_CD'[/PIMA_CK][NACCS_CK]	SELECT * FROM ECH_NACCS_CODE@ELVIS_CHAIN WHERE M_STPCODE = '@CUSTOMS_CD'[/NACCS_CK]
