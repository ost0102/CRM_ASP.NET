#CrmAsList@SaveScore
--CrmAsList@SaveScoreUPDATE MDM_COM_CODE   SET OPT_ITEM10 = '@OPT_ITEM10'     , UPD_USR   = '@USR_ID'	 , UPD_YMD   = TO_CHAR(SYSDATE,'yyyyMMdd')	 , UPD_HM    = TO_CHAR(SYSDATE,'HH24MISS') WHERE GRP_CD = '@GRP_CD'   AND COMN_CD = '@COMN_CD'
#CrmAsList@Search
--CrmAsList@SearchSELECT A.MNGT_NO     , A.UPPER_MNGT_NO     , A.ORGN_MNGT_NO     , NVL(C.SEQ,0) AS SEQ     , A.REQ_YMD     , UFN_FORMAT (A.REQ_HM, 'TIME') AS REQ_HM     , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN UFN_FORMAT (A.REQ_YMD, 'DATE')||' '||UFN_FORMAT (A.REQ_HM, 'TIME') ELSE UFN_FORMAT (C.REQ_YMD, 'DATE')||' '||UFN_FORMAT (C.REQ_HM, 'TIME') END) AS REQ_DATE     , A.REQ_SVC     , (SELECT MAX (Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T02' AND Z.COMN_CD = A.REQ_SVC) AS REQ_SVC_NM     , A.REQ_SVC2     , (SELECT MAX (Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T10' AND Z.COMN_CD = A.REQ_SVC2) AS REQ_SVC2_NM     , A.CUST_CD     , (SELECT Z.CUST_LOC_NM FROM CRM_CUST_MST Z WHERE Z.CUST_CD = A.CUST_CD) AS CUST_NM     , (SELECT Z.CUST_ADDR FROM CRM_CUST_MST Z WHERE Z.CUST_CD = A.CUST_CD) AS CUST_ADDR     , (SELECT Z.SUBJECT FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO AND ROWNUM = 1) AS SUBJECT     , A.CONTENT AS CONTENTS     , ((SELECT (CASE WHEN Z.SUBJECT IS NOT NULL THEN '제목:'||TRIM (Z.SUBJECT)||CHR(13)||CHR(10)||'내용:' END) FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO AND ROWNUM = 1)||A.CONTENT) AS CONTENT     , (SELECT (CASE WHEN Z.SUBJECT IS NOT NULL THEN TRIM(Z.SUBJECT)||'  ' END) FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO AND ROWNUM = 1)||A.CONTENT AS CONTENT_NM     , A.REQ_USR     , (SELECT Z.REQ_EMAIL FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO AND ROWNUM = 1) AS REQ_EMAIL     , A.TEL_NO     , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN A.PROC_TYPE ELSE C.PROC_TYPE END) AS PROC_TYPE     , (SELECT MAX (Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T03' AND Z.COMN_CD = (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN A.PROC_TYPE ELSE C.PROC_TYPE END)) AS PROC_TYPE_NM     , (SELECT MAX (Z.OPT_ITEM1) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T03' AND Z.COMN_CD = (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN A.PROC_TYPE ELSE C.PROC_TYPE END)) AS PROC_GRP_NM     , A.REQ_TYPE     , (SELECT MAX (Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T05' AND Z.COMN_CD = A.REQ_TYPE) AS REQ_TYPE_NM     , A.REQ_TYPE2      , (SELECT MAX (Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T09' AND Z.COMN_CD = A.REQ_TYPE2) AS REQ_TYPE2_NM     , A.PRIORITY     , (CASE WHEN C.SEQ IS NULL THEN A.WORK_USR ELSE C.USR_ID END) AS WORK_USR     , (CASE WHEN C.USR_ID IS NOT NULL THEN (SELECT MAX (Z.LOC_NM) FROM CRM_USR_MST Z WHERE Z.USR_ID = C.USR_ID) ELSE A.WORK_USR END) AS WORK_USR_NM     , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN A.PRAR_YMD ELSE C.PRAR_YMD END) AS PRAR_YMD     , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN A.CMPT_YMD ELSE C.CMPT_YMD END) AS CMPT_YMD     , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN UFN_FORMAT (A.CMPT_HM, 'TIME') ELSE UFN_FORMAT (C.CMPT_HM, 'TIME') END) AS CMPT_HM     , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN UFN_FORMAT (A.CMPT_YMD, 'DATE')||' '||UFN_FORMAT (A.CMPT_HM, 'TIME') ELSE UFN_FORMAT (C.CMPT_YMD, 'DATE')||' '||UFN_FORMAT(C.CMPT_HM, 'TIME') END) AS CMPT_DATE     , A.RMK     , A.CMPT_RMK     , (CASE WHEN A.SYS_ID IN ('CRM','MAIL') THEN A.INS_USR ELSE '' END) AS INS_USR     , A.FREE_YN     , (CASE WHEN (SELECT COUNT(*) FROM COM_DOC_MST X WHERE X.MNGT_NO = A.MNGT_NO) >= 1 THEN 'Y' ELSE 'N' END) AS FILE_YN     , (SELECT COUNT(*) FROM COM_DOC_MST X WHERE X.MNGT_NO = A.MNGT_NO) AS DOC_CNT      , A.SYS_ID     , A.SYS_ID AS SYS_NM     , (SELECT WM_CONCAT (CD_NM) FROM CRM_AS_MST_SHARE X, MDM_COM_CODE X1 WHERE EXCEPT_YN = 'N' AND X1.GRP_CD = 'C03' AND X1.COMN_CD = X.DEPT_CD AND X.MNGT_NO = A.MNGT_NO) AS SHARE_DEPT     , UFN_FORMAT (A.INS_YMD, 'DATE')||' '||UFN_FORMAT (A.INS_HM, 'TIME') AS INS_DATE     , A.EDU_LV     , (CASE WHEN A.DEV_CMPT_YMD IS NULL THEN 'N' WHEN A.PROC_TYPE NOT IN ('1', '8') AND A.DEV_CMPT_YMD IS NOT NULL THEN 'Y' ELSE 'N' END) AS DEV_CMPT_YN     , (SELECT MAX (CASE WHEN Z.RETURN_YN = 'Y' THEN '반려' WHEN Z.RETURN_YN = 'A' THEN '재확인' ELSE '' END) FROM CRM_AS_MST_SHARE Z WHERE Z.MNGT_NO = A.MNGT_NO) AS RETURN_YN     , (SELECT REPLACE (WM_CONCAT (REPLACE (UFN_GET_COM_INFO ('T07', NVL(X.PROC_TYPE, '01'), 'OPT_ITEM1')||':'||'  '||(SELECT LOC_NM FROM CRM_USR_MST A WHERE A.USR_ID = X.USR_ID)||CHR(13)||CHR(10)||X.DEV_CONTENT,',','^!')),',',CHR(13)||CHR(10)||CHR(13)||CHR(10)) FROM CRM_AS_MST_WORK X WHERE X.MNGT_NO = A.MNGT_NO AND X.SEQ <> 0) AS WORK_CONTENT     , (SELECT WM_CONCAT (DISTINCT Z.SALES_NM) FROM CRM_CUST_SVC Z WHERE Z.CUST_CD = A.CUST_CD AND Z.SALES_NM IS NOT NULL) AS SALES_NM     , A.DEPT_CD     , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'C03' AND Z.COMN_CD = (CASE WHEN C.DEPT_CD IS NOT NULL THEN C.DEPT_CD ELSE A.DEPT_CD END)) AS DEPT_NM     , C.DEPT_CD AS DEV_DEPT_CD     , 1 AS REQ_COUNT     , A.EX_IM_TYPE     , (CASE WHEN A.EX_IM_TYPE = 'I' THEN '내근' WHEN A.EX_IM_TYPE = 'E' THEN '외근' ELSE A.EX_IM_TYPE END) AS EX_IM_TYPE_NM     , (CASE WHEN (C.SEQ = 0 OR C.SEQ IS NULL) THEN A.RANK ELSE C.RANK END) AS RANK     , TO_NUMBER(NVL(S.OPT_ITEM10,1)+NVL(S1.OPT_ITEM10,0)) AS SCORE_UNIT     , TO_NUMBER(NVL(S3.OPT_ITEM10,1)) AS SCORE_RANK     , TO_NUMBER(NVL(S2.OPT_ITEM10,1)) AS SCORE_EXIM     , TO_NUMBER(NVL(S.OPT_ITEM10,1)+NVL(S1.OPT_ITEM10,0)+NVL(S2.OPT_ITEM10,1)+NVL(S3.OPT_ITEM10,1)) AS SCORE_TOT     , PROJECT_CD     , (SELECT Z.CD_NM FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T16' AND Z.COMN_CD = A.PROJECT_CD) AS PROJECT_NM     , (SELECT Z.DEPT_NM FROM CRM_CUST_PIC Z WHERE Z.CUST_CD = A.CUST_CD AND Z.PIC_NM = A.REQ_USR AND ROWNUM = 1) AS CUST_DEPT_NM     , TRUNC(TO_NUMBER(TO_DATE(A.REQ_YMD,'YYYYMMDD')-SYSDATE)/7) AS PREV_WEEK     , A.ONLINE_YN
     , (UFN_FORMAT (A.TAKE_YMD, 'DATE')||' '||UFN_FORMAT(A.TAKE_HM, 'TIME')) AS TAKE_DATE FROM CRM_AS_MST A      LEFT OUTER JOIN CRM_AS_MST_WORK C              ON A.MNGT_NO = C.MNGT_NO      LEFT OUTER JOIN MDM_COM_CODE S              ON A.REQ_SVC = S.OPT_ITEM1             AND A.REQ_SVC2 = S.COMN_CD             AND S.GRP_CD = 'T10'      LEFT OUTER JOIN MDM_COM_CODE S1              ON A.REQ_SVC = S1.COMN_CD AND S1.GRP_CD = 'T02'      LEFT OUTER JOIN MDM_COM_CODE S2              ON A.EX_IM_TYPE = S2.COMN_CD AND S2.GRP_CD IN ('T14')      LEFT OUTER JOIN MDM_COM_CODE S3              ON A.RANK = S3.COMN_CD AND S3.GRP_CD IN ('T15')WHERE 1 = 1  [REQ_YMD]    [FM_YMD]      AND A.REQ_YMD >= '@FM_YMD'    [/FM_YMD]    [TO_YMD]      AND A.REQ_YMD <= '@TO_YMD'    [/TO_YMD]  [/REQ_YMD]       [CMPT_YMD]     [FM_YMD]      AND (CASE WHEN NVL(C.SEQ,'0') = '0' THEN A.CMPT_YMD ELSE C.CMPT_YMD END) >= '@FM_YMD'    [/FM_YMD]    [TO_YMD]      AND (CASE WHEN NVL(C.SEQ,'0') = '0' THEN A.CMPT_YMD ELSE C.CMPT_YMD END) <= '@TO_YMD'    [/TO_YMD]  [/CMPT_YMD]      [DEPT_CD]    [DEPT_TYPE_I]      AND A.DEPT_CD = '@DEPT_CD'    [/DEPT_TYPE_I]    [DEPT_TYPE_W]      AND NVL(C.DEPT_CD, A.DEPT_CD) = '@DEPT_CD'    [/DEPT_TYPE_W]    [DEPT_TYPE_M]      AND A.DEPT_CD IN ('@DEPT_CD')    [/DEPT_TYPE_M]  [/DEPT_CD]  [DEPT_AUTH]    AND A.MNGT_NO IN (SELECT MNGT_NO FROM CRM_AS_MST_SHARE WHERE DEPT_CD = '@DEPT_AUTH' AND EXCEPT_YN = 'N')  [/DEPT_AUTH]  [CUST_CD]    AND A.CUST_CD = '@CUST_CD'  [/CUST_CD]  [WORK_TYPE_W]    [WORK_USR]      --AND (A.WORK_USR = (SELECT MAX(Z.USR_ID) FROM CRM_USR_MST Z WHERE Z.LOC_NM = '@WORK_USR' AND USE_YN = 'Y')      --     OR A.WORK_USR = '@WORK_USR'      --    )      AND (CASE WHEN C.SEQ IS NULL THEN A.WORK_USR ELSE C.USR_ID END) = '@WORK_USR'    [/WORK_USR]  [/WORK_TYPE_W]  [WORK_TYPE_I]    [WORK_USR]      AND A.INS_USR = '@WORK_USR'     [/WORK_USR]  [/WORK_TYPE_I]  [SEARCH_KEY]     AND (1!=1          OR A.CUST_CD LIKE '%@SEARCH_KEY%'          OR A.TEL_NO LIKE '%@SEARCH_KEY%'          OR A.REQ_USR LIKE '%@SEARCH_KEY%'          OR A.MNGT_NO LIKE '%@SEARCH_KEY%'          OR A.CONTENT LIKE '%@SEARCH_KEY%'          OR A.MNGT_NO IN (SELECT MNGT_NO FROM CRM_AS_MST_WORK WHERE USR_ID IN (SELECT VALUE1 FROM TABLE(UFN_GET_INFO('USER_LIST','%@SEARCH_KEY%'))))           OR EXISTS (SELECT Z.CUST_CD FROM CRM_CUST_MST Z WHERE Z.CUST_CD = A.CUST_CD AND (Z.CUSTOMS_CD LIKE '%@SEARCH_KEY%' OR Z.CUST_NM LIKE '%@SEARCH_KEY%' OR Z.CUST_LOC_NM LIKE '%@SEARCH_KEY%' OR Z.DOMAIN LIKE '%@SEARCH_KEY%'))         )  [/SEARCH_KEY]  [REQ_SVC]    AND A.REQ_SVC = '@REQ_SVC'  [/REQ_SVC]  [REQ_SVC2]    AND A.REQ_SVC2 = '@REQ_SVC2'  [/REQ_SVC2]  [REQ_TYPE2]    AND A.REQ_TYPE2 = '@REQ_TYPE2'  [/REQ_TYPE2]  [PROC_TYPE]    AND (CASE WHEN NVL(C.SEQ,'0') = '0' THEN A.PROC_TYPE ELSE C.PROC_TYPE END) IN ('@PROC_TYPE')  [/PROC_TYPE]  [FIRST_DATA_Y]    AND A.ORGN_MNGT_NO IS NULL AND NVL(C.SEQ,'0') = '0'  [/FIRST_DATA_Y]  [EX_IM_TYPE]    AND EX_IM_TYPE = '@EX_IM_TYPE'  [/EX_IM_TYPE]  [PROJECT_CD]    AND PROJECT_CD = '@PROJECT_CD'  [/PROJECT_CD]  [SELF_PROC_Y]    AND ONLINE_YN = 'P'  [/SELF_PROC_Y]  [SELF_PROC_N]    AND ONLINE_YN <> 'P'  [/SELF_PROC_N]ORDER BY A.REQ_YMD DESC, A.REQ_HM DESC, NVL(C.SEQ,'0') DESC, A.MNGT_NO DESC
#CrmAsList@Search_20180926
--CrmAsList@SearchSELECT A.MNGT_NO     , UFN_FORMAT(A.REQ_YMD,'DATE') AS REQ_YMD     , UFN_FORMAT(A.REQ_HM,'TIME') AS REQ_HM     , UFN_FORMAT(A.REQ_YMD,'DATE')||' '||UFN_FORMAT(A.REQ_HM,'TIME') AS REQ_DATE     , A.REQ_SVC     , A.REQ_SVC2     , A.CUST_CD     , B.CUST_LOC_NM AS CUST_NM     --, A.CONTENT     , (SELECT (CASE WHEN Z.SUBJECT IS NOT NULL THEN '제목:'||TRIM(Z.SUBJECT)||CHR(13)||CHR(10)||'내용:' END) FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO)||A.CONTENT AS CONTENT     , A.REQ_USR      , A.TEL_NO     , A.PROC_TYPE   /*   , CASE WHEN A.PROC_TYPE IN ('1','2')             THEN '완료'            WHEN A.PROC_TYPE = '8'            THEN '보류'            ELSE '미완료'            END  AS PROC_TYPE_YN*/     , A.REQ_TYPE     , A.REQ_TYPE2     , A.PRIORITY     --, A.WORK_USR     , ( SELECT REPLACE( WM_CONCAT( DISTINCT (SELECT LOC_NM FROM CRM_USR_MST U WHERE U.USR_ID = X.USR_ID )) ,',',', ')               FROM CRM_AS_MST_WORK X              WHERE X.MNGT_NO = A.MNGT_NO                --AND X.DEPT_CD = A.DEPT_CD                AND X.SEQ = 0                ) AS WORK_USR     , UFN_FORMAT(A.PRAR_YMD,'DATE') AS PRAR_YMD     , UFN_FORMAT(A.CMPT_YMD,'DATE') AS CMPT_YMD     , UFN_FORMAT(A.CMPT_HM,'TIME') AS CMPT_HM     , UFN_FORMAT(A.CMPT_YMD,'DATE')||' '||UFN_FORMAT(A.CMPT_HM,'TIME') AS CMPT_DATE     , A.RMK     , A.RMK AS RMK2     , A.CMPT_RMK--     , C.LOC_NM AS INS_USR     , B.USE_YN     , B.MATN_YN     , (SELECT Z.LOC_NM FROM CRM_USR_MST Z WHERE Z.USR_ID = A.INS_USR) AS INS_USR     , A.FREE_YN     , CASE WHEN (SELECT COUNT(X.MNGT_NO)                    FROM COM_DOC_MST X                   WHERE X.MNGT_NO = A.MNGT_NO) >= 1            THEN 'Y'            ELSE 'N'       END AS FILE_YN     , A.SYS_ID 	 , NVL( NVL( ( SELECT REPLACE( WM_CONCAT( REPLACE( X.DEPT_CD,A.DEPT_CD,'') ) ,',','; ')                     FROM CRM_AS_MST_SHARE X                  WHERE X.MNGT_NO = A.MNGT_NO) ,'') , '@DEPT_CD') AS DEPT_AUTH_LIST    -- , ( SELECT REPLACE( WM_CONCAT( DISTINCT USR_ID) ,',','; ')    --           FROM CRM_AS_MST_WORK X    --          WHERE X.MNGT_NO = A.MNGT_NO    --            AND X.DEPT_CD = '@DEPT_CD'    --           -- AND X.WORK_TYPE ='WORK'    --            ) AS WORK_USR_LIST    --, CASE WHEN A.SYS_ID = 'ELVIS'    --       THEN '고객'    --       ELSE 'CRM'    --       END AS SYS_NM    ,A.SYS_ID AS SYS_NM    ,UFN_FORMAT(A.DEV_CMPT_YMD,'DATE') AS DEV_CMPT_YMD    , CASE WHEN DEV_CMPT_YMD IS NULL           THEN 'No'           WHEN PROC_TYPE NOT IN ('1','8') AND DEV_CMPT_YMD IS NOT NULL            THEN 'Yes'           ELSE 'No'           END DEV_CMPT_YN       , NVL((SELECT MAX(CASE WHEN RETURN_YN = 'Y' AND X.DEPT_CD <> '@DEPT_CD' AND A.DEPT_CD = '@DEPT_CD'    			   THEN '반려'    			   WHEN X.DEPT_CD = '@DEPT_CD' AND X.RETURN_YN = 'A'    			   THEN '재확인'                   ELSE ''                   END )          FROM CRM_AS_MST_SHARE X         WHERE X.MNGT_NO = A.MNGT_NO),'') AS RETURN_YN       ,CASE  WHEN NVL(( SELECT MAX(USR_ID)                     FROM CRM_AS_MST_WORK X	                WHERE SEQ <> 0 	                  AND X.MNGT_NO = A.MNGT_NO	                  AND X.DEPT_CD <> A.DEPT_CD),'')	               = ''	          THEN ''	          ELSE ( SELECT CASE WHEN COUNT(SEQ)  = 0	                           THEN '미분배'	                           ELSE '분배'	                           END 	                 FROM CRM_AS_MST_WORK X	                WHERE SEQ <> 0 	                  AND X.MNGT_NO = A.MNGT_NO	                 -- AND X.DEPT_CD <> A.DEPT_CD 	                )	          END  AS DIV_JOB       ,( SELECT REPLACE( WM_CONCAT( REPLACE (  UFN_GET_COM_INFO('T07',NVL(X.PROC_TYPE,'01'),'OPT_ITEM1') || ':'                            || '  '   ||    ( SELECT LOC_NM		                                    	FROM CRM_USR_MST A                                               WHERE A.USR_ID  = X.USR_ID )                             ||  CHR(13) || CHR(10)                             ||   X.DEV_CONTENT, ',' ,'^!' ) ) ,',' , CHR(13) || CHR(10) ||  CHR(13) || CHR(10)  ) AS DEV_CONTENT			FROM CRM_AS_MST_WORK X			WHERE X.MNGT_NO = A.MNGT_NO			  AND X.SEQ <> 0			  AND X.DEPT_CD <> A.DEPT_CD ) AS WORK_CONTENT        ,(  SELECT  WM_CONCAT( CD_NM ) 	         FROM CRM_AS_MST_SHARE X , MDM_COM_CODE X1	        WHERE EXCEPT_YN = 'N'	          AND X1.GRP_CD= 'C03'  	          AND X1.COMN_CD = X.DEPT_CD	          AND X.MNGT_NO = A.MNGT_NO) AS SHARE_DEPT	 , UFN_FORMAT(A.INS_YMD,'DATE')||' '||UFN_FORMAT(A.INS_HM,'TIME') AS INS_DATE	 , A.WORK_USR2	 , UFN_FORMAT(A.CMPT_YMD2,'DATE') AS CMPT_YMD2	 , A.SHARE_YN	 , A.EDU_LV  FROM CRM_AS_MST A         INNER JOIN CRM_CUST_MST B               ON A.CUST_CD = B.CUST_CD       INNER JOIN CRM_AS_MST_WORK C               ON A.MNGT_NO = C.MNGT_NO--       LEFT OUTER JOIN CRM_USR_MST C--               ON A.INS_USR = C.USR_ID WHERE 1 = 1	[REQ_YMD]		    [FM_YMD]		       AND A.REQ_YMD >= '@FM_YMD'		    [/FM_YMD]		    [TO_YMD]		       AND A.REQ_YMD <= '@TO_YMD'		    [/TO_YMD]	[/REQ_YMD]	 	[CMPT_YMD] 		    [FM_YMD]		       AND A.CMPT_YMD >= '@FM_YMD'		    [/FM_YMD]		    [TO_YMD]		       AND A.CMPT_YMD <= '@TO_YMD'		    [/TO_YMD]	[/CMPT_YMD]    	[DEPT_CD]	  [DEPT_TYPE_I]	    AND A.DEPT_CD = '@DEPT_CD'	  [/DEPT_TYPE_I]	  [DEPT_TYPE_W]	    AND EXISTS (SELECT Z.MNGT_NO FROM CRM_AS_MST_WORK Z WHERE Z.MNGT_NO = A.MNGT_NO AND Z.SEQ = 0 AND Z.DEPT_CD = '@DEPT_CD')	  [/DEPT_TYPE_W]	[/DEPT_CD]	[DEPT_AUTH]	  AND A.MNGT_NO IN ( 	                    SELECT MNGT_NO 	                      FROM CRM_AS_MST_SHARE	                     WHERE DEPT_CD = '@DEPT_AUTH'	                       AND EXCEPT_YN = 'N'	                    )  	[/DEPT_AUTH]    [CUST_CD]       AND A.CUST_CD = '@CUST_CD'    [/CUST_CD]    [WORK_TYPE_W]	  --[WORK_USR_NM]	  --   AND (A.WORK_USR LIKE '%@WORK_USR_NM%' 	  --        OR A.MNGT_NO IN (SELECT MNGT_NO	  -- 					     FROM CRM_AS_MST_WORK	  -- 					    WHERE USR_ID IN (SELECT VALUE1 FROM TABLE(  UFN_GET_INFO('USER_LIST','%@WORK_USR_NM%')))	  -- 				      )	  --      )	  --[/WORK_USR_NM]	  [WORK_USR]	     AND C.USR_ID = '@WORK_USR'	  [/WORK_USR]	[/WORK_TYPE_W]    [WORK_TYPE_I]	  [WORK_USR]	     AND A.INS_USR = '@WORK_USR' 	  [/WORK_USR]	[/WORK_TYPE_I]    [SEARCH_KEY]	   AND ( 1 != 1	   OR A.CUST_CD LIKE '%@SEARCH_KEY%'	   OR B.CUST_NM LIKE '%@SEARCH_KEY%'	   OR B.CUST_LOC_NM LIKE '%@SEARCH_KEY%'	   OR B.DOMAIN LIKE '%@SEARCH_KEY%' 		   OR A.TEL_NO LIKE '%@SEARCH_KEY%'	   OR B.CUSTOMS_CD LIKE '%@SEARCH_KEY%'	   OR A.REQ_USR LIKE '%@SEARCH_KEY%'	   --OR A.WORK_USR LIKE '%@SEARCH_KEY%'	   --OR A.WORK_USR2 LIKE '%@SEARCH_KEY%'	   OR A.MNGT_NO LIKE '%@SEARCH_KEY%'	   OR A.CONTENT LIKE '%@SEARCH_KEY%'	   OR A.MNGT_NO IN (SELECT MNGT_NO						  FROM CRM_AS_MST_WORK						 WHERE USR_ID IN (SELECT VALUE1						  FROM TABLE(  UFN_GET_INFO('USER_LIST','%@SEARCH_KEY%')))  )	  )	[/SEARCH_KEY]	[REQ_SVC]       AND A.REQ_SVC = '@REQ_SVC'    [/REQ_SVC]	[REQ_SVC2]       AND A.REQ_SVC2 = '@REQ_SVC2'    [/REQ_SVC2]    [PROC_TYPE]       AND A.PROC_TYPE IN ('@PROC_TYPE')    [/PROC_TYPE]ORDER BY REQ_YMD DESC, REQ_HM DESC
#CrmAsList@Search_20191205
--CrmAsList@SearchSELECT DISTINCT * FROM (        SELECT A.MNGT_NO             , A.UPPER_MNGT_NO             , A.ORGN_MNGT_NO             , NVL(C.SEQ,0) AS SEQ             , A.REQ_YMD             , UFN_FORMAT(A.REQ_HM,'TIME') AS REQ_HM             , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                     THEN UFN_FORMAT(A.REQ_YMD,'DATE')||' '||UFN_FORMAT(A.REQ_HM,'TIME')                     ELSE UFN_FORMAT(C.REQ_YMD,'DATE')||' '||UFN_FORMAT(C.REQ_HM,'TIME')                END) AS REQ_DATE              --, UFN_FORMAT(A.REQ_YMD,'DATE')||' '||UFN_FORMAT(A.REQ_HM,'TIME') AS REQ_DATE             , A.REQ_SVC             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T02' AND Z.COMN_CD = A.REQ_SVC) AS REQ_SVC_NM             , A.REQ_SVC2             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T10' AND Z.COMN_CD = A.REQ_SVC2) AS REQ_SVC2_NM             , A.CUST_CD             , (SELECT Z.CUST_LOC_NM FROM CRM_CUST_MST Z WHERE Z.CUST_CD = A.CUST_CD) AS CUST_NM             , (SELECT Z.CUST_ADDR FROM CRM_CUST_MST Z WHERE Z.CUST_CD = A.CUST_CD) AS CUST_ADDR             , (SELECT (CASE WHEN Z.SUBJECT IS NOT NULL THEN '제목:'||TRIM(Z.SUBJECT)||CHR(13)||CHR(10)||'내용:' END) FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO AND ROWNUM = 1)||A.CONTENT AS CONTENT             , A.REQ_USR              , A.TEL_NO             , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                     THEN A.PROC_TYPE                     ELSE C.PROC_TYPE                          --(CASE C.PROC_TYPE                          --      WHEN '1' THEN '0' --미획인                          --      WHEN '2' THEN '7' --처리중                          --      WHEN '3' THEN '1' --완료                          --      WHEN '9' THEN '1' --공유완료                          --      WHEN '4' THEN '8' --보류                          --      ELSE ''                          -- END)                END) AS PROC_TYPE             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T02' AND Z.COMN_CD = (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                                                                                                     THEN A.PROC_TYPE                                                                                                     ELSE C.PROC_TYPE                                                                                                          --(CASE C.PROC_TYPE                                                                                                          --      WHEN '1' THEN '0' --미획인                                                                                                          --      WHEN '2' THEN '7' --처리중                                                                                                          --      WHEN '3' THEN '1' --완료                                                                                                          --      WHEN '9' THEN '1' --공유완료                                                                                                          --      WHEN '4' THEN '8' --보류                                                                                                          --      ELSE ''                                                                                                          -- END)                                                                                                END)) AS PROC_TYPE_NM             --, A.PROC_TYPE              , A.REQ_TYPE             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T05' AND Z.COMN_CD = A.REQ_TYPE) AS REQ_TYPE_NM             , A.REQ_TYPE2             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T09' AND Z.COMN_CD = A.REQ_TYPE2) AS REQ_TYPE2_NM             , A.PRIORITY             , (CASE WHEN  C.SEQ IS NULL                      THEN NVL((SELECT Z.USR_ID FROM CRM_USR_MST Z WHERE Z.LOC_NM = A.WORK_USR AND ROWNUM = 1),A.WORK_USR)                     ELSE C.USR_ID                 END) AS WORK_USR             --, (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL             --        THEN NVL(A.WORK_USR,(SELECT MAX(Z.LOC_NM) FROM CRM_USR_MST Z WHERE Z.USR_ID = C.USR_ID))             --        ELSE (SELECT MAX(Z.LOC_NM) FROM CRM_USR_MST Z WHERE Z.USR_ID = C.USR_ID)             --   END) AS WORK_USR_NM             --, (SELECT MAX(Z.LOC_NM) FROM CRM_USR_MST Z WHERE Z.USR_ID = C.USR_ID) AS WORK_USR_NM             , (CASE WHEN C.USR_ID IS NOT NULL THEN (SELECT MAX(Z.LOC_NM) FROM CRM_USR_MST Z WHERE Z.USR_ID = C.USR_ID) ELSE A.WORK_USR END)  AS WORK_USR_NM             , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                     THEN A.PRAR_YMD                     ELSE C.PRAR_YMD                END) AS PRAR_YMD                          , A.CMPT_YMD             , UFN_FORMAT(A.CMPT_HM,'TIME') AS CMPT_HM             , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                     THEN UFN_FORMAT(A.CMPT_YMD,'DATE')||' '||UFN_FORMAT(A.CMPT_HM,'TIME')                     ELSE UFN_FORMAT(C.CMPT_YMD,'DATE')||' '||UFN_FORMAT(C.CMPT_HM,'TIME')                END) AS CMPT_DATE             --, UFN_FORMAT(A.CMPT_YMD,'DATE')||' '||UFN_FORMAT(A.CMPT_HM,'TIME') AS CMPT_DATE             , A.RMK             , A.CMPT_RMK             , A.INS_USR             , A.FREE_YN             , CASE WHEN (SELECT COUNT(X.MNGT_NO)                            FROM COM_DOC_MST X                           WHERE X.MNGT_NO = A.MNGT_NO) >= 1                    THEN 'Y'                    ELSE 'N'               END AS FILE_YN             , A.SYS_ID              , A.SYS_ID AS SYS_NM                       , NVL((CASE WHEN C.SEQ = 0 OR C.SEQ IS NULL                     THEN (SELECT WM_CONCAT(CD_NM)                              FROM CRM_AS_MST_SHARE X , MDM_COM_CODE X1                            WHERE EXCEPT_YN = 'N'                              AND X1.GRP_CD= 'C03'                                AND X1.COMN_CD = X.DEPT_CD                              AND X.MNGT_NO = A.MNGT_NO) END)                    ,(SELECT X.DEPT_CD FROM CRM_AS_MST X WHERE X.ORGN_MNGT_NO = 'YJITS2019021997' AND ROWNUM = 1)) AS SHARE_DEPT             --, (SELECT WM_CONCAT(CD_NM)              --     FROM CRM_AS_MST_SHARE X , MDM_COM_CODE X1             --    WHERE EXCEPT_YN = 'N'             --      AND X1.GRP_CD= 'C03'               --      AND X1.COMN_CD = X.DEPT_CD             --      AND X.MNGT_NO = A.MNGT_NO) AS SHARE_DEPT             , UFN_FORMAT(A.INS_YMD,'DATE')||' '||UFN_FORMAT(A.INS_HM,'TIME') AS INS_DATE             , A.EDU_LV             , (CASE WHEN A.DEV_CMPT_YMD IS NULL THEN 'N'                     WHEN A.PROC_TYPE NOT IN ('1','8') AND A.DEV_CMPT_YMD IS NOT NULL THEN 'Y'                     ELSE 'N'                END) DEV_CMPT_YN             , (SELECT MAX(CASE WHEN Z.RETURN_YN = 'Y' AND Z.DEPT_CD <> '@DEPT_CD' AND A.DEPT_CD = '@DEPT_CD' THEN '반려'                                WHEN Z.DEPT_CD = '@DEPT_CD' AND Z.RETURN_YN = 'A' THEN '재확인'                                ELSE ''                           END)                  FROM CRM_AS_MST_SHARE Z                 WHERE Z.MNGT_NO = A.MNGT_NO) AS RETURN_YN             ,( SELECT REPLACE( WM_CONCAT( REPLACE (  UFN_GET_COM_INFO('T07',NVL(X.PROC_TYPE,'01'),'OPT_ITEM1') || ':'                                || '  '   ||    ( SELECT LOC_NM                                                    FROM CRM_USR_MST A                                                   WHERE A.USR_ID  = X.USR_ID )                                 ||  CHR(13) || CHR(10)                                 ||   X.DEV_CONTENT, ',' ,'^!' ) ) ,',' , CHR(13) || CHR(10) ||  CHR(13) || CHR(10)  ) AS DEV_CONTENT                  FROM CRM_AS_MST_WORK X                 WHERE X.MNGT_NO = A.MNGT_NO AND X.SEQ <> 0) AS WORK_CONTENT             , (SELECT WM_CONCAT(DISTINCT Z.SALES_NM) FROM CRM_CUST_SVC Z WHERE Z.CUST_CD = A.CUST_CD AND Z.SALES_NM IS NOT NULL) AS SALES_NM             --, (SELECT WM_CONCAT(DISTINCT (SELECT X.CD_NM FROM MDM_COM_CODE X WHERE X.GRP_CD = 'C01' AND X.COMN_CD = Z.SVC_CD)) FROM CRM_CUST_SVC Z WHERE Z.CUST_CD = A.CUST_CD AND Z.SVC_CD IS NOT NULL) AS SVC_NM             --, (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL             --        THEN (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'C03' AND Z.COMN_CD = A.DEPT_CD)             --        ELSE (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'C03' AND Z.COMN_CD = C.DEPT_CD)             --   END) AS DEPT_NM             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'C03' AND Z.COMN_CD = (CASE WHEN C.DEPT_CD IS NOT NULL THEN C.DEPT_CD ELSE A.DEPT_CD END)) AS DEPT_NM             , 1 AS REQ_COUNT             , A.EX_IM_TYPE             , (CASE WHEN A.EX_IM_TYPE = 'I' THEN '내근'                     WHEN A.EX_IM_TYPE = 'E' THEN '외근'                     ELSE A.EX_IM_TYPE                END) AS EX_IM_TYPE_NM             , (CASE WHEN C.SEQ = 0 OR C.SEQ IS NULL                     THEN A.RANK                     ELSE C.RANK               END)AS RANK             , TO_NUMBER(NVL(S.OPT_ITEM10,1)+NVL(S1.OPT_ITEM10,0)) AS SCORE_UNIT             , TO_NUMBER(NVL(S3.OPT_ITEM10,1)) AS SCORE_RANK             , TO_NUMBER(NVL(S2.OPT_ITEM10,1)) AS SCORE_EXIM             , TO_NUMBER(NVL(S.OPT_ITEM10,1)+NVL(S1.OPT_ITEM10,0)+NVL(S2.OPT_ITEM10,1)+NVL(S3.OPT_ITEM10,1)) AS SCORE_TOT          FROM CRM_AS_MST A                 LEFT OUTER JOIN CRM_AS_MST_WORK C                       ON A.MNGT_NO = C.MNGT_NO               LEFT OUTER JOIN MDM_COM_CODE S                       ON A.REQ_SVC = S.OPT_ITEM1 AND A.REQ_SVC2 = S.COMN_CD                      AND S.GRP_CD = 'T10'               LEFT OUTER JOIN MDM_COM_CODE S1                       ON A.REQ_SVC = S1.COMN_CD                       AND S1.GRP_CD = 'T02'                      AND NOT EXISTS (SELECT '' FROM MDM_COM_CODE Z WHERE Z.GRP_CD = S1.GRP_CD AND Z.OPT_ITEM1 = S1.COMN_CD AND Z.GRP_CD = 'T10')               LEFT OUTER JOIN MDM_COM_CODE S2                       ON A.EX_IM_TYPE = S2.COMN_CD AND S2.GRP_CD IN ('T14')               LEFT OUTER JOIN MDM_COM_CODE S3                       ON A.RANK = S3.COMN_CD AND S3.GRP_CD IN ('T15')         WHERE 1 = 1            [REQ_YMD]                    [FM_YMD]                       AND A.REQ_YMD >= '@FM_YMD'                    [/FM_YMD]                    [TO_YMD]                       AND A.REQ_YMD <= '@TO_YMD'                    [/TO_YMD]            [/REQ_YMD]                 [CMPT_YMD]                     [FM_YMD]                       --AND A.CMPT_YMD >= '@FM_YMD'                       AND (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN A.CMPT_YMD ELSE C.CMPT_YMD END) >= '@FM_YMD'                    [/FM_YMD]                    [TO_YMD]                       --AND A.CMPT_YMD <= '@TO_YMD'                       AND (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN A.CMPT_YMD ELSE C.CMPT_YMD END) <= '@TO_YMD'                    [/TO_YMD]            [/CMPT_YMD]                [DEPT_CD]              [DEPT_TYPE_I]                AND A.DEPT_CD = '@DEPT_CD'              [/DEPT_TYPE_I]              [DEPT_TYPE_W]                --YJITS2018095924 문제되어 변경                --AND EXISTS (SELECT Z.MNGT_NO FROM CRM_AS_MST_WORK Z WHERE Z.MNGT_NO = A.MNGT_NO AND Z.SEQ = 0 AND Z.DEPT_CD = '@DEPT_CD')                AND NVL(C.DEPT_CD, A.DEPT_CD) = '@DEPT_CD'              [/DEPT_TYPE_W]            [/DEPT_CD]            [DEPT_AUTH]              AND A.MNGT_NO IN (                                 SELECT MNGT_NO                                   FROM CRM_AS_MST_SHARE                                 WHERE DEPT_CD = '@DEPT_AUTH'                                   AND EXCEPT_YN = 'N'                                )              [/DEPT_AUTH]            [CUST_CD]               AND A.CUST_CD = '@CUST_CD'            [/CUST_CD]            [WORK_TYPE_W]              [WORK_USR]                 AND (A.WORK_USR = (SELECT MAX(Z.LOC_NM) FROM CRM_USR_MST Z WHERE Z.USR_ID = '@WORK_USR')	                  OR C.USR_ID = '@WORK_USR'	                 )              [/WORK_USR]            [/WORK_TYPE_W]            [WORK_TYPE_I]              [WORK_USR]                 AND A.INS_USR = '@WORK_USR'               [/WORK_USR]            [/WORK_TYPE_I]            [SEARCH_KEY]               AND ( 1 != 1               OR A.CUST_CD LIKE '%@SEARCH_KEY%'               OR A.TEL_NO LIKE '%@SEARCH_KEY%'               OR A.REQ_USR LIKE '%@SEARCH_KEY%'               OR A.MNGT_NO LIKE '%@SEARCH_KEY%'               OR A.CONTENT LIKE '%@SEARCH_KEY%'               OR A.MNGT_NO IN (SELECT MNGT_NO                                  FROM CRM_AS_MST_WORK                                 WHERE USR_ID IN (SELECT VALUE1                                  FROM TABLE(  UFN_GET_INFO('USER_LIST','%@SEARCH_KEY%')))  )               OR EXISTS (SELECT Z.CUST_CD                                     FROM CRM_CUST_MST Z                                    WHERE Z.CUST_CD = A.CUST_CD                                     AND (    Z.CUSTOMS_CD LIKE '%@SEARCH_KEY%'                                           OR Z.CUST_NM LIKE '%@SEARCH_KEY%'                                           OR Z.CUST_LOC_NM LIKE '%@SEARCH_KEY%'                                           OR Z.DOMAIN LIKE '%@SEARCH_KEY%'                                              )                              )              )            [/SEARCH_KEY]            [REQ_SVC]               AND A.REQ_SVC = '@REQ_SVC'            [/REQ_SVC]            [REQ_SVC2]               AND A.REQ_SVC2 = '@REQ_SVC2'            [/REQ_SVC2]            [REQ_TYPE2]               AND A.REQ_TYPE2 = '@REQ_TYPE2'            [/REQ_TYPE2]            [PROC_TYPE]               --AND A.PROC_TYPE IN ('@PROC_TYPE')               AND (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                         THEN A.PROC_TYPE                         ELSE C.PROC_TYPE                              --(CASE C.PROC_TYPE                              --      WHEN '1' THEN '0' --미획인                              --      WHEN '2' THEN '7' --처리중                              --      WHEN '3' THEN '1' --완료                              --      WHEN '9' THEN '1' --공유완료                              --      WHEN '4' THEN '8' --보류                              --      ELSE ''                              -- END)                    END) IN ('@PROC_TYPE')            [/PROC_TYPE]            [FIRST_DATA_Y]             --AND (C.SEQ = '0' OR C.SEQ IS NULL)             --AND A.ORGN_MNGT_NO IS NULL             --AND (A.UPPER_MNGT_NO IS NOT NULL OR ((C.SEQ = '0' OR C.SEQ IS NULL) AND A.ORGN_MNGT_NO IS NULL))             AND A.ORGN_MNGT_NO IS NULL AND (C.SEQ = '0' OR C.SEQ IS NULL)            [/FIRST_DATA_Y]            [EX_IM_TYPE]              AND EX_IM_TYPE = '@EX_IM_TYPE'            [/EX_IM_TYPE]            ) AORDER BY A.REQ_YMD DESC, A.REQ_HM DESC, A.SEQ DESC, A.MNGT_NO DESC
#CrmAsList@Search_20231010
--CrmAsList@Search        SELECT A.*             , (CASE WHEN ONLINE_YN IN ('Y','N','A') THEN 'X' ELSE 'P' END) AS SELF_PROC_YN             --, NVL((SELECT 'Y' FROM EVB_MEMB_SET Z INNER JOIN CRM_CUST_MST X ON X.CUST_CD = Z.CRM_CD WHERE MEMB_STATE IN ('A','E','S') AND X.CUST_CD = A.CUST_CD AND ROWNUM = 1),'N') AS ELVIS_BILL_YN              --, DECODE( Z.CRM_CD,NULL,'N','Y') AS ELVIS_BILL_YN          FROM VT_CRM_AS_MST A            --LEFT JOIN EVB_MEMB_SET Z ON A.CUST_CD = Z.CRM_CD AND Z.MEMB_STATE = 'S'         WHERE 1 = 1            [REQ_YMD]                    [FM_YMD]                       AND A.REQ_YMD >= '@FM_YMD'                    [/FM_YMD]                    [TO_YMD]                       AND A.REQ_YMD <= '@TO_YMD'                    [/TO_YMD]            [/REQ_YMD]                 [CMPT_YMD]                     [FM_YMD]                       --AND A.CMPT_YMD >= '@FM_YMD'                       AND (CASE WHEN A.SEQ = '0' OR A.SEQ IS NULL THEN A.CMPT_YMD ELSE A.CMPT_YMD END) >= '@FM_YMD'                    [/FM_YMD]                    [TO_YMD]                       --AND A.CMPT_YMD <= '@TO_YMD'                       AND (CASE WHEN A.SEQ = '0' OR A.SEQ IS NULL THEN A.CMPT_YMD ELSE A.CMPT_YMD END) <= '@TO_YMD'                    [/TO_YMD]            [/CMPT_YMD]                [DEPT_CD]              [DEPT_TYPE_I]                AND A.DEPT_CD = '@DEPT_CD'              [/DEPT_TYPE_I]              [DEPT_TYPE_W]                --YJITS2018095924 문제되어 변경                --AND EXISTS (SELECT Z.MNGT_NO FROM CRM_AS_MST_WORK Z WHERE Z.MNGT_NO = A.MNGT_NO AND Z.SEQ = 0 AND Z.DEPT_CD = '@DEPT_CD')                AND NVL(A.DEV_DEPT_CD, A.DEPT_CD) = '@DEPT_CD'              [/DEPT_TYPE_W]              [DEPT_TYPE_M]                AND A.DEPT_CD IN ('@DEPT_CD')              [/DEPT_TYPE_M]            [/DEPT_CD]            [DEPT_AUTH]              AND A.MNGT_NO IN (                                 SELECT MNGT_NO                                   FROM CRM_AS_MST_SHARE                                 WHERE DEPT_CD = '@DEPT_AUTH'                                   AND EXCEPT_YN = 'N'                                )              [/DEPT_AUTH]            [CUST_CD]               AND A.CUST_CD = '@CUST_CD'            [/CUST_CD]            [WORK_TYPE_W]              [WORK_USR]                 --20220726 김성은 COST가 높아서 VT_CRM_AS_MST과 함께 변경                 --AND (A.WORK_USR = (SELECT MAX(Z.LOC_NM) FROM CRM_USR_MST Z WHERE Z.USR_ID = '@WORK_USR')                 --     OR A.WORK_USR = '@WORK_USR'                 --    )                 AND (A.WORK_USR = (SELECT MAX(Z.USR_ID) FROM CRM_USR_MST Z WHERE Z.LOC_NM = '@WORK_USR' AND USE_YN = 'Y')                      OR A.WORK_USR = '@WORK_USR'                     )              [/WORK_USR]            [/WORK_TYPE_W]            [WORK_TYPE_I]              [WORK_USR]                 AND A.INS_USR = '@WORK_USR'               [/WORK_USR]            [/WORK_TYPE_I]            [SEARCH_KEY]               AND ( 1 != 1               OR A.CUST_CD LIKE '%@SEARCH_KEY%'               OR A.TEL_NO LIKE '%@SEARCH_KEY%'               OR A.REQ_USR LIKE '%@SEARCH_KEY%'               OR A.MNGT_NO LIKE '%@SEARCH_KEY%'               OR A.CONTENT LIKE '%@SEARCH_KEY%'               OR A.MNGT_NO IN (SELECT MNGT_NO                                  FROM CRM_AS_MST_WORK                                 WHERE USR_ID IN (SELECT VALUE1                                  FROM TABLE(  UFN_GET_INFO('USER_LIST','%@SEARCH_KEY%')))  )               OR EXISTS (SELECT Z.CUST_CD                                     FROM CRM_CUST_MST Z                                    WHERE Z.CUST_CD = A.CUST_CD                                     AND (    Z.CUSTOMS_CD LIKE '%@SEARCH_KEY%'                                           OR Z.CUST_NM LIKE '%@SEARCH_KEY%'                                           OR Z.CUST_LOC_NM LIKE '%@SEARCH_KEY%'                                           OR Z.DOMAIN LIKE '%@SEARCH_KEY%'                                              )                              )              )            [/SEARCH_KEY]            [REQ_SVC]               AND A.REQ_SVC = '@REQ_SVC'            [/REQ_SVC]            [REQ_SVC2]               AND A.REQ_SVC2 = '@REQ_SVC2'            [/REQ_SVC2]            [REQ_TYPE2]               AND A.REQ_TYPE2 = '@REQ_TYPE2'            [/REQ_TYPE2]            [PROC_TYPE]               --AND A.PROC_TYPE IN ('@PROC_TYPE')               AND (CASE WHEN A.SEQ = '0' OR A.SEQ IS NULL                         THEN A.PROC_TYPE                         ELSE A.PROC_TYPE                              --(CASE C.PROC_TYPE                              --      WHEN '1' THEN '0' --미획인                              --      WHEN '2' THEN '7' --처리중                              --      WHEN '3' THEN '1' --완료                              --      WHEN '9' THEN '1' --공유완료                              --      WHEN '4' THEN '8' --보류                              --      ELSE ''                              -- END)                    END) IN ('@PROC_TYPE')            [/PROC_TYPE]            [FIRST_DATA_Y]             --AND (C.SEQ = '0' OR C.SEQ IS NULL)             --AND A.ORGN_MNGT_NO IS NULL             --AND (A.UPPER_MNGT_NO IS NOT NULL OR ((C.SEQ = '0' OR C.SEQ IS NULL) AND A.ORGN_MNGT_NO IS NULL))             AND A.ORGN_MNGT_NO IS NULL AND (A.SEQ = '0' OR A.SEQ IS NULL)            [/FIRST_DATA_Y]            [EX_IM_TYPE]              AND EX_IM_TYPE = '@EX_IM_TYPE'            [/EX_IM_TYPE]            [PROJECT_CD]              AND PROJECT_CD = '@PROJECT_CD'            [/PROJECT_CD]            [SELF_PROC_Y]              AND ONLINE_YN = 'P'            [/SELF_PROC_Y]            [SELF_PROC_N]              AND ONLINE_YN <> 'P'            [/SELF_PROC_N]ORDER BY A.REQ_YMD DESC, A.REQ_HM DESC, A.SEQ DESC, A.MNGT_NO DESC
#CrmAsList@Search_test
--CrmAsList@SearchWITH W_REQ_SVC_SCOREAS(    SELECT A.COMN_CD AS COMN_CD         , A.CD_NM AS CD_NM         , B.COMN_CD AS COMN_CD2         , B.CD_NM AS CD_NM2         , CASE WHEN B.OPT_ITEM10 IS NULL THEN 1                ELSE TO_NUMBER(B.OPT_ITEM10)           END AS SCORE    FROM MDM_COM_CODE A         LEFT OUTER JOIN MDM_COM_CODE B         ON A.COMN_CD = B.OPT_ITEM1 AND B.GRP_CD = 'T10'     WHERE A.GRP_CD = 'T02'    ORDER BY A.COMN_CD, B.COMN_CD     )SELECT DISTINCT * FROM (        SELECT A.MNGT_NO             , NVL(C.SEQ,0) AS SEQ             , A.REQ_YMD             , UFN_FORMAT(A.REQ_HM,'TIME') AS REQ_HM             , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                     THEN UFN_FORMAT(A.REQ_YMD,'DATE')||' '||UFN_FORMAT(A.REQ_HM,'TIME')                     ELSE UFN_FORMAT(C.REQ_YMD,'DATE')||' '||UFN_FORMAT(C.REQ_HM,'TIME')                END) AS REQ_DATE              --, UFN_FORMAT(A.REQ_YMD,'DATE')||' '||UFN_FORMAT(A.REQ_HM,'TIME') AS REQ_DATE             , A.REQ_SVC             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T02' AND Z.COMN_CD = A.REQ_SVC) AS REQ_SVC_NM             , A.REQ_SVC2             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T10' AND Z.COMN_CD = A.REQ_SVC2) AS REQ_SVC2_NM             , A.CUST_CD             , (SELECT Z.CUST_LOC_NM FROM CRM_CUST_MST Z WHERE Z.CUST_CD = A.CUST_CD) AS CUST_NM             , (SELECT (CASE WHEN Z.SUBJECT IS NOT NULL THEN '제목:'||TRIM(Z.SUBJECT)||CHR(13)||CHR(10)||'내용:' END) FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO)||A.CONTENT AS CONTENT             , A.REQ_USR              , A.TEL_NO             , (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                     THEN A.PROC_TYPE                     ELSE (CASE C.PROC_TYPE                                 WHEN '1' THEN '0' --미획인                                WHEN '2' THEN '7' --처리중                                WHEN '3' THEN '1' --완료                                WHEN '9' THEN '1' --공유완료                                WHEN '4' THEN '8' --보류                                ELSE ''                           END)                END) AS PROC_TYPE             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T02' AND Z.COMN_CD = (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                                                                                                     THEN A.PROC_TYPE                                                                                                     ELSE (CASE C.PROC_TYPE                                                                                                                 WHEN '1' THEN '0' --미획인                                                                                                                WHEN '2' THEN '7' --처리중                                                                                                                WHEN '3' THEN '1' --완료                                                                                                                WHEN '9' THEN '1' --공유완료                                                                                                                WHEN '4' THEN '8' --보류                                                                                                                ELSE ''                                                                                                           END)                                                                                                END)) AS PROC_TYPE_NM             --, A.PROC_TYPE              , A.REQ_TYPE             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T05' AND Z.COMN_CD = A.REQ_TYPE) AS REQ_TYPE_NM             , A.REQ_TYPE2             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T09' AND Z.COMN_CD = A.REQ_TYPE2) AS REQ_TYPE2_NM             , A.PRIORITY             , (SELECT MAX(Z.USR_ID) FROM CRM_USR_MST Z WHERE Z.LOC_NM = A.WORK_USR) AS WORK_USR_NM             , A.WORK_USR AS WORK_USR             , A.PRAR_YMD             , A.CMPT_YMD             , UFN_FORMAT(A.CMPT_HM,'TIME') AS CMPT_HM             , UFN_FORMAT(A.CMPT_YMD,'DATE')||' '||UFN_FORMAT(A.CMPT_HM,'TIME') AS CMPT_DATE             --, UFN_FORMAT(A.CMPT_YMD,'DATE')||' '||UFN_FORMAT(A.CMPT_HM,'TIME') AS CMPT_DATE             , A.RMK             , A.CMPT_RMK             , A.INS_USR             , A.FREE_YN             , A.SYS_ID              , A.SYS_ID AS SYS_NM                       , UFN_FORMAT(A.INS_YMD,'DATE')||' '||UFN_FORMAT(A.INS_HM,'TIME') AS INS_DATE             , A.EDU_LV             , CASE WHEN (SELECT COUNT(X.MNGT_NO)                            FROM COM_DOC_MST X                           WHERE X.MNGT_NO = A.MNGT_NO) >= 1                    THEN 'Y'                    ELSE 'N'               END AS FILE_YN                            , (CASE WHEN C.SEQ = 0 OR C.SEQ IS NULL                     THEN (SELECT WM_CONCAT(CD_NM)                              FROM CRM_AS_MST_SHARE X , MDM_COM_CODE X1                            WHERE EXCEPT_YN = 'N'                              AND X1.GRP_CD= 'C03'                                AND X1.COMN_CD = X.DEPT_CD                              AND X.MNGT_NO = A.MNGT_NO)                END)AS SHARE_DEPT             , (CASE WHEN A.DEV_CMPT_YMD IS NULL THEN 'N'                     WHEN A.PROC_TYPE NOT IN ('1','8') AND A.DEV_CMPT_YMD IS NOT NULL THEN 'Y'                     ELSE 'N'                END) DEV_CMPT_YN                --             , (SELECT MAX(CASE WHEN Z.RETURN_YN = 'Y' AND Z.DEPT_CD <> '@DEPT_CD' AND A.DEPT_CD = '@DEPT_CD' THEN '반려'--                                WHEN Z.DEPT_CD = '@DEPT_CD' AND Z.RETURN_YN = 'A' THEN '재확인'--                                ELSE ''--                           END)--                  FROM CRM_AS_MST_SHARE Z--                 WHERE Z.MNGT_NO = A.MNGT_NO) AS RETURN_YN             --             ,( SELECT REPLACE( WM_CONCAT( REPLACE (  UFN_GET_COM_INFO('T07',NVL(X.PROC_TYPE,'01'),'OPT_ITEM1') || ':'--                                || '  '   ||    ( SELECT LOC_NM--                                                    FROM CRM_USR_MST A--                                                   WHERE A.USR_ID  = X.USR_ID ) --                                ||  CHR(13) || CHR(10) --                                ||   X.DEV_CONTENT, ',' ,'^!' ) ) ,',' , CHR(13) || CHR(10) ||  CHR(13) || CHR(10)  ) AS DEV_CONTENT--                  FROM CRM_AS_MST_WORK X--                 WHERE X.MNGT_NO = A.MNGT_NO AND X.SEQ <> 0) AS WORK_CONTENT                              , (SELECT WM_CONCAT(DISTINCT Z.SALES_NM) FROM CRM_CUST_SVC Z WHERE Z.CUST_CD = A.CUST_CD AND Z.SALES_NM IS NOT NULL) AS SALES_NM             --, (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'C03' AND Z.COMN_CD = C.DEPT_CD) AS DEPT_NM             , (SELECT MAX(Z.CD_NM) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'C03' AND Z.COMN_CD = A.DEPT_CD) AS DEPT_NM             , 1 AS REQ_COUNT             , A.EX_IM_TYPE             , (CASE WHEN A.EX_IM_TYPE = 'I' THEN '내근'                     WHEN A.EX_IM_TYPE = 'E' THEN '외근'                     ELSE A.EX_IM_TYPE                END) AS EX_IM_TYPE_NM             , A.RANK             , (CASE WHEN A.EX_IM_TYPE = 'E' THEN S.SCORE * 2                     ELSE S.SCORE                END) AS SCORE          FROM CRM_AS_MST A                 --LEFT OUTER JOIN CRM_AS_MST_WORK C               --        ON A.MNGT_NO = C.MNGT_NO               LEFT OUTER JOIN W_REQ_SVC_SCORE S                       ON ((A.REQ_SVC = S.COMN_CD AND A.REQ_SVC2 = S.COMN_CD2) OR (A.REQ_SVC = S.COMN_CD AND A.REQ_SVC2 IS NULL))         WHERE 1 = 1            [REQ_YMD]                    [FM_YMD]                       AND A.REQ_YMD >= '@FM_YMD'                    [/FM_YMD]                    [TO_YMD]                       AND A.REQ_YMD <= '@TO_YMD'                    [/TO_YMD]            [/REQ_YMD]                 [CMPT_YMD]                     [FM_YMD]                       --AND A.CMPT_YMD >= '@FM_YMD'                       AND (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN A.CMPT_YMD ELSE C.CMPT_YMD END) >= '@FM_YMD'                    [/FM_YMD]                    [TO_YMD]                       --AND A.CMPT_YMD <= '@TO_YMD'                       AND (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL THEN A.CMPT_YMD ELSE C.CMPT_YMD END) <= '@TO_YMD'                    [/TO_YMD]            [/CMPT_YMD]                [DEPT_CD]              [DEPT_TYPE_I]                AND A.DEPT_CD = '@DEPT_CD'              [/DEPT_TYPE_I]              [DEPT_TYPE_W]                --YJITS2018095924 문제되어 변경                --AND EXISTS (SELECT Z.MNGT_NO FROM CRM_AS_MST_WORK Z WHERE Z.MNGT_NO = A.MNGT_NO AND Z.SEQ = 0 AND Z.DEPT_CD = '@DEPT_CD')                AND C.DEPT_CD = '@DEPT_CD'              [/DEPT_TYPE_W]            [/DEPT_CD]            [DEPT_AUTH]              AND A.MNGT_NO IN (                                 SELECT MNGT_NO                                   FROM CRM_AS_MST_SHARE                                 WHERE DEPT_CD = '@DEPT_AUTH'                                   AND EXCEPT_YN = 'N'                                )              [/DEPT_AUTH]            [CUST_CD]               AND A.CUST_CD = '@CUST_CD'            [/CUST_CD]            [WORK_TYPE_W]              [WORK_USR]                 AND C.USR_ID = '@WORK_USR'              [/WORK_USR]            [/WORK_TYPE_W]            [WORK_TYPE_I]              [WORK_USR]                 AND A.INS_USR = '@WORK_USR'               [/WORK_USR]            [/WORK_TYPE_I]            [SEARCH_KEY]               AND ( 1 != 1               OR A.CUST_CD LIKE '%@SEARCH_KEY%'               OR A.TEL_NO LIKE '%@SEARCH_KEY%'               OR A.REQ_USR LIKE '%@SEARCH_KEY%'               OR A.MNGT_NO LIKE '%@SEARCH_KEY%'               OR A.CONTENT LIKE '%@SEARCH_KEY%'               OR A.MNGT_NO IN (SELECT MNGT_NO                                  FROM CRM_AS_MST_WORK                                 WHERE USR_ID IN (SELECT VALUE1                                  FROM TABLE(  UFN_GET_INFO('USER_LIST','%@SEARCH_KEY%')))  )               OR EXISTS (SELECT Z.CUST_CD                                     FROM CRM_CUST_MST Z                                    WHERE Z.CUST_CD = A.CUST_CD                                     AND (    Z.CUSTOMS_CD LIKE '%@SEARCH_KEY%'                                           OR Z.CUST_NM LIKE '%@SEARCH_KEY%'                                           OR Z.CUST_LOC_NM LIKE '%@SEARCH_KEY%'                                           OR Z.DOMAIN LIKE '%@SEARCH_KEY%'                                              )                              )              )            [/SEARCH_KEY]            [REQ_SVC]               AND A.REQ_SVC = '@REQ_SVC'            [/REQ_SVC]            [REQ_SVC2]               AND A.REQ_SVC2 = '@REQ_SVC2'            [/REQ_SVC2]            [REQ_TYPE2]               AND A.REQ_TYPE2 = '@REQ_TYPE2'            [/REQ_TYPE2]            [PROC_TYPE]               --AND A.PROC_TYPE IN ('@PROC_TYPE')               AND (CASE WHEN C.SEQ = '0' OR C.SEQ IS NULL                         THEN A.PROC_TYPE                         ELSE (CASE C.PROC_TYPE                                     WHEN '1' THEN '0' --미획인                                    WHEN '2' THEN '7' --처리중                                    WHEN '3' THEN '1' --완료                                    WHEN '9' THEN '1' --공유완료                                    WHEN '4' THEN '8' --보류                                    ELSE ''                               END)                    END) IN ('@PROC_TYPE')            [/PROC_TYPE]            [FIRST_DATA_Y]              AND (C.SEQ = '0' OR C.SEQ IS NULL)              AND A.ORGN_MNGT_NO IS NULL            [/FIRST_DATA_Y]            [EX_IM_TYPE]              AND EX_IM_TYPE = '@EX_IM_TYPE'            [/EX_IM_TYPE]            ) AORDER BY A.REQ_YMD DESC, A.REQ_HM DESC, A.SEQ DESC, A.MNGT_NO DESC
#CrmAsList@SearchScore
--CrmAsList@SearchScoreSELECT A.GRP_CD     , A.COMN_CD AS COMN_CD     , (SELECT Z.CD_NM || '-'           FROM MDM_COM_CODE Z          WHERE Z.GRP_CD = (CASE '@GRP_CD' WHEN 'T10' THEN 'T02' WHEN 'Z02' THEN 'Z01' END)            AND Z.COMN_CD = A.OPT_ITEM1) || A.CD_NM AS CD_NM     , NVL(A.OPT_ITEM10,0) AS OPT_ITEM10     , (SELECT B.LOC_NM FROM CRM_USR_MST B WHERE B.USR_ID = A.INS_USR) AS INS_USR     , TO_CHAR(TO_DATE(A.INS_YMD,'YYYYMMDD'),'YYYY-MM-DD') || ' ' ||       TO_CHAR(TO_DATE(A.INS_HM,'HH24MISS'), 'HH24:MI:SS') AS INS_YMD     , (SELECT B.LOC_NM FROM CRM_USR_MST B WHERE B.USR_ID = A.UPD_USR) AS UPD_USR     , TO_CHAR(TO_DATE(A.UPD_YMD,'YYYYMMDD'),'YYYY-MM-DD') || ' ' ||       TO_CHAR(TO_DATE(A.UPD_HM,'HH24MISS'), 'HH24:MI:SS') AS UPD_YMD FROM MDM_COM_CODE AWHERE 1 = 1[GRP_CD]  AND A.GRP_CD = '@GRP_CD'[/GRP_CD]ORDER BY A.GRP_CD, A.COMN_CD
#CrmAsList@SearchScore_20190213
--CrmAsList@SearchScoreSELECT A.GRP_CD     , A.COMN_CD AS COMN_CD     , A.CD_NM AS CD_NM     , B.COMN_CD AS COMN_CD2     , B.CD_NM AS CD_NM2     , CASE WHEN B.OPT_ITEM10 IS NULL THEN 1            ELSE TO_NUMBER(B.OPT_ITEM10)       END AS SCORE FROM MDM_COM_CODE A      LEFT OUTER JOIN MDM_COM_CODE B              ON (CASE A.GRP_CD                        WHEN 'Z01' THEN 'Z02'                       WHEN 'T02' THEN 'T10'                       ELSE A.GRP_CD END) = B.GRP_CD             AND A.COMN_CD = B.OPT_ITEM1WHERE 1 = 1[GRP_CD]  AND A.GRP_CD = '@GRP_CD'[/GRP_CD]ORDER BY A.GRP_CD, A.COMN_CD, B.COMN_CD 
