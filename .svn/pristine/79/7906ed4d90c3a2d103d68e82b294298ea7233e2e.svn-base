#CrmDevAsList@Search
-- CrmDevAsList@SearchSELECT A.DEPT_CD     , A.SORT     , A.WORK_USER     , SUM(WEEK_REQ) AS WEEK_REQ     , SUM(WEEK_CMPT) AS WEEK_CMPT     , SUM(WEEK_SCORE) AS WEEK_SCORE     , CASE WHEN SUM(WEEK_CMPT) = 0 THEN 0 ELSE ROUND(SUM(WEEK_SCORE)/SUM(WEEK_CMPT),1) END AS WEEK_AVG     , CASE WHEN SUM(WEEK_REQ) = 0 THEN 0 ELSE ROUND((SUM(WEEK_CMPT)/SUM(WEEK_REQ)*100),1) END AS WEEK_PER     , SUM(SUM_REQ) AS SUM_REQ     , SUM(SUM_CMPT) AS SUM_CMPT     , SUM(SUM_SCORE) AS SUM_SCORE     , CASE WHEN SUM(SUM_CMPT) = 0 THEN 0 ELSE ROUND(SUM(SUM_SCORE)/SUM(SUM_CMPT),1) END AS SUM_AVG     , CASE WHEN SUM(SUM_REQ) = 0 THEN 0 ELSE ROUND((SUM(SUM_CMPT)/SUM(SUM_REQ)*100),1) END AS SUM_PER  FROM (        -- 접수건수         SELECT U.LOC_NM AS WORK_USER             , C.DEPT_CD             , 1 AS WEEK_REQ              , 0 AS WEEK_CMPT             , 0 AS WEEK_SCORE             , 0 AS SUM_REQ              , 0 AS SUM_CMPT             , 0 AS SUM_SCORE             , U.SORT          FROM CRM_AS_MST A             , CRM_AS_MST_SHARE B             , CRM_AS_MST_WORK C               LEFT OUTER JOIN CRM_USR_MST U                    ON C.USR_ID = U.USR_ID          WHERE A.MNGT_NO = B.MNGT_NO           AND A.MNGT_NO = C.MNGT_NO            AND A.REQ_YMD >= '@FM_YMD' AND A.REQ_YMD <= '@TO_YMD'           AND NOT C.DEPT_CD IN ('01','04')           AND C.SEQ <> 0 
           AND U.USE_YN = 'Y'           [DEPT_CD]               AND C.DEPT_CD = '@DEPT_CD'           [/DEPT_CD]           [WORK_USR]               AND C.USR_ID = '@WORK_USR'           [/WORK_USR]        UNION ALL        -- 주간 완료건         SELECT U.LOC_NM AS WORK_USER             , C.DEPT_CD             , 0 AS WEEK_REQ              , 1 AS WEEK_CMPT             , UFN_AS_SCORE(A.MNGT_NO) AS WEEK_SCORE             , 0 AS SUM_REQ              , 0 AS SUM_CMPT             , 0 AS SUM_SCORE             , U.SORT          FROM CRM_AS_MST A             , CRM_AS_MST_SHARE B             , CRM_AS_MST_WORK C               LEFT OUTER JOIN CRM_USR_MST U                    ON C.USR_ID = U.USR_ID AND U.USE_YN = 'Y'         WHERE A.MNGT_NO = B.MNGT_NO           AND A.MNGT_NO = C.MNGT_NO            AND C.CMPT_YMD >= '@FM_YMD' AND A.REQ_YMD <= '@TO_YMD'           AND NOT C.DEPT_CD IN ('01','04')           AND C.SEQ <> 0
           AND U.USE_YN = 'Y'           [DEPT_CD]               AND C.DEPT_CD = '@DEPT_CD'           [/DEPT_CD]           [WORK_USR]               AND C.USR_ID = '@WORK_USR'           [/WORK_USR]        UNION ALL        -- 누적 건수         SELECT U.LOC_NM AS WORK_USER             , C.DEPT_CD             , 0 AS WEEK_REQ              , 0 AS WEEK_CMPT             , 0 AS WEEK_SCORE             , 1 AS SUM_REQ              , 0 AS SUM_CMPT             , 0 AS SUM_SCORE             , U.SORT          FROM CRM_AS_MST A             , CRM_AS_MST_SHARE B             , CRM_AS_MST_WORK C               LEFT OUTER JOIN CRM_USR_MST U                    ON C.USR_ID = U.USR_ID AND U.USE_YN = 'Y'         WHERE A.MNGT_NO = B.MNGT_NO           AND A.MNGT_NO = C.MNGT_NO            AND A.REQ_YMD >= '@FM_YMD2' AND A.REQ_YMD <= '@TO_YMD2'           AND NOT C.DEPT_CD IN ('01','04')           AND C.SEQ <> 0 
           AND U.USE_YN = 'Y'           [DEPT_CD]               AND C.DEPT_CD = '@DEPT_CD'           [/DEPT_CD]           [WORK_USR]               AND C.USR_ID = '@WORK_USR'           [/WORK_USR]        UNION ALL        -- 주간 완료건         SELECT U.LOC_NM AS WORK_USER             , C.DEPT_CD             , 0 AS WEEK_REQ              , 0 AS WEEK_CMPT             , 0 AS WEEK_SCORE             , 0 AS SUM_REQ              , 1 AS SUM_CMPT             , UFN_AS_SCORE(A.MNGT_NO) AS SUM_SCORE             , U.SORT          FROM CRM_AS_MST A             , CRM_AS_MST_SHARE B             , CRM_AS_MST_WORK C               LEFT OUTER JOIN CRM_USR_MST U                    ON C.USR_ID = U.USR_ID AND U.USE_YN = 'Y'         WHERE A.MNGT_NO = B.MNGT_NO           AND A.MNGT_NO = C.MNGT_NO            AND C.CMPT_YMD >= '@FM_YMD2' AND A.REQ_YMD <= '@TO_YMD2'           AND NOT C.DEPT_CD IN ('01','04')           AND C.SEQ <> 0 
           AND U.USE_YN = 'Y'           [DEPT_CD]               AND C.DEPT_CD = '@DEPT_CD'           [/DEPT_CD]           [WORK_USR]               AND C.USR_ID = '@WORK_USR'           [/WORK_USR]     ) A         GROUP BY A.DEPT_CD,A.SORT,A.WORK_USER  ORDER BY A.DEPT_CD,A.SORT,A.WORK_USER
