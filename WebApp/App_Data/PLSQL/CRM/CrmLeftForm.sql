#CrmLeftForm@Search
--CrmLeftForm@SearchSELECT A.MNGT_NO     , A.WORK_USR     , (SUBSTR(A.REQ_YMD,5,2)||'-'||SUBSTR(A.REQ_YMD,7,2)||' '||SUBSTR(A.REQ_HM,1,2)||':'||SUBSTR(A.REQ_HM,3,2)) AS REQ_DATE     , (SELECT REPLACE(REPLACE(REPLACE(Z.CUST_LOC_NM,'주식회사',''),'(주)',''),'㈜','') FROM CRM_CUST_MST Z WHERE Z.CUST_CD = A.CUST_CD) AS CUST_NM     , ((SELECT (CASE WHEN Z.SUBJECT IS NULL THEN '' ELSE '제목:'||TRIM(Z.SUBJECT)||CHR(13)||CHR(10)||'내용:' END) FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO AND ROWNUM = 1)||A.CONTENT) AS CONTENT     , A.SYS_ID     , (SELECT WM_CONCAT(Z.DEPT_CD) FROM CRM_AS_MST_SHARE Z WHERE Z.EXCEPT_YN = 'N' AND Z.MNGT_NO = A.MNGT_NO) AS SHARE_DEPT     , A.PRIORITY     , A.PROC_TYPE     , (CASE WHEN A.DEV_CMPT_YMD IS NULL THEN 'N'             WHEN A.PROC_TYPE NOT IN ('1','8') AND A.DEV_CMPT_YMD IS NOT NULL THEN 'Y'             ELSE 'N'        END) DEV_CMPT_YN     , A.REQ_SVC     , A.DEPT_CD
     , (  '작업자    : '||CASE WHEN A.WORK_USR IS NOT NULL THEN A.WORK_USR ELSE (SELECT REPLACE( WM_CONCAT( ( SELECT LOC_NM FROM CRM_USR_MST X1 WHERE X1.USR_ID = X.USR_ID)) ,',',', ') FROM CRM_AS_MST_WORK X WHERE X.MNGT_NO = A.MNGT_NO AND X.DEPT_CD = NVL(A.DEPT_CD,'01') AND X.SEQ = 0) END
        ||CHR(13)||CHR(10)||'공유부서  : '||(SELECT WM_CONCAT(CD_NM) FROM CRM_AS_MST_SHARE X, MDM_COM_CODE X1 WHERE EXCEPT_YN = 'N' AND X1.GRP_CD= 'C03' AND X1.COMN_CD = X.DEPT_CD AND X.MNGT_NO = A.MNGT_NO)
        ||CHR(13)||CHR(10)||'공유작업자: '||(SELECT Z.USR_ID FROM CRM_AS_MST_WORK Z WHERE Z.SEQ = 1 AND Z.MNGT_NO = A.MNGT_NO)
        ||CHR(13)||CHR(10)||'상태      : '||(SELECT Z.CD_NM FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T03' AND Z.COMN_CD = A.PROC_TYPE)
        ||CHR(13)||CHR(10)||'요청사항  : '||((SELECT '제목:'||TRIM(Z.SUBJECT)||CHR(13)||CHR(10) FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO)||'내용:'||REPLACE(REPLACE(A.CONTENT,CHR(10),''),CHR(10),CHR(13)||CHR(10)))
       ) AS TOOLTIP
  FROM CRM_AS_MST A         --LEFT OUTER JOIN CRM_AS_MST_WORK B       --        ON A.MNGT_NO = B.MNGT_NO       --       AND NVL(A.DEPT_CD,'05') = A.DEPT_CD       --       AND B.SEQ = 0 WHERE 1 = 1  [REQ_SVC]   AND A.REQ_SVC IN ('@REQ_SVC') [/REQ_SVC] [ONLINE_YN]   AND A.ONLINE_YN = '@ONLINE_YN' [/ONLINE_YN] [ONLINE_Y]   AND A.ONLINE_YN = 'Y'
   AND A.REQ_YMD BETWEEN TO_CHAR(SYSDATE-7,'YYYYMMDD') AND TO_CHAR(SYSDATE+7,'YYYYMMDD')   AND ORGN_MNGT_NO IS NULL   AND DEPT_CD = '01'   --AND DEV_AUTH IS NULL   AND NOT EXISTS (SELECT '' FROM CRM_AS_MST_WORK C WHERE A.MNGT_NO = C.MNGT_NO AND C.SEQ > 0) [/ONLINE_Y] [ONLINE_SHARE_Y]   AND A.ONLINE_YN = 'Y'   AND EXISTS (SELECT C.DEPT_CD FROM CRM_AS_MST_WORK C WHERE A.MNGT_NO = C.MNGT_NO AND C.SEQ = 0 AND C.DEPT_CD = '@WORK_DEPT_CD')   --AND A.DEPT_CD = '@DEPT_CD'   --AND NOT DEV_AUTH IS NULL   AND EXISTS (SELECT '' FROM CRM_AS_MST_WORK C WHERE A.MNGT_NO = C.MNGT_NO AND C.SEQ > 0)   AND NOT EXISTS (SELECT '' FROM CRM_AS_MST C WHERE A.MNGT_NO = C.ORGN_MNGT_NO) [/ONLINE_SHARE_Y] [ASSIGN_Y]   AND A.REQ_YMD >= ADD_MONTHS(SYSDATE,-2) AND A.REQ_YMD <= TO_CHAR(SYSDATE,'YYYYMMDD')   AND A.WORK_USR IS NULL    AND A.ONLINE_YN <> 'Y' [/ASSIGN_Y] [DEPT_CD]   AND A.DEPT_CD = '@DEPT_CD' [/DEPT_CD]   -- 삭제예정 [ASSIGN]   AND A.REQ_YMD >= ADD_MONTHS(SYSDATE,-1) AND A.REQ_YMD <= TO_CHAR(SYSDATE,'YYYYMMDD')   --AND A.PROC_TYPE = '0'--   AND B.MNGT_NO IS NULL --상담사 미등록건--   AND (EXISTS (SELECT Z.MNGT_NO FROM CRM_AS_MST_SHARE Z WHERE Z.MNGT_NO = A.MNGT_NO AND DEPT_CD = '@DEPT_CD' AND EXCEPT_YN = 'N')--        OR NOT EXISTS (SELECT Z.MNGT_NO FROM CRM_AS_MST_SHARE Z WHERE Z.MNGT_NO = A.MNGT_NO))     AND A.ONLINE_YN = 'Y' [/ASSIGN] [NON_ASSIGN]   AND A.REQ_YMD >= ADD_MONTHS(SYSDATE,-1) AND A.REQ_YMD <= TO_CHAR(SYSDATE,'YYYYMMDD')   AND NOT A.PROC_TYPE IN ('1','2','8') [/NON_ASSIGN] [COMPLETE]   AND A.CMPT_YMD = TO_CHAR(SYSDATE,'YYYYMMDD')   AND A.PROC_TYPE IN ('1','2','8') [/COMPLETE]  ORDER BY A.REQ_YMD DESC, A.REQ_HM DESC 
