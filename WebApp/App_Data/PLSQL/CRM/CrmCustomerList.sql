#CrmCustomerList@Search
-- CrmCustomerList@SearchWITH W_CRM_CUST_SVCAS(    SELECT A.CUST_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', B.CD_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS SVC_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', C.CD_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS DEPT_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', A.SALES_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS SALES_NM      FROM CRM_CUST_SVC A           INNER JOIN MDM_COM_CODE B                   ON A.SVC_CD = B.COMN_CD                  AND B.GRP_CD = 'C01'           INNER JOIN MDM_COM_CODE C                   ON A.DEPT_CD = C.COMN_CD                  AND C.GRP_CD = 'C03'     WHERE A.SVC_CD IS NOT NULL     GROUP BY A.CUST_CD )SELECT A.CUST_CD     , A.USE_YN     , A.MATN_YN     , A.CUST_LOC_NM     , A.CUST_NM     , A.CUST_ADDR     , A.CUSTOMS_CD     , A.CEO     , A.CRN     , A.TEL_NO     , A.FAX_NO     , A.E_MAIL     , B.SVC_CD     , B.SALES_NM     , A.CTRT_STRT_YMD     , A.CTRT_END_YMD     , A.CTRY_CD     , A.LANG_CD     , A.CTRT_END_RSN     , A.DOMAIN     , A.TBL_CHG_YN     , A.SETUP_URL     , A.SVN     , A.CTRT_CD     , A.BILG_CD     , A.IDC_AMT     , A.USER_QTY     , A.MATN_AMT     , A.ETC_AMT     , A.ETC_AMT_INFO     , A.CTRT_RMK     , A.DEPT_CD     , PKG_CRYPTO.DECRYPT((SELECT MAX(X.SVR_IP)          FROM CRM_CUST_SERVER X         WHERE CUST_CD = A.CUST_CD           AND SVR_TYPE = 'D'           AND MAIN_YN = 'Y'       ),'@CRYPTO_KEY' || 'Key!///#^') AS DB_IP     , PKG_CRYPTO.DECRYPT((SELECT MAX(X.SVR_IP)           FROM CRM_CUST_SERVER X          WHERE CUST_CD = A.CUST_CD            AND SVR_TYPE = 'A'            AND MAIN_YN = 'Y'       ),'@CRYPTO_KEY' || 'Key!///#^') AS APP_IP     , (SELECT MAX(X.PIC_NM)           FROM CRM_CUST_PIC X         WHERE X.CUST_CD = A.CUST_CD           AND X.MAIN_YN = 'Y'       ) AS PIC_NM     , A.CTRT_AMT     , (SELECT MAX(X.PIC_NM)          FROM CRM_CUST_PIC X        WHERE X.CUST_CD = A.CUST_CD          AND X.MAIN_YN = 'A'        ) AS ACT_PIC_NM     , (SELECT MAX(X.TEL_NO)          FROM CRM_CUST_PIC X        WHERE X.CUST_CD = A.CUST_CD          AND X.MAIN_YN = 'A'        ) AS ACT_PIC_TEL     , (SELECT MAX(X.EMAIL)          FROM CRM_CUST_PIC X        WHERE X.CUST_CD = A.CUST_CD          AND X.MAIN_YN = 'A'        ) AS ACT_PIC_EMAIL     , A.ZIP_CD
     ,(SELECT MAX(Z.TAX_AMT) FROM ACT_CUST_OUTSTAND Z WHERE Z.CRN = REPLACE(A.CRN, '-', '')) AS TAX_AMT
     ,(SELECT SUM(Z.OUTSTAND_AMT) FROM ACT_CUST_OUTSTAND Z WHERE Z.CRN = REPLACE(A.CRN, '-', '')) AS OUTSTAND_AMT FROM CRM_CUST_MST A      LEFT OUTER JOIN W_CRM_CUST_SVC B              ON A.CUST_CD = B.CUST_CDWHERE 1=1[SEARCH_KEY]   AND ( 1 != 1	   OR A.CUST_CD LIKE '%@SEARCH_KEY%'	   OR A.CUST_NM LIKE '%@SEARCH_KEY%'	   OR A.CUST_LOC_NM LIKE '%@SEARCH_KEY%'	   OR A.DOMAIN LIKE '%@SEARCH_KEY%' 		   OR A.TEL_NO LIKE '%@SEARCH_KEY%'	   OR A.CUSTOMS_CD LIKE '%@SEARCH_KEY%'	   OR A.CUST_CD IN (	   	    SELECT X.CUST_CD 	   	      FROM CRM_CUST_PIC X	   	     WHERE (X.PIC_NM LIKE '%@SEARCH_KEY%'	   	          OR X.TEL_NO LIKE '%@SEARCH_KEY%'   	   	          )	      )   	   OR A.CUST_CD IN (	   	    SELECT X.CUST_CD 	   	      FROM CRM_CUST_PIC X	   	     WHERE X.TEL_NO LIKE '%@SEARCH_KEY%'	      )   	   OR A.CUST_CD IN (	        SELECT X.CUST_CD	          FROM CRM_CUST_SERVER X	         WHERE PKG_CRYPTO.DECRYPT(X.SVR_IP,'@CRYPTO_KEY' || 'Key!//#^') LIKE '%@SEARCH_KEY%'	      )	)[/SEARCH_KEY][SVC_CD]    --AND A.SVC_CD = '@SVC_CD'    AND A.CUST_CD IN (SELECT CUST_CD FROM CRM_CUST_SVC WHERE SVC_CD = '@SVC_CD')[/SVC_CD][USE_YN]    AND A.USE_YN = '@USE_YN'[/USE_YN][CUST_TYPE]    AND A.CUST_TYPE = '@CUST_TYPE'[/CUST_TYPE] ORDER BY A.CUST_LOC_NM
