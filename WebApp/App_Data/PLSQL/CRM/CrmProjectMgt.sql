#CrmProjectMgt@Delete
--CrmProjectMgt@DeleteDELETE   FROM CRM_PROJECT_MST WHERE MNGT_NO = '@MNGT_NO'
#CrmProjectMgt@Insert
--CrmProjectMgt@InsertINSERT INTO CRM_PROJECT_MST (		  MNGT_NO		, INS_USR		, INS_YMD		, INS_HM		, UPD_USR		, UPD_YMD		, UPD_HM		[DEPT_CD], DEPT_CD[/DEPT_CD]		[BIZ_YMD], BIZ_YMD[/BIZ_YMD]		[USR_ID], USR_ID[/USR_ID]		[PROD_CD], PROD_CD[/PROD_CD]		[BIZ_TYPE], BIZ_TYPE[/BIZ_TYPE]		[CUST_CD], CUST_CD[/CUST_CD]		[CUST_NM], CUST_NM[/CUST_NM]		[ITEM_NM], ITEM_NM[/ITEM_NM]		[ORD_AMT], ORD_AMT[/ORD_AMT]		[CTRT_AMT], CTRT_AMT[/CTRT_AMT]		[IDC_AMT], IDC_AMT[/IDC_AMT]		[MATN_AMT], MATN_AMT[/MATN_AMT]		[COST_AMT], COST_AMT[/COST_AMT]		[PROFIT_AMT], PROFIT_AMT[/PROFIT_AMT]		[CMPT_RATE], CMPT_RATE[/CMPT_RATE]		[PROC_TYPE], PROC_TYPE[/PROC_TYPE]		[CTRT_YMD], CTRT_YMD[/CTRT_YMD]		[BIZ_COND], BIZ_COND[/BIZ_COND]		[TAX_START_MONTH], TAX_START_MONTH[/TAX_START_MONTH]		[CTRT_RCV_YN], CTRT_RCV_YN[/CTRT_RCV_YN]		[SETUP_TAX_YN], SETUP_TAX_YN[/SETUP_TAX_YN]		[MONTH_TAX_YN], MONTH_TAX_YN[/MONTH_TAX_YN]		[OUTSTAND_AMT], OUTSTAND_AMT[/OUTSTAND_AMT]		[JOIN_TYPE], JOIN_TYPE[/JOIN_TYPE]		[JOIN_ROUTE], JOIN_ROUTE[/JOIN_ROUTE]		[RMK], RMK[/RMK]		[PIC_NM], PIC_NM[/PIC_NM]		[PIC_MOBILE], PIC_MOBILE[/PIC_MOBILE]		[PIC_EMAIL], PIC_EMAIL[/PIC_EMAIL]) VALUES (		  '@MNGT_NO'		, '@SSN_USR_ID'		, TO_CHAR(SYSDATE,'yyyyMMdd')		, TO_CHAR(SYSDATE,'HH24MISS')		, '@USR_ID'		, TO_CHAR(SYSDATE,'yyyyMMdd')		, TO_CHAR(SYSDATE,'HH24MISS')		[DEPT_CD], '@DEPT_CD'[/DEPT_CD]		[BIZ_YMD], '@BIZ_YMD'[/BIZ_YMD]		[USR_ID], '@USR_ID'[/USR_ID]		[PROD_CD], '@PROD_CD'[/PROD_CD]		[BIZ_TYPE], '@BIZ_TYPE'[/BIZ_TYPE]		[CUST_CD], '@CUST_CD'[/CUST_CD]		[CUST_NM], '@CUST_NM'[/CUST_NM]		[ITEM_NM], '@ITEM_NM'[/ITEM_NM]		[ORD_AMT], @ORD_AMT[/ORD_AMT]		[CTRT_AMT], @CTRT_AMT[/CTRT_AMT]		[IDC_AMT], @IDC_AMT[/IDC_AMT]		[MATN_AMT], @MATN_AMT[/MATN_AMT]		[COST_AMT], @COST_AMT[/COST_AMT]		[PROFIT_AMT], @PROFIT_AMT[/PROFIT_AMT]		[CMPT_RATE], @CMPT_RATE[/CMPT_RATE]		[PROC_TYPE], '@PROC_TYPE'[/PROC_TYPE]		[CTRT_YMD], REPLACE('@CTRT_YMD','-','')[/CTRT_YMD]		[BIZ_COND], '@BIZ_COND'[/BIZ_COND]		[TAX_START_MONTH], REPLACE('@TAX_START_MONTH','-','')[/TAX_START_MONTH]		[CTRT_RCV_YN], '@CTRT_RCV_YN'[/CTRT_RCV_YN]		[SETUP_TAX_YN], '@SETUP_TAX_YN'[/SETUP_TAX_YN]		[MONTH_TAX_YN], '@MONTH_TAX_YN'[/MONTH_TAX_YN]		[OUTSTAND_AMT], @OUTSTAND_AMT[/OUTSTAND_AMT]		[JOIN_TYPE], '@JOIN_TYPE'[/JOIN_TYPE]		[JOIN_ROUTE], '@JOIN_ROUTE'[/JOIN_ROUTE]		[RMK], '@RMK'[/RMK]		[PIC_NM], '@PIC_NM'[/PIC_NM]		[PIC_MOBILE], '@PIC_MOBILE'[/PIC_MOBILE]		[PIC_EMAIL], '@PIC_EMAIL'[/PIC_EMAIL])
#CrmProjectMgt@Search
--CrmProjectMgt@SearchSELECT A.MNGT_NO     , A.DEPT_CD     , A.BIZ_YMD     , A.USR_ID     , A.PROD_CD     , A.BIZ_TYPE     , A.CUST_CD     , A.CUST_NM     , A.ITEM_NM     , A.ORD_AMT     , A.CTRT_AMT     , A.IDC_AMT     , A.MATN_AMT     , A.COST_AMT     , A.PROFIT_AMT     , A.CMPT_RATE     , A.PROC_TYPE     , A.CTRT_YMD     , A.BIZ_COND     , A.TAX_START_MONTH     , A.CTRT_RCV_YN     , A.SETUP_TAX_YN     , A.MONTH_TAX_YN     , A.OUTSTAND_AMT     , A.JOIN_TYPE     , A.JOIN_ROUTE     , A.RMK     , A.PIC_NM     , A.PIC_MOBILE     , A.PIC_EMAIL     , (SELECT B.LOC_NM FROM CRM_USR_MST B WHERE B.USR_ID = A.INS_USR) AS INS_USR     , TO_CHAR(TO_DATE(A.INS_YMD,'YYYYMMDD'),'YYYY-MM-DD') || ' ' ||       TO_CHAR(TO_DATE(A.INS_HM,'HH24MISS'), 'HH24:MI:SS') AS INS_YMD     , (SELECT B.LOC_NM FROM CRM_USR_MST B WHERE B.USR_ID = A.UPD_USR) AS UPD_USR     , TO_CHAR(TO_DATE(A.UPD_YMD,'YYYYMMDD'),'YYYY-MM-DD') || ' ' ||       TO_CHAR(TO_DATE(A.UPD_HM,'HH24MISS'), 'HH24:MI:SS') AS UPD_YMD  FROM CRM_PROJECT_MST A WHERE 1 = 1 [MNGT_NO]   AND A.MNGT_NO = '@MNGT_NO' [/MNGT_NO] [DEPT_CD]   AND A.DEPT_CD = '@DEPT_CD' [/DEPT_CD] [FM_YMD]   [DATE_TYPE_B]     AND A.BIZ_YMD >= '@FM_YMD'   [/DATE_TYPE_B]   [DATE_TYPE_C]     AND A.CTRT_YMD >= SUBSTR('@FM_YMD',1,6)   [/DATE_TYPE_C] [/FM_YMD] [TO_YMD]   [DATE_TYPE_B]     AND A.BIZ_YMD <= '@TO_YMD'   [/DATE_TYPE_B]   [DATE_TYPE_C]     AND A.CTRT_YMD <= SUBSTR('@TO_YMD',1,6)   [/DATE_TYPE_C] [/TO_YMD] [CUST_NM]   AND A.CUST_NM LIKE '%@CUST_NM%' [/CUST_NM] [S_USR_ID]   AND A.USR_ID = '@S_USR_ID' [/S_USR_ID] [PROC_TYPE]   AND A.PROC_TYPE = '@PROC_TYPE' [/PROC_TYPE]  ORDER BY A.BIZ_YMD DESC, A.USR_ID, A.PROD_CD
#CrmProjectMgt@SearchCntAmt
--CrmProjectMgt@SearchCntAmtWITH W_CRM_PROJECT_MSTAS(    SELECT A.BIZ_COND         , COUNT(*) AS MATN_CNT         , SUM(NVL(A.IDC_AMT,0)+NVL(A.MATN_AMT,0)) AS MATN_AMT      FROM CRM_PROJECT_MST A     WHERE A.BIZ_COND IN ('인하계약','해지계약')	 [MNGT_NO]	   AND A.MNGT_NO = '@MNGT_NO'	 [/MNGT_NO]	 [DEPT_CD]	   AND A.DEPT_CD = '@DEPT_CD'	 [/DEPT_CD]	 [FM_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD >= '@FM_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD >= SUBSTR('@FM_YMD',1,6)	   [/DATE_TYPE_C]	 [/FM_YMD]	 [TO_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD <= '@TO_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD <= SUBSTR('@TO_YMD',1,6)	   [/DATE_TYPE_C] 	 [/TO_YMD]	 [CUST_NM]	   AND A.CUST_NM LIKE '%@CUST_NM%'	 [/CUST_NM]	 [S_USR_ID]	   AND A.USR_ID = '@S_USR_ID'	 [/S_USR_ID]	 [PROC_TYPE]	   AND A.PROC_TYPE = '@PROC_TYPE'	 [/PROC_TYPE]     GROUP BY A.BIZ_COND)SELECT '인하'      AS CODE, NVL(SUM(MATN_CNT),0) AS VALUE FROM W_CRM_PROJECT_MST WHERE BIZ_COND = '인하계약'UNION ALLSELECT '인하 금액' AS CODE, NVL(SUM(MATN_AMT),0) AS VALUE FROM W_CRM_PROJECT_MST WHERE BIZ_COND = '인하계약'UNION ALLSELECT '해지'      AS CODE, NVL(SUM(MATN_CNT),0) AS VALUE FROM W_CRM_PROJECT_MST WHERE BIZ_COND = '해지계약'UNION ALLSELECT '해지 금액' AS CODE, NVL(SUM(MATN_AMT),0) AS VALUE FROM W_CRM_PROJECT_MST WHERE BIZ_COND = '해지계약'
#CrmProjectMgt@SearchNewCancel
--CrmProjectMgt@SearchNewCancelWITH W_CRM_PROJECT_MSTAS(    SELECT SUM(CASE WHEN A.BIZ_COND = '신규계약' THEN 1 ELSE -1 END) AS MATN_CNT         , SUM(NVL(A.IDC_AMT,0) + NVL(A.MATN_AMT,0)) AS MATN_AMT      FROM CRM_PROJECT_MST A      WHERE A.BIZ_COND IN ('신규계약', '해지계약')     [MNGT_NO]       AND A.MNGT_NO = '@MNGT_NO'     [/MNGT_NO]     [DEPT_CD]       AND A.DEPT_CD = '@DEPT_CD'     [/DEPT_CD]	 [FM_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD >= '@FM_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD >= SUBSTR('@FM_YMD',1,6)	   [/DATE_TYPE_C]	 [/FM_YMD]	 [TO_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD <= '@TO_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD <= SUBSTR('@TO_YMD',1,6)	   [/DATE_TYPE_C] 	 [/TO_YMD]	 [CUST_NM]	   AND A.CUST_NM LIKE '%@CUST_NM%'	 [/CUST_NM]	 [S_USR_ID]	   AND A.USR_ID = '@S_USR_ID'	 [/S_USR_ID]	 [PROC_TYPE]	   AND A.PROC_TYPE = '@PROC_TYPE'	 [/PROC_TYPE])SELECT '고객' AS CODE, NVL(MATN_CNT,0) AS VALUE FROM W_CRM_PROJECT_MST UNION ALLSELECT '금액' AS CODE, NVL(MATN_AMT,0) AS VALUE FROM W_CRM_PROJECT_MST
#CrmProjectMgt@SearchProcessCnt
--CrmProjectMgt@SearchProcessCntWITH W_PROC_TYPEAS(    SELECT A.PROC_TYPE         , COUNT(*)  AS CTRT_CNT          , SUM(NVL(A.IDC_AMT,0) + NVL(A.MATN_AMT,0)) AS MATN_AMT      FROM CRM_PROJECT_MST A	 WHERE A.BIZ_COND <> '신규계약'	 [MNGT_NO]	   AND A.MNGT_NO = '@MNGT_NO'	 [/MNGT_NO]	 [DEPT_CD]	   AND A.DEPT_CD = '@DEPT_CD'	 [/DEPT_CD]	 [FM_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD >= '@FM_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD >= SUBSTR('@FM_YMD',1,6)	   [/DATE_TYPE_C]	 [/FM_YMD]	 [TO_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD <= '@TO_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD <= SUBSTR('@TO_YMD',1,6)	   [/DATE_TYPE_C] 	 [/TO_YMD]	 [CUST_NM]	   AND A.CUST_NM LIKE '%@CUST_NM%'	 [/CUST_NM]	 [S_USR_ID]	   AND A.USR_ID = '@S_USR_ID'	 [/S_USR_ID]	 [PROC_TYPE]	   AND A.PROC_TYPE = '@PROC_TYPE'	 [/PROC_TYPE]     GROUP BY A.PROC_TYPE), W_BIZ_CONDAS(    SELECT A.BIZ_COND         , COUNT(*) AS BIZ_CNT       FROM CRM_PROJECT_MST A      WHERE A.BIZ_COND = '신규계약'	 [MNGT_NO]	   AND A.MNGT_NO = '@MNGT_NO'	 [/MNGT_NO]	 [DEPT_CD]	   AND A.DEPT_CD = '@DEPT_CD'	 [/DEPT_CD]	 [FM_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD >= '@FM_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD >= SUBSTR('@FM_YMD',1,6)	   [/DATE_TYPE_C]	 [/FM_YMD]	 [TO_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD <= '@TO_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD <= SUBSTR('@TO_YMD',1,6)	   [/DATE_TYPE_C] 	 [/TO_YMD]	 [CUST_NM]	   AND A.CUST_NM LIKE '%@CUST_NM%'	 [/CUST_NM]	 [S_USR_ID]	   AND A.USR_ID = '@S_USR_ID'	 [/S_USR_ID]	 [PROC_TYPE]	   AND A.PROC_TYPE = '@PROC_TYPE'	 [/PROC_TYPE]     GROUP BY A.BIZ_COND) SELECT A.CODE AS CTRT_TYPE     , NVL(B.BIZ_CNT,0) AS CTRT_CNT  FROM (SELECT '신규계약' AS CODE FROM DUAL) A       LEFT OUTER JOIN W_BIZ_COND B               ON A.CODE = B.BIZ_CONDUNION ALLSELECT A.CD_NM AS CTRT_TYPE     , NVL(B.CTRT_CNT,0) AS CTRT_CNT   FROM MDM_COM_CODE A       LEFT OUTER JOIN W_PROC_TYPE B               ON A.COMN_CD = B.PROC_TYPE WHERE GRP_CD = 'P03' 
#CrmProjectMgt@SearchUserAmt
--CrmProjectMgt@SearchUserAmtSELECT (SELECT Z.LOC_NM FROM CRM_USR_MST Z WHERE Z.USR_ID = A.USR_ID) AS USR_ID     , SUM(CASE WHEN A.BIZ_COND = '신규계약' OR A.BIZ_COND = '인상계약' OR A.BIZ_COND = '추가계약' THEN 1 ELSE 0 END) AS CTRT_CNT --총계약건     , SUM(NVL(A.ORD_AMT,0)) AS ORD_AMT --총계약(SI)     , SUM(NVL(A.CTRT_AMT,0)) AS CTRT_AMT --설치비     , SUM(CASE WHEN A.BIZ_COND = '신규계약' OR A.BIZ_COND = '인상계약' OR A.BIZ_COND = '추가계약' THEN NVL(A.IDC_AMT,0)+NVL(A.MATN_AMT,0) ELSE 0 END) AS MATN_AMT --DB임대+유지보수     , SUM(NVL(A.COST_AMT,0)) AS COST_AMT --수행원가     , SUM(NVL(A.PROFIT_AMT,0)) AS PROFIT_AMT --공여이익(수주금액+설치비-수행원가)     , (CASE WHEN SUM(NVL(A.ORD_AMT,0) + NVL(A.CTRT_AMT,0)) = 0              THEN '0%'             ELSE ROUND((SUM(NVL(A.PROFIT_AMT,0)) / (SUM(NVL(A.ORD_AMT,0) + NVL(A.CTRT_AMT,0))))*100,0) ||'%'         END) AS PROFIT_RATE  FROM CRM_PROJECT_MST A WHERE A.BIZ_COND LIKE '%계약%'	 [MNGT_NO]	   AND A.MNGT_NO = '@MNGT_NO'	 [/MNGT_NO]	 [DEPT_CD]	   AND A.DEPT_CD = '@DEPT_CD'	 [/DEPT_CD]	 [FM_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD >= '@FM_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD >= SUBSTR('@FM_YMD',1,6)	   [/DATE_TYPE_C]	 [/FM_YMD]	 [TO_YMD]	   [DATE_TYPE_B]	     AND A.BIZ_YMD <= '@TO_YMD'	   [/DATE_TYPE_B]	   [DATE_TYPE_C]	     AND A.CTRT_YMD <= SUBSTR('@TO_YMD',1,6)	   [/DATE_TYPE_C] 	 [/TO_YMD]	 [CUST_NM]	   AND A.CUST_NM LIKE '%@CUST_NM%'	 [/CUST_NM]	 [S_USR_ID]	   AND A.USR_ID = '@S_USR_ID'	 [/S_USR_ID]	 [PROC_TYPE]	   AND A.PROC_TYPE = '@PROC_TYPE'	 [/PROC_TYPE] GROUP BY A.USR_ID 
#CrmProjectMgt@SearchUserCnt
--CrmProjectMgt@SearchUserCntSELECT (SELECT Z.LOC_NM FROM CRM_USR_MST Z WHERE Z.USR_ID = A.USR_ID) AS USR_ID     , COUNT(*) AS USR_CNT      , SUM(NVL(A.IDC_AMT,0) + NVL(A.MATN_AMT,0)) AS MATN_AMT  FROM CRM_PROJECT_MST A WHERE 1 = 1 [MNGT_NO]   AND A.MNGT_NO = '@MNGT_NO' [/MNGT_NO] [DEPT_CD]   AND A.DEPT_CD = '@DEPT_CD' [/DEPT_CD] [FM_YMD]   [DATE_TYPE_B]     AND A.BIZ_YMD >= '@FM_YMD'   [/DATE_TYPE_B]   [DATE_TYPE_C]     AND A.CTRT_YMD >= SUBSTR('@FM_YMD',1,6)   [/DATE_TYPE_C] [/FM_YMD] [TO_YMD]   [DATE_TYPE_B]     AND A.BIZ_YMD <= '@TO_YMD'   [/DATE_TYPE_B]   [DATE_TYPE_C]     AND A.CTRT_YMD <= SUBSTR('@TO_YMD',1,6)   [/DATE_TYPE_C] [/TO_YMD]	 [CUST_NM]	   AND A.CUST_NM LIKE '%@CUST_NM%'	 [/CUST_NM]	 [S_USR_ID]	   AND A.USR_ID = '@S_USR_ID'	 [/S_USR_ID]	 [PROC_TYPE]	   AND A.PROC_TYPE = '@PROC_TYPE'	 [/PROC_TYPE] GROUP BY A.USR_ID
#CrmProjectMgt@Update
--CrmProjectMgt@UpdateUPDATE CRM_PROJECT_MST   SET UPD_USR = '@SSN_USR_ID'     , UPD_YMD = TO_CHAR(SYSDATE,'yyyyMMdd')     , UPD_HM  = TO_CHAR(SYSDATE,'HH24MISS')     [DEPT_CD], DEPT_CD = '@DEPT_CD'[/DEPT_CD]     [BIZ_YMD], BIZ_YMD = '@BIZ_YMD'[/BIZ_YMD]     [USR_ID], USR_ID = '@USR_ID'[/USR_ID]     [PROD_CD], PROD_CD = '@PROD_CD'[/PROD_CD]     [BIZ_TYPE], BIZ_TYPE = '@BIZ_TYPE'[/BIZ_TYPE]     [CUST_CD], CUST_CD = '@CUST_CD'[/CUST_CD]     [CUST_NM], CUST_NM = '@CUST_NM'[/CUST_NM]     [ITEM_NM], ITEM_NM = '@ITEM_NM'[/ITEM_NM]     [ORD_AMT], ORD_AMT = @ORD_AMT[/ORD_AMT]     [CTRT_AMT], CTRT_AMT = @CTRT_AMT[/CTRT_AMT]     [IDC_AMT], IDC_AMT = @IDC_AMT[/IDC_AMT]     [MATN_AMT], MATN_AMT = @MATN_AMT[/MATN_AMT]     [COST_AMT], COST_AMT = @COST_AMT[/COST_AMT]     [PROFIT_AMT], PROFIT_AMT = @PROFIT_AMT[/PROFIT_AMT]     [CMPT_RATE], CMPT_RATE = @CMPT_RATE[/CMPT_RATE]     [PROC_TYPE], PROC_TYPE = '@PROC_TYPE'[/PROC_TYPE]     [CTRT_YMD], CTRT_YMD = REPLACE('@CTRT_YMD','-','')[/CTRT_YMD]     [BIZ_COND], BIZ_COND = '@BIZ_COND'[/BIZ_COND]     [TAX_START_MONTH], TAX_START_MONTH = REPLACE('@TAX_START_MONTH','-','')[/TAX_START_MONTH]     [CTRT_RCV_YN], CTRT_RCV_YN = '@CTRT_RCV_YN'[/CTRT_RCV_YN]     [SETUP_TAX_YN], SETUP_TAX_YN = '@SETUP_TAX_YN'[/SETUP_TAX_YN]     [MONTH_TAX_YN], MONTH_TAX_YN = '@MONTH_TAX_YN'[/MONTH_TAX_YN]     [OUTSTAND_AMT], OUTSTAND_AMT = @OUTSTAND_AMT[/OUTSTAND_AMT]     [JOIN_TYPE], JOIN_TYPE = '@JOIN_TYPE'[/JOIN_TYPE]     [JOIN_ROUTE], JOIN_ROUTE = '@JOIN_ROUTE'[/JOIN_ROUTE]     [RMK], RMK = '@RMK'[/RMK]     [PIC_NM], PIC_NM = '@PIC_NM'[/PIC_NM]     [PIC_MOBILE], PIC_MOBILE = '@PIC_MOBILE'[/PIC_MOBILE]     [PIC_EMAIL], PIC_EMAIL = '@PIC_EMAIL'[/PIC_EMAIL]WHERE  MNGT_NO       = '@MNGT_NO'
