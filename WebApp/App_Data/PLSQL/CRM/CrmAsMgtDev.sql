#CrmAsMgtDev@AssignCheck
-- CrmAsMgtDev@AssignCheckSELECT MNGT_NO  FROM CRM_AS_MST_WORK WHERE MNGT_NO = '@MNGT_NO'   AND SEQ = 1
#CrmAsMgtDev@AssignData_20181014
BEGIN	INSERT INTO CRM_AS_MST_WORK(		  MNGT_NO 		, SEQ 		, USR_ID 		, DEPT_CD  		, PROC_TYPE		, REQ_SVC		, REQ_SVC2		, REQ_SVC3		, PRAR_YMD		, REQ_YMD		, REQ_HM		, CMPT_YMD		, CMPT_HM	) VALUES (		  '@MNGT_NO' 		, 1		, '@USR_ID' 		, (SELECT DEPT_CD FROM CRM_USR_MST WHERE USR_ID = '@USR_ID') 		, '2'		, CASE WHEN '@REQ_SVC' IS NULL		       THEN (SELECT NVL(OPT_ITEM2,COMN_CD)		               FROM MDM_COM_CODE 		              WHERE GRP_CD = 'T02' 		                AND COMN_CD = (SELECT MAX(REQ_SVC) FROM CRM_AS_MST WHERE MNGT_NO = '@MNGT_NO'))		       ELSE '@REQ_SVC'		   END    		, CASE WHEN '@REQ_SVC2' IS NULL		       THEN (SELECT NVL(OPT_ITEM2,COMN_CD)		               FROM MDM_COM_CODE 		              WHERE GRP_CD = 'T05' 		                AND COMN_CD = (SELECT MAX(REQ_TYPE) FROM CRM_AS_MST WHERE MNGT_NO = '@MNGT_NO'))		       ELSE '@REQ_SVC2'		   END    		, '@REQ_SVC3'		, '@PRAR_YMD'		, '@REQ_YMD'		, '@REQ_HM'		, '@CMPT_YMD'		, '@CMPT_HM'	 );	UPDATE CRM_AS_MST	   SET PROC_TYPE = '7'	 WHERE MNGT_NO = '@MNGT_NO';	     END ; 
#CrmAsMgtDev@AssignData2
--CrmAsMgtDev@AssignData2BEGIN	INSERT INTO CRM_AS_MST_WORK(		  MNGT_NO 		, SEQ 		, USR_ID 		, DEPT_CD  		, PROC_TYPE		, REQ_SVC		, REQ_SVC2		, REQ_SVC3		, PRAR_YMD		, REQ_YMD		, REQ_HM		, CMPT_YMD		, CMPT_HM		, RANK		, RMK		, INS_USR		, INS_YMD		, INS_HM		, UPD_USR		, UPD_YMD		, UPD_HM	) VALUES (		  '@MNGT_NO' 		, 1		, '@USR_ID' 		, (SELECT DEPT_CD FROM CRM_USR_MST WHERE USR_ID = '@USR_ID') 		, '7'		, CASE WHEN '@REQ_SVC' IS NULL		       THEN (SELECT NVL(OPT_ITEM2,COMN_CD)		               FROM MDM_COM_CODE 		              WHERE GRP_CD = 'T02' 		                AND COMN_CD = (SELECT MAX(REQ_SVC) FROM CRM_AS_MST WHERE MNGT_NO = '@MNGT_NO'))		       ELSE '@REQ_SVC'		   END    		, CASE WHEN '@REQ_SVC2' IS NULL		       THEN (SELECT NVL(OPT_ITEM2,COMN_CD)		               FROM MDM_COM_CODE 		              WHERE GRP_CD = 'T05' 		                AND COMN_CD = (SELECT MAX(REQ_TYPE) FROM CRM_AS_MST WHERE MNGT_NO = '@MNGT_NO'))		       ELSE '@REQ_SVC2'		   END    		, '@REQ_SVC3'		, '@PRAR_YMD'		, '@REQ_YMD'		, '@REQ_HM'		, '@CMPT_YMD'		, '@CMPT_HM'		, '@RANK'		, '@DEV_RMK'		, '@SSN_USR_ID'		, TO_CHAR(SYSDATE,'yyyyMMdd')	 	, TO_CHAR(SYSDATE,'HH24MISS')	 	, '@SSN_USR_ID'		, TO_CHAR(SYSDATE,'yyyyMMdd')	 	, TO_CHAR(SYSDATE,'HH24MISS')	 );	UPDATE CRM_AS_MST	   SET PROC_TYPE = '7'	     , RMK = '@RMK'	 WHERE MNGT_NO = '@MNGT_NO';	     END ; 
#CrmAsMgtDev@CrmUserInfo
--CrmAsMgtDev@CrmUserInfo SELECT DEPT_CD,  LOC_NM , USR_ID,SORT      , (CASE WHEN RMK LIKE '%//#처리자%' THEN 'Y' ELSE 'N' END) AS WORK_USR2_YN   FROM CRM_USR_MST  WHERE USE_YN = 'Y'  
#CrmAsMgtDev@Delete
--CrmAsMgtDev@DeletDELETE CRM_AS_MST WHERE MNGT_NO ='@MNGT_NO'   AND DEPT_CD = '@DEPT_CD'
#CrmAsMgtDev@DeleteWorkUser
--CrmAsMgtDev@DeleteWorkUserDELETE CRM_AS_MST_WORK WHERE MNGT_NO ='@MNGT_NO'  AND SEQ = 0
#CrmAsMgtDev@ExceptCancel
-- CrmAsMgtDev@ExceptCancelUPDATE CRM_AS_MST   SET EXCEPT_YN = 'N' WHERE MNGT_NO = '@MNGT_NO'
#CrmAsMgtDev@ExceptList
-- CrmAsMgtDev@ExceptListUPDATE CRM_AS_MST   SET EXCEPT_YN = 'Y' WHERE MNGT_NO = '@MNGT_NO'
#CrmAsMgtDev@GetReqSvc2List
-- CrmAsMgtDev@GetReqSvc2ListSELECT   COMN_CD AS CODE        ,  CD_NM AS NAME        , OPT_ITEM1 AS GRP_CD        , SORT  FROM MDM_COM_CODE WHERE GRP_CD = 'Z02'
#CrmAsMgtDev@Insert
-- CrmAsMgtDev@InsertBEGIN INSERT INTO CRM_AS_MST (	  MNGT_NO	, INS_USR	, INS_YMD	, INS_HM	[REQ_YMD], REQ_YMD[/REQ_YMD]	[REQ_HM], REQ_HM[/REQ_HM]	[REQ_SVC], REQ_SVC[/REQ_SVC]	[CUST_CD], CUST_CD[/CUST_CD]	[CONTENT], CONTENT[/CONTENT]	[REQ_USR], REQ_USR[/REQ_USR]	[TEL_NO], TEL_NO[/TEL_NO]	[PROC_TYPE], PROC_TYPE[/PROC_TYPE]	[REQ_TYPE], REQ_TYPE[/REQ_TYPE]	[PRIORITY], PRIORITY[/PRIORITY]	[WORK_USR], WORK_USR[/WORK_USR]	[PRAR_YMD], PRAR_YMD[/PRAR_YMD]	[CMPT_YMD], CMPT_YMD[/CMPT_YMD]	[FREE_YN], FREE_YN[/FREE_YN]	[RMK], RMK[/RMK]	[CMPT_RMK], CMPT_RMK[/CMPT_RMK]	, DEPT_CD ) VALUES (       '@MNGT_NO'	 , '@USR_ID'	 , TO_CHAR(SYSDATE,'yyyyMMdd')	 , TO_CHAR(SYSDATE,'HH24MISS')	 [REQ_YMD], '@REQ_YMD'[/REQ_YMD]	 [REQ_HM], '@REQ_HM'[/REQ_HM]	 [REQ_SVC], '@REQ_SVC'[/REQ_SVC]	 [CUST_CD], '@CUST_CD'[/CUST_CD]	 [CONTENT], '@CONTENT'[/CONTENT]	 [REQ_USR], '@REQ_USR'[/REQ_USR]	 [TEL_NO], '@TEL_NO'[/TEL_NO]	 [PROC_TYPE], '@PROC_TYPE'[/PROC_TYPE]	 [REQ_TYPE], '@REQ_TYPE'[/REQ_TYPE]	 [PRIORITY], '@PRIORITY'[/PRIORITY]	 [WORK_USR], '@WORK_USR'[/WORK_USR]	 [PRAR_YMD], '@PRAR_YMD'[/PRAR_YMD]	 [CMPT_YMD], '@CMPT_YMD'[/CMPT_YMD]	 [FREE_YN], '@FREE_YN'[/FREE_YN]	 [RMK], '@RMK'[/RMK]	 [CMPT_RMK], '@CMPT_RMK'[/CMPT_RMK]	 , '@DEPT_CD');  MERGE INTO  CRM_AS_MST_SHARE C      USING ( SELECT '@MNGT_NO' AS MNGT_NO                    ,'@DEPT_CD' AS DEPT_CD                  FROM DUAL )  A     ON (     C.MNGT_NO = A.MNGT_NO         AND C.DEPT_CD  = A.DEPT_CD ) WHEN NOT MATCHED THEN     INSERT (C.MNGT_NO , C.DEPT_CD)     VALUES('@MNGT_NO', '@DEPT_CD' );     END
#CrmAsMgtDev@InsertPicInfo
--CrmAsMgtDev@InsertPicInfo  MERGE INTO  CRM_CUST_PIC C        USING ( SELECT '@CUST_CD' AS CUST_CD                      ,'@PIC_NM' AS PIC_NM                  FROM DUAL )  A     ON (     C.CUST_CD = A.CUST_CD         AND C.PIC_NM  = A.PIC_NM )WHEN MATCHED THEN     UPDATE SET C.TEL_NO = '@TEL_NO'WHEN NOT MATCHED THEN     INSERT (C.CUST_CD , C.SEQ, C.PIC_NM, C.TEL_NO)     VALUES('@CUST_CD', (SELECT NVL(MAX(SEQ),0)+1 FROM CRM_CUST_PIC WHERE CUST_CD = '@CUST_CD'),'@PIC_NM','@TEL_NO')
#CrmAsMgtDev@Search
--CrmAsMgtDev@SearchWITH W_CRM_CUST_SVCAS(    SELECT A.CUST_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', B.CD_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS SVC_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', C.CD_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS DEPT_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', A.SALES_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS SALES_NM      FROM CRM_CUST_SVC A           INNER JOIN MDM_COM_CODE B                   ON A.SVC_CD = B.COMN_CD                  AND B.GRP_CD = 'C01'           INNER JOIN MDM_COM_CODE C                   ON A.DEPT_CD = C.COMN_CD                  AND C.GRP_CD = 'C03'     WHERE A.SVC_CD IS NOT NULL     GROUP BY A.CUST_CD )SELECT A.*      , CASE WHEN A.CHK_TODAY - A.CHK_PRAR_YMD < 0             THEN 0             ELSE A.CHK_TODAY - A.CHK_PRAR_YMD         END AS DELAY     ,  CASE WHEN A.CHK_TODAY - A.CHK_PRAR_YMD > 0              THEN 'Y'             ELSE 'N'        END DELAY_YN  FROM (	SELECT A.MNGT_NO	     , W.SEQ	     , A.REQ_YMD	     , A.REQ_HM 	     , A.CUST_CD 	     , B.CUST_LOC_NM AS CUST_NM 	     , W.CONTENT	     , A.REQ_USR	     , A.TEL_NO 	     , A.REQ_TYPE	     , A.PRIORITY 	     , A.RMK	     , A.CMPT_RMK	     , CASE WHEN A.MNGT_NO = '@S_MNGT_NO'	            THEN 'A'	            ELSE 'B'	       END SORT_NO	     , C.LOC_NM AS INS_USR	     , B.USE_YN	     , D.SVC_CD	     , B.MATN_YN	     , D.SALES_NM	     , A.FREE_YN	     , CASE WHEN (SELECT COUNT(X.MNGT_NO)                        FROM COM_DOC_MST X                       WHERE X.MNGT_NO = A.MNGT_NO) >= 1                THEN 'Y'                ELSE 'N'           END AS FILE_YN         , A.SYS_ID         , NVL(A.DEPT_CD,'01') AS DEPT_CD         , ( SELECT CD_NM              FROM MDM_COM_CODE X             WHERE GRP_CD = 'C03'               AND X.COMN_CD = NVL(A.DEPT_CD,'01')) AS DEPT_NM            , (SELECT LOC_NM FROM CRM_USR_MST  X WHERE X.USR_ID =W.USR_ID) AS WORK_USR_NM           , W.USR_ID AS WORK_ID 	     , W.PRAR_YMD	     , W.CMPT_YMD	     , W.DEV_CONTENT	     , NVL(W.PROC_TYPE,'1') AS PROC_TYPE	     , W.USR_ID         , CASE WHEN W.PRAR_YMD IS NULL                 THEN TO_DATE(A.REQ_YMD)+6                ELSE TO_DATE(W.PRAR_YMD)            END AS CHK_PRAR_YMD    	              , TO_DATE(TO_CHAR(SYSDATE,'yyyyMMdd')) AS CHK_TODAY           , W.REQ_SVC3         , UFN_FORMAT(A.INS_YMD,'DATE') AS INS_YMD	  FROM CRM_AS_MST_WORK W	      ,CRM_AS_MST A	       INNER JOIN CRM_CUST_MST B                   ON A.CUST_CD = B.CUST_CD	       LEFT OUTER JOIN CRM_USR_MST C	               ON A.INS_USR = C.USR_ID           LEFT OUTER JOIN W_CRM_CUST_SVC D                   ON A.CUST_CD = D.CUST_CD           LEFT OUTER JOIN CRM_AS_CUST E                   ON A.MNGT_NO = E.MNGT_NO	 WHERE 1 = 1	  AND W.MNGT_NO = A.MNGT_NO	  AND W.SEQ <> 0	    [FM_YMD]	       AND A.REQ_YMD >= '@FM_YMD'	    [/FM_YMD]	    [TO_YMD]	       AND A.REQ_YMD <= '@TO_YMD'	    [/TO_YMD]	    [S_PROC_TYPE]	       AND W.PROC_TYPE IN ('@S_PROC_TYPE')	    [/S_PROC_TYPE]	    [S_SVC_CD]	       AND B.CUST_CD IN (SELECT CUST_CD FROM CRM_CUST_SVC WHERE SVC_CD IN ('@S_SVC_CD'))	    [/S_SVC_CD]	    [SEARCH_KEY]		   AND ( 1 != 1		   OR A.CUST_CD LIKE '%@SEARCH_KEY%'		   OR B.CUST_NM LIKE '%@SEARCH_KEY%'		   OR B.CUST_LOC_NM LIKE '%@SEARCH_KEY%'		   OR B.DOMAIN LIKE '%@SEARCH_KEY%' 			   OR A.TEL_NO LIKE '%@SEARCH_KEY%'		   OR B.CUSTOMS_CD LIKE '%@SEARCH_KEY%'		   OR A.REQ_USR LIKE '%@SEARCH_KEY%'		   OR A.WORK_USR LIKE '%@SEARCH_KEY%'		   OR A.MNGT_NO LIKE '%@SEARCH_KEY%'		   OR A.CONTENT LIKE '%@SEARCH_KEY%'		  )		[/SEARCH_KEY]		[WORK_USR]		AND A.MNGT_NO IN (SELECT MNGT_NO							  FROM CRM_AS_MST_WORK							 WHERE USR_ID IN (SELECT VALUE1							  FROM TABLE(  UFN_GET_INFO('USER_LIST','%@WORK_USR%')))  )		[/WORK_USR]	   		   ) A ORDER BY A.SORT_NO  [PRIORITY]           , A.PRIORITY  [/PRIORITY]  ,A.REQ_YMD||A.REQ_HM DESC
#CrmAsMgtDev@Search2
--CrmAsMgtDev@Search2WITH W_CRM_CUST_SVCAS(    SELECT A.CUST_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', B.CD_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS SVC_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', C.CD_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS DEPT_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', A.SALES_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS SALES_NM      FROM CRM_CUST_SVC A           INNER JOIN MDM_COM_CODE B                   ON A.SVC_CD = B.COMN_CD                  AND B.GRP_CD = 'C01'           INNER JOIN MDM_COM_CODE C                   ON A.DEPT_CD = C.COMN_CD                  AND C.GRP_CD = 'C03'     WHERE A.SVC_CD IS NOT NULL     GROUP BY A.CUST_CD )SELECT A.*      , CASE WHEN A.CHK_TODAY - A.CHK_PRAR_YMD < 0             THEN 0             ELSE A.CHK_TODAY - A.CHK_PRAR_YMD         END AS DELAY     , CASE WHEN A.CHK_TODAY - A.CHK_PRAR_YMD > 0             THEN 'Y'            ELSE 'N'        END DELAY_YN  FROM (	SELECT A.MNGT_NO	     , W.SEQ	     , A.REQ_YMD	     , A.REQ_HM 	     , A.CUST_CD 	     , B.CUST_LOC_NM AS CUST_NM 	     , A.CONTENT	     , A.REQ_USR	     , A.TEL_NO 	     , A.REQ_TYPE	     , A.PRIORITY 	     , A.RMK||CHR(13)||CHR(10)||W.DEV_CONTENT AS RMK	     , A.CMPT_RMK	     , CASE WHEN A.MNGT_NO = '@S_MNGT_NO' THEN 'A' ELSE 'B' END SORT_NO	     , C.LOC_NM AS INS_USR	     , B.USE_YN	     , D.SVC_CD	     , B.MATN_YN	     , D.SALES_NM	     , A.FREE_YN	     , CASE WHEN (SELECT COUNT(X.MNGT_NO)                        FROM COM_DOC_MST X                       WHERE X.MNGT_NO = A.MNGT_NO) >= 1                THEN 'Y'                ELSE 'N'           END AS FILE_YN         , A.SYS_ID         , NVL(A.DEPT_CD,'01') AS DEPT_CD         , (SELECT CD_NM              FROM MDM_COM_CODE X             WHERE GRP_CD = 'C03'               AND X.COMN_CD = NVL(A.DEPT_CD,'01')) AS DEPT_NM            , (SELECT LOC_NM FROM CRM_USR_MST  X WHERE X.USR_ID =W.USR_ID) AS WORK_USR_NM           , W.USR_ID AS WORK_ID 	      , W.PRAR_YMD	      , W.CMPT_YMD	      , W.DEV_CONTENT	      , NVL(W.PROC_TYPE,'1') AS PROC_TYPE	      , W.USR_ID          , CASE WHEN W.PRAR_YMD IS NULL                  THEN TO_DATE(A.REQ_YMD)+6                 ELSE TO_DATE(W.PRAR_YMD)             END AS CHK_PRAR_YMD    	               , TO_DATE(TO_CHAR(SYSDATE,'yyyyMMdd')) AS CHK_TODAY            , W.REQ_SVC3          , UFN_FORMAT(A.INS_YMD,'DATE') AS INS_YMD	  FROM CRM_AS_MST_WORK W	     , CRM_AS_MST A	       INNER JOIN CRM_CUST_MST B                   ON A.CUST_CD = B.CUST_CD	       LEFT OUTER JOIN CRM_USR_MST C	               ON A.INS_USR = C.USR_ID           LEFT OUTER JOIN W_CRM_CUST_SVC D                   ON A.CUST_CD = D.CUST_CD           LEFT OUTER JOIN CRM_AS_CUST E                   ON A.MNGT_NO = E.MNGT_NO           LEFT OUTER JOIN CRM_AS_MST_WORK T                   ON A.MNGT_NO = T.MNGT_NO                   AND T.SEQ = 1	 WHERE 1 = 1	   AND W.MNGT_NO = A.MNGT_NO	   AND W.SEQ <> 0	   [FM_YMD]	       AND A.REQ_YMD >= '@FM_YMD'	   [/FM_YMD]	   [TO_YMD]	       AND A.REQ_YMD <= '@TO_YMD'	   [/TO_YMD]	   [S_PROC_TYPE]	       AND W.PROC_TYPE IN ('@S_PROC_TYPE')	   [/S_PROC_TYPE]	   [S_SVC_CD]	       AND B.CUST_CD IN (SELECT CUST_CD FROM CRM_CUST_SVC WHERE SVC_CD IN ('@S_SVC_CD'))	   [/S_SVC_CD]	   [SEARCH_KEY]		   AND ( 1 != 1			   OR A.CUST_CD LIKE '%@SEARCH_KEY%'			   OR B.CUST_NM LIKE '%@SEARCH_KEY%'			   OR B.CUST_LOC_NM LIKE '%@SEARCH_KEY%'			   OR B.DOMAIN LIKE '%@SEARCH_KEY%' 				   OR A.TEL_NO LIKE '%@SEARCH_KEY%'			   OR B.CUSTOMS_CD LIKE '%@SEARCH_KEY%'			   OR A.REQ_USR LIKE '%@SEARCH_KEY%'			   OR A.WORK_USR LIKE '%@SEARCH_KEY%'			   OR A.MNGT_NO LIKE '%@SEARCH_KEY%'			   OR A.CONTENT LIKE '%@SEARCH_KEY%'	       )	   [/SEARCH_KEY]	   [WORK_USR]		   AND T.USR_ID = '@WORK_USR'	   [/WORK_USR]	   [DEPT_CD]	       AND T.DEPT_CD = '@DEPT_CD'	   [/DEPT_CD]  ) A ORDER BY A.SORT_NO  [PRIORITY]    , A.PRIORITY  [/PRIORITY]  ,A.REQ_YMD||A.REQ_HM DESC
#CrmAsMgtDev@SearchAssign
--CrmAsMgtDev@SearchAssignSELECT A.*      , CASE WHEN A.CHK_TODAY - A.CHK_PRAR_YMD < 0             THEN 0             ELSE A.CHK_TODAY - A.CHK_PRAR_YMD         END AS DELAY     , CASE WHEN A.CHK_TODAY - A.CHK_PRAR_YMD > 0             THEN 'Y'            ELSE 'N'        END DELAY_YN     --, (CASE WHEN (A.S1+A.S2+A.S3+A.S4+A.S5+A.S6+A.S7+A.S8+A.S9+A.S10+A.S11+A.S12+A.S13+A.S14+A.S15+A.S16+A.S17) = 0     --        THEN 0.5     --        ELSE CASE WHEN A.S1 = 0     --                  THEN (A.S1+A.S2+A.S3+A.S4+A.S5+A.S6+A.S7+A.S8+A.S9+A.S10+A.S11+A.S12+A.S13+A.S14+A.S15+A.S16+A.S17)     --                  ELSE A.S1     --             END     --   END)+NVL((SELECT Z.OPT_ITEM10 FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T16' AND Z.COMN_CD = A.PROJECT_CD),0) AS SCORE          --, NVL(A.S1+A.S2+A.S3+A.S4+A.S5+A.S6+A.S7+A.S8+A.S9+A.S10+A.S11+A.S12+A.S13+A.S14+A.S15+A.S16+A.S17,0)     --  +NVL(SRANK,0)     --  +NVL(A.DEV_SCORE,0)     --  +NVL((SELECT Z.OPT_ITEM10 FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T16' AND Z.COMN_CD = A.PROJECT_CD),0) AS SCORE     , NVL(UFN_AS_SCORE(A.MNGT_NO),0) AS SCORE  FROM (	SELECT A.MNGT_NO	     , W.SEQ	     , A.REQ_YMD||' '||A.REQ_HM AS REQ_YMD	     , A.REQ_HM 	     , A.CUST_CD 	     , B.CUST_LOC_NM AS CUST_NM 	     , A.CONTENT	     , A.REQ_USR	     , A.TEL_NO 	     , A.REQ_TYPE	     , A.PRIORITY 	     , A.RMK||CHR(13)||CHR(10)||W.DEV_CONTENT AS RMK	     , A.CMPT_RMK	     , CASE WHEN A.MNGT_NO = '@S_MNGT_NO' THEN 'A' ELSE 'B' END SORT_NO         , CASE WHEN A.SYS_ID = 'CRM'                THEN (SELECT Z.LOC_NM FROM  CRM_USR_MST Z WHERE Z.USR_ID = A.INS_USR)                ELSE (SELECT MAX(Y.LOC_NM)                      FROM CRM_AS_MST_WORK X                         , CRM_USR_MST Y                     WHERE X.MNGT_NO = A.MNGT_NO                       AND X.USR_ID = Y.USR_ID                       AND X.SEQ = 0)            END AS INS_USR_NM	     , B.USE_YN         , (SELECT LISTAGG (X.CD_NM, ',') WITHIN GROUP (ORDER BY X.CD_NM)               FROM CRM_CUST_SVC Z                   INNER JOIN MDM_COM_CODE X                      ON Z.SVC_CD = X.COMN_CD                     AND X.GRP_CD = 'C01'             WHERE Z.CUST_CD = A.CUST_CD               AND Z.SVC_CD IS NOT NULL) AS SVC_CD         , B.MATN_YN         , (SELECT LISTAGG (Z.SALES_NM, ',') WITHIN GROUP (ORDER BY Z.SALES_NM) FROM CRM_CUST_SVC Z WHERE  Z.CUST_CD = A.CUST_CD AND Z.SVC_CD IS NOT NULL) AS SALES_NM	     , A.FREE_YN	     , CASE WHEN (SELECT COUNT(X.MNGT_NO)                        FROM COM_DOC_MST X                       WHERE X.MNGT_NO = A.MNGT_NO) >= 1                THEN 'Y'                ELSE 'N'           END AS FILE_YN         , A.SYS_ID         , NVL(A.DEPT_CD,'01') AS DEPT_CD         , (SELECT CD_NM              FROM MDM_COM_CODE X             WHERE GRP_CD = 'C03'               AND X.COMN_CD = NVL(A.DEPT_CD,'01')) AS DEPT_NM            , (SELECT LOC_NM FROM CRM_USR_MST  X WHERE X.USR_ID =W.USR_ID) AS WORK_USR_NM           , W.USR_ID AS WORK_ID 	      , W.PRAR_YMD	      , W.CMPT_YMD	      , W.DEV_CONTENT	      , NVL(W.PROC_TYPE,'1') AS PROC_TYPE	      , W.USR_ID          , CASE WHEN W.PRAR_YMD IS NULL                  THEN TO_DATE(A.REQ_YMD)+6                 ELSE TO_DATE(W.PRAR_YMD)             END AS CHK_PRAR_YMD    	               , TO_DATE(TO_CHAR(SYSDATE,'yyyyMMdd')) AS CHK_TODAY            , W.REQ_SVC          , W.REQ_SVC2          , W.REQ_SVC3          , UFN_FORMAT(A.INS_YMD,'DATE') AS INS_YMD          , CASE WHEN W.RANK = 'A' THEN '상'                 WHEN W.RANK = 'B' THEN '중'                 WHEN W.RANK = 'C' THEN '하'                 ELSE ''             END AS RANK         --, NVL((SELECT MAX(Z.OPT_ITEM10) FROM MDM_COM_CODE Z WHERE Z.GRP_CD = 'T15' AND Z.COMN_CD = W.RANK),0) AS SRANK         , W.RMK AS DEV_RMK            , A.SHARE_YN         , A.DEV_ERR_YN         , A.DEV_ERR_NM         , (SELECT Z.LOC_NM FROM CRM_USR_MST Z WHERE Z.USR_ID = W.QC_TESTER) AS QC_TESTER         , ( CASE WHEN W.RANK1  = 'Y' THEN '신규(개발),' END            ||CASE WHEN W.RANK2  = 'Y' THEN '화면변경,' END            ||CASE WHEN W.RANK3  = 'Y' THEN '로직수정,' END 		   ||CASE WHEN W.RANK4  = 'Y' THEN '쿼리수정,' END 		   ||CASE WHEN W.RANK5  = 'Y' THEN 'RPT추가,' END 		   ||CASE WHEN W.RANK6  = 'Y' THEN 'RPT변경,' END 		   ||CASE WHEN W.RANK7  = 'Y' THEN '단순문의,' END 		   ||CASE WHEN W.RANK8  = 'Y' THEN 'Data변경,' END 		   ||CASE WHEN W.RANK9  = 'Y' THEN 'EDI확인,'END 		   ||CASE WHEN W.RANK10 = 'Y' THEN '업무분석' END		   ||CASE WHEN W.RANK11 = 'Y' THEN '설계' END		   ||CASE WHEN W.RANK12 = 'Y' THEN '화면디자인' END		   ||CASE WHEN W.RANK13 = 'Y' THEN '설치' END		   ||CASE WHEN W.RANK14 = 'Y' THEN '통합테스트' END		   ||CASE WHEN W.RANK15 = 'Y' THEN '기타' END		   ||CASE WHEN W.RANK16 = 'Y' THEN 'Data이관' END		   ||CASE WHEN W.RANK17 = 'Y' THEN '산출물작성' END)  AS DEV_ITEM		 , A.PROJECT_CD		 , A.PGM_MDF AS PGM_MDF		 , W.DEV_SCORE_RMK	  FROM CRM_AS_MST_WORK W	     , CRM_AS_MST A	       INNER JOIN CRM_CUST_MST B                   ON A.CUST_CD = B.CUST_CD           LEFT OUTER JOIN CRM_AS_MST_WORK T                   ON A.MNGT_NO = T.MNGT_NO                   AND T.SEQ = 1	 WHERE 1 = 1	   AND W.MNGT_NO = A.MNGT_NO	   AND W.SEQ <> 0	   AND W.DEPT_CD IN ('@DEPT_CD')	   [WORK_AREA]	       AND EXISTS (SELECT '' FROM CRM_USR_MST Z WHERE Z.USR_ID = W.QC_TESTER AND Z.WORK_AREA = '@WORK_AREA')	   [/WORK_AREA]	   [FM_YMD]	       [CMPT_YMD]	       	   AND T.CMPT_YMD >= '@FM_YMD'	       [/CMPT_YMD]	       [REQ_YMD]	       	   AND A.REQ_YMD >= '@FM_YMD'	       [/REQ_YMD]	   [/FM_YMD]	   [TO_YMD]	       [CMPT_YMD]	       	   AND T.CMPT_YMD <= '@TO_YMD'	       [/CMPT_YMD]	       [REQ_YMD]	       	   AND A.REQ_YMD <= '@TO_YMD'	       [/REQ_YMD]	   [/TO_YMD]	   [S_PROC_TYPE]	       AND W.PROC_TYPE IN ('@S_PROC_TYPE')	   [/S_PROC_TYPE]	   [S_SVC_CD]	       AND B.CUST_CD IN (SELECT CUST_CD FROM CRM_CUST_SVC WHERE SVC_CD IN ('@S_SVC_CD'))	   [/S_SVC_CD]	   [SEARCH_KEY]		   AND ( 1 != 1			   OR A.CUST_CD LIKE '%@SEARCH_KEY%'			   OR B.CUST_NM LIKE '%@SEARCH_KEY%'			   OR B.CUST_LOC_NM LIKE '%@SEARCH_KEY%'			   OR B.DOMAIN LIKE '%@SEARCH_KEY%' 				   OR A.TEL_NO LIKE '%@SEARCH_KEY%'			   OR B.CUSTOMS_CD LIKE '%@SEARCH_KEY%'			   OR A.REQ_USR LIKE '%@SEARCH_KEY%'			   OR A.WORK_USR LIKE '%@SEARCH_KEY%'			   OR A.MNGT_NO LIKE '%@SEARCH_KEY%'			   OR A.CONTENT LIKE '%@SEARCH_KEY%'	       )	   [/SEARCH_KEY]	   [WORK_USR]		   AND T.USR_ID = '@WORK_USR'	   [/WORK_USR]	   [DEPT_CD]	       AND T.DEPT_CD IN ('@DEPT_CD')	   [/DEPT_CD]	   [PGM_MDF]	       AND A.PGM_MDF IS NOT NULL	   [/PGM_MDF]	     ) A ORDER BY A.SORT_NO  [PRIORITY]    , A.PRIORITY  [/PRIORITY]  ,A.REQ_YMD||A.REQ_HM DESC
#CrmAsMgtDev@SearchCustomer
-- CrmAsMgtDev@SearchCustomerSELECT CUST_CD     , CUST_LOC_NM      , TEL_NO  FROM CRM_CUST_MST WHERE (1=2        OR CUST_CD LIKE '%@SEARCH_KEY%'        OR CUST_NM LIKE '%@SEARCH_KEY%'        OR CUST_LOC_NM LIKE '%@SEARCH_KEY%'        OR TEL_NO LIKE '%@SEARCH_KEY%'       )   AND USE_YN = 'Y'
#CrmAsMgtDev@SearchCustomerPic
--CrmAsMgtDev@SearchCustomerPicSELECT B.PIC_NM     , B.TEL_NO  FROM CRM_CUST_MST A     , CRM_CUST_PIC B WHERE A.CUST_CD = '@CUST_CD'   AND A.CUST_CD = B.CUST_CD   AND (1=2        OR B.PIC_NM LIKE '%@SEARCH_KEY%'        OR B.TEL_NO LIKE '%@SEARCH_KEY%'        OR B.EMAIL LIKE '%@SEARCH_KEY%'        OR B.RMK LIKE '%@SEARCH_KEY%'       )
#CrmAsMgtDev@SearchInput
--CrmAsMgtDev@SearchInput SELECT A.*     , TO_CLOB(A.CUST_CONT)||CHR(13)||CHR(10)||CHR(13)||CHR(10)||'<조치결과>---------------------------------------------'||CHR(13)||CHR(10)||CHR(13)||CHR(10)||A.CALL_CONT||CHR(13)||CHR(10)||CHR(13)||CHR(10)||A.DEV_CONT AS CONTENT  FROM (		SELECT UFN_FORMAT(A.REQ_YMD,'DATE')  || ' ' || UFN_FORMAT(A.REQ_HM,'TIME')    AS  AS_REQ_YMD		     , A.MNGT_NO   AS MNGT_NO 		     , A.REQ_USR		     , A.TEL_NO  		     , B.CUST_LOC_NM AS CUST_NM 		     , A.CUST_CD   		     , B.CUST_NM AS CUST_ENG_NM             , (CASE WHEN E.SUBJECT IS NULL THEN A.CONTENT                     ELSE '제목:'||TRIM(E.SUBJECT)||CHR(13)||CHR(10)||'내용:'||A.CONTENT                END) AS CUST_CONT             --, A.CONTENT AS CUST_CONT             , A.RMK AS CALL_CONT             , CASE WHEN TRIM(A.CONTENT)= TRIM(A.CONTENT)                    THEN ''                    ELSE W.CONTENT                END AS DEV_CONT		     , (SELECT CD_NM				  FROM MDM_COM_CODE X				 WHERE X.GRP_CD = 'T05' 				   AND X.COMN_CD = A.REQ_TYPE) AS REQ_TYPE 		     , (SELECT CD_NM				  FROM MDM_COM_CODE X				 WHERE X.GRP_CD = 'T01' 				   AND X.COMN_CD = A.PRIORITY)  AS PRIORITY  		     , A.CMPT_RMK AS AS_CMPT_RMK   		     , NVL( A.DEPT_CD, '01') AS DEPT_CD		     , A.INS_USR	              , CASE WHEN A.SYS_ID = 'CRM'                     THEN (SELECT MAX(X.LOC_NM)                            FROM CRM_USR_MST X                           WHERE X.USR_ID = A.INS_USR)                    ELSE (SELECT MAX(Y.LOC_NM)                            FROM CRM_AS_MST_WORK X, CRM_USR_MST Y                           WHERE X.MNGT_NO = A.MNGT_NO                             AND X.USR_ID = Y.USR_ID                             AND X.SEQ = 0)                                   END AS INS_USR_NM  		     , NVL( NVL( ( SELECT REPLACE( WM_CONCAT( DEPT_CD) ,',','; ')                       FROM CRM_AS_MST_SHARE X                      WHERE X.MNGT_NO = A.MNGT_NO) ,A.DEPT_CD ) , '01') AS DEPT_AUTH_LIST             , NVL(A.DEV_PROC_TYPE,'1') AS DEV_PROC_TYPE             , A.DEV_PRAR_YMD              , A.DEV_CMPT_YMD             , A.DEV_PRIORITY              , W.USR_ID AS WORK_USR      			 , A.DEV_TEST_CHK_YMD 			 , A.DEV_TEST_CMPT_YMD   			 , A.AS_TEST_CHK_YMD  			 , CASE WHEN A.PROC_TYPE = '1' 			        THEN '1'			        ELSE NVL(W.PROC_TYPE,'1') 			    END AS PROC_TYPE			 , (SELECT LOC_NM FROM CRM_USR_MST  X WHERE X.USR_ID =W.USR_ID) AS WORK_USR_NM 			 , W.PRAR_YMD			 , W.REQ_YMD 			 , W.REQ_HM			 , W.CMPT_YMD			 , W.CMPT_HM			 , W.TEST_REQ_YMD 			 , NVL(W.TEST_RESULT,'1') AS TEST_RESULT			 , W.TEST_CMPT_YMD			 , W.SEQ			 , W.DEV_CONTENT 			 , W.TEST_USR_ID			 , W.USR_ID	         , W.REQ_SVC	         , W.REQ_SVC2	         , W.REQ_SVC3	         , W.REQ_SVC2 AS T_REQ_SVC2	         , NVL(A.RMK,'개발내용(요청사항,원인/해결책) : '||CHR(13)||CHR(10)||'-> '||CHR(13)||CHR(10)||'개발리스트 : '||CHR(13)||CHR(10)||'-> '||CHR(13)||CHR(10)||'테스트리스트 : '||CHR(13)||CHR(10)||'-> '||CHR(13)||CHR(10)||'기타사항 : '||CHR(13)||CHR(10)||'-> ') AS RMK	         , A.CMPT_RMK AS CMPT_RMK	         , UFN_FORMAT(A.INS_YMD,'DATE') AS INS_YMD			 , (SELECT MAX(CASE RANK				             WHEN 'A' THEN '사장'				             WHEN 'B' THEN '전무'				             WHEN 'C' THEN '상무'				             WHEN 'D' THEN '이사'				             WHEN 'E' THEN '부장'				             WHEN 'F' THEN '차장'				             WHEN 'G' THEN '과장'				             WHEN 'H' THEN '대리'				             WHEN 'I' THEN '계장'				             WHEN 'J' THEN '주임'				             WHEN 'K' THEN '사원'				             WHEN 'L' THEN '책임'				             WHEN 'M' THEN '선임'				             ELSE RANK				        END)			      FROM CRM_CUST_PIC 			   WHERE CUST_CD = A.CUST_CD AND PIC_NM = A.REQ_USR) AS RANK_NM      	         			 , A.SAVE_CNT			 , W.RANK			 , W.RMK AS DEV_RMK			 , A.SHARE_YN			 , A.DEV_ERR_YN			 , A.DEV_ERR_NM			 , A.WORK_USR AS HELP_WORK_USR			 , W.RANK1			 , W.RANK2			 , W.RANK3			 , W.RANK4			 , W.RANK5			 , W.RANK6			 , W.RANK7			 , W.RANK8			 , W.RANK9			 , W.RANK10			 , W.RANK11			 , W.RANK12			 , W.RANK13			 , W.RANK14			 , W.RANK15			 , W.RANK16			 , W.RANK17			 , W.QC_TEST_YN			 , W.QC_TESTER			 , A.PGM_MDF AS PGM_MDF			 , W.DEV_SCORE			 , W.DEV_SCORE_RMK		  FROM CRM_AS_MST A		     , CRM_CUST_MST B		     , CRM_AS_MST_WORK W             , CRM_AS_CUST E		 WHERE 1=1 		   AND A.CUST_CD = B.CUST_CD		   AND A.MNGT_NO = W.MNGT_NO           AND A.MNGT_NO = E.MNGT_NO(+)		   AND A.MNGT_NO = '@MNGT_NO'  		   AND W.USR_ID = '@USR_ID'		   AND W.SEQ = @SEQ		   AND W.SEQ <> 0   ) A
#CrmAsMgtDev@SearchInsertUser
--CrmAsMgtDev@SearchInsertUserSELECT INS_USR AS USR_ID        ,  ( SELECT MAX(LOC_NM)               FROM CRM_USR_MST              WHERE LOC_NM =  A.INS_USR ) AS LOC_NM                ,'@FLAG' AS FLAGFROM CRM_AS_MST AWHERE MNGT_NO = '@MNGT_NO'
#CrmAsMgtDev@SearchReq
-- CrmAsMgtDev@SearchReqSELECT DISTINCT A.*               , CASE WHEN A.RMK IS NULL                      THEN A.CONTENT2                     ELSE A.CONTENT2||CHR(13)||CHR(10)||'※ 고객지원팀 요청 ※'||CHR(13)||CHR(10)||A.RMK                END AS CONTENT       FROM (    SELECT A.MNGT_NO         , A.PRIORITY         , A.CUST_CD         , B.CUST_LOC_NM AS CUST_NM         , UFN_FORMAT(A.REQ_YMD,'DATE')||' '||UFN_FORMAT(A.REQ_HM,'TIME') AS REQ_YMD--         , UFN_FORMAT(A.REQ_HM,'TIME') AS REQ_HM--         , A.REQ_YMD||A.REQ_HM AS SORT         , A.REQ_USR          , A.TEL_NO         , ((SELECT '제목:'||TRIM(Z.SUBJECT)||CHR(13)||CHR(10)||'내용:' FROM CRM_AS_CUST Z WHERE Z.MNGT_NO = A.MNGT_NO AND NOT Z.SUBJECT IS NULL)||A.CONTENT) AS CONTENT2         , A.RMK--         , CASE WHEN A.ASSIGN_YN = 'N' THEN '0' ELSE A.PROC_TYPE END AS PROC_TYPE          , A.INS_USR          , CASE WHEN A.SYS_ID = 'CRM'                THEN (SELECT Z.LOC_NM FROM  CRM_USR_MST Z WHERE Z.USR_ID = A.INS_USR)                ELSE (SELECT MAX(Y.LOC_NM) FROM CRM_AS_MST_WORK X, CRM_USR_MST Y WHERE X.MNGT_NO = A.MNGT_NO AND X.USR_ID = Y.USR_ID AND X.SEQ = 0)            END AS INS_USR_NM         , A.REQ_SVC         , A.SYS_ID --         , CASE WHEN A.SYS_ID = 'ELVIS' THEN '고객' ELSE 'CRM' END AS SYS_NM--         , UFN_FORMAT(A.INS_YMD,'DATE') AS INS_YMD          , A.EXCEPT_YN         , (SELECT MAX(CASE RANK                         WHEN 'A' THEN '사장'                         WHEN 'B' THEN '전무'                         WHEN 'C' THEN '상무'                         WHEN 'D' THEN '이사'                         WHEN 'E' THEN '부장'                         WHEN 'F' THEN '차장'                         WHEN 'G' THEN '과장'                         WHEN 'H' THEN '대리'                         WHEN 'I' THEN '계장'                         WHEN 'J' THEN '주임'                         WHEN 'K' THEN '사원'                         WHEN 'L' THEN '책임'                         WHEN 'M' THEN '선임'                         ELSE RANK                    END)              FROM CRM_CUST_PIC            WHERE CUST_CD = A.CUST_CD AND PIC_NM = A.REQ_USR) AS RANK_NM      --         , B.DEV_PIC           , A.WORK_USR--         , (SELECT LISTAGG (X.CD_NM, ',') WITHIN GROUP (ORDER BY X.CD_NM) --              FROM CRM_CUST_SVC Z--                   INNER JOIN MDM_COM_CODE X--                      ON Z.SVC_CD = X.COMN_CD--                     AND X.GRP_CD = 'C01'--             WHERE Z.CUST_CD = A.CUST_CD--               AND Z.SVC_CD IS NOT NULL) AS SVC_CD	  FROM CRM_AS_MST A  	       INNER JOIN CRM_CUST_MST B                   ON A.CUST_CD = B.CUST_CD	 WHERE 1 = 1       --AND (A.REQ_YMD >= '@FM_YMD' AND A.REQ_YMD <= '@TO_YMD'  OR A.MNGT_NO IN ('YJITS2018100657','20180831101135077311','20180829145647898576','20180829140841817912','YJITS2018073814','YJITS2018073205','YJITS2018060872'))       AND A.REQ_YMD >= '@FM_YMD'        AND A.REQ_YMD <= '@TO_YMD'     [EXCEPT_LIST]       AND A.EXCEPT_YN = 'N'     [/EXCEPT_LIST]       AND NOT A.PROC_TYPE IN ('1','2','8')       AND EXISTS (SELECT '' FROM CRM_AS_MST_SHARE X WHERE X.MNGT_NO = A.MNGT_NO AND (X.DEPT_CD IN ('@DEPT_CD') AND X.EXCEPT_YN = 'N'))       AND NOT EXISTS (SELECT '' FROM CRM_AS_MST_WORK X WHERE X.MNGT_NO = A.MNGT_NO AND X.SEQ = 1)
     [MNGT_NO]
       AND A.MNGT_NO = '@SEARCH_KEY'
     [/MNGT_NO]    ) A ORDER BY A.REQ_YMD DESC 
#CrmAsMgtDev@SearchReq_20210413
-- CrmAsMgtDev@SearchReqWITH W_CRM_CUST_SVCAS(    SELECT A.CUST_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', B.CD_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS SVC_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', C.CD_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS DEPT_CD         , SUBSTR(            XMLAGG(                XMLELEMENT(COL ,',', A.SALES_NM) ORDER BY B.CD_NM).EXTRACT('//text()'            ).GETSTRINGVAL()           , 2) AS SALES_NM      FROM CRM_CUST_SVC A           INNER JOIN MDM_COM_CODE B                   ON A.SVC_CD = B.COMN_CD                  AND B.GRP_CD = 'C01'           INNER JOIN MDM_COM_CODE C                   ON A.DEPT_CD = C.COMN_CD                  AND C.GRP_CD = 'C03'     WHERE A.SVC_CD IS NOT NULL     GROUP BY A.CUST_CD )SELECT DISTINCT A.*               , CASE WHEN A.RMK IS NULL                      THEN A.CONTENT2                     ELSE A.CONTENT2||CHR(13)||CHR(10)||'※ 고객지원팀 요청 ※'||CHR(13)||CHR(10)||A.RMK                END AS CONTENT       FROM (	SELECT A.MNGT_NO         , A.CUST_CD         , B.CUST_LOC_NM AS CUST_NM         , UFN_FORMAT(A.REQ_YMD,'DATE')||' '||UFN_FORMAT(A.REQ_HM,'TIME') AS REQ_YMD         , UFN_FORMAT(A.REQ_HM,'TIME')  AS REQ_HM         , A.REQ_YMD||A.REQ_HM AS SORT         , A.REQ_USR          , A.TEL_NO         , (CASE WHEN E.SUBJECT IS NULL THEN A.CONTENT                 ELSE '제목:'||TRIM(E.SUBJECT)||CHR(13)||CHR(10)||'내용:'||A.CONTENT            END) AS CONTENT2         , A.RMK         , CASE WHEN A.ASSIGN_YN = 'N' THEN '0' ELSE A.PROC_TYPE END AS PROC_TYPE          , A.INS_USR          , CASE WHEN A.SYS_ID = 'CRM'                THEN C.LOC_NM                ELSE (SELECT MAX(Y.LOC_NM)                      FROM CRM_AS_MST_WORK X                         , CRM_USR_MST Y                     WHERE X.MNGT_NO = A.MNGT_NO                       AND X.USR_ID = Y.USR_ID                       AND X.SEQ = 0)            END AS INS_USR_NM         , A.REQ_SVC         , A.PRIORITY         , A.SYS_ID  	     , CASE WHEN A.SYS_ID = 'ELVIS' THEN '고객' ELSE 'CRM' END AS SYS_NM         , UFN_FORMAT(A.INS_YMD,'DATE') AS INS_YMD          , D.SVC_CD         , A.EXCEPT_YN		 , (SELECT MAX(CASE RANK		                WHEN 'A' THEN '사장'			             WHEN 'B' THEN '전무'			             WHEN 'C' THEN '상무'			             WHEN 'D' THEN '이사'			             WHEN 'E' THEN '부장'			             WHEN 'F' THEN '차장'			             WHEN 'G' THEN '과장'			             WHEN 'H' THEN '대리'			             WHEN 'I' THEN '계장'			             WHEN 'J' THEN '주임'			             WHEN 'K' THEN '사원'			             WHEN 'L' THEN '책임'			             WHEN 'M' THEN '선임'			             ELSE RANK			        END)		      FROM CRM_CUST_PIC 		   WHERE CUST_CD = A.CUST_CD AND PIC_NM = A.REQ_USR) AS RANK_NM      		 , B.DEV_PIC  		 , A.WORK_USR	  FROM CRM_AS_MST A  	       INNER JOIN CRM_CUST_MST B                   ON A.CUST_CD = B.CUST_CD	       LEFT OUTER JOIN CRM_USR_MST C	               ON A.INS_USR = C.USR_ID           LEFT OUTER JOIN CRM_AS_CUST E                   ON A.MNGT_NO = E.MNGT_NO           LEFT OUTER JOIN CRM_AS_MST_SHARE F                  ON A.MNGT_NO = F.MNGT_NO            LEFT OUTER JOIN W_CRM_CUST_SVC D                   ON A.CUST_CD = D.CUST_CD	 WHERE 1 = 1       --AND (A.REQ_YMD >= '@FM_YMD' AND A.REQ_YMD <= '@TO_YMD'  OR A.MNGT_NO IN ('YJITS2018100657','20180831101135077311','20180829145647898576','20180829140841817912','YJITS2018073814','YJITS2018073205','YJITS2018060872'))       AND A.REQ_YMD >= '@FM_YMD'        AND A.REQ_YMD <= '@TO_YMD'       [EXCEPT_LIST]           AND A.EXCEPT_YN = 'N'       [/EXCEPT_LIST]       AND NOT A.PROC_TYPE IN ('1','2','8')       AND (F.DEPT_CD = '@DEPT_CD' AND F.EXCEPT_YN = 'N')       AND NOT EXISTS (SELECT X.MNGT_NO FROM CRM_AS_MST_WORK X WHERE X.MNGT_NO = A.MNGT_NO AND X.SEQ = 1)    ) A ORDER BY A.SORT DESC 
#CrmAsMgtDev@SearchToUserID
--CrmAsMgtDev@SearchToUserIDSELECT USR_ID,LOC_NM, '@FLAG' AS FLAG  FROM CRM_USR_MST WHERE LOC_NM ='@LOC_NM'
#CrmAsMgtDev@SqlId
/*UPDATE CRM_AS_MST A   SET A.UPD_USR   = '@USR_ID'	 , A.UPD_YMD   = TO_CHAR(SYSDATE,'yyyyMMdd')	 , A.UPD_HM    = TO_CHAR(SYSDATE,'HH24MISS') 	-- , A.DEV_REQ_YMD  = '@DEV_REQ_YMD'	 --, A.DEV_REQ_HM   = '@DEV_REQ_HM'	 , A.DEV_CONTENT  = '@DEV_CONTENT'	 , A.DEV_PROC_TYPE = '@DEV_PROC_TYPE' 	 , A.DEV_PRAR_YMD  = '@DEV_PRAR_YMD'	 , A.DEV_CMPT_YMD  = '@DEV_CMPT_YMD'	 --, A.DEV_PRIORITY  = '@DEV_PRIORITY' 	 , A.DEV_TEST_CHK_YMD = '@DEV_TEST_CHK_YMD'	 , A.DEV_TEST_CMPT_YMD = '@DEV_TEST_CMPT_YMD' 	 	 , A.AS_TEST_CHK_YMD = '@AS_TEST_CHK_YMD'  WHERE MNGT_NO   = '@MNGT_NO' ;*/
#CrmAsMgtDev@Update
--CrmAsMgtDev@UpdateBEGIN  UPDATE CRM_AS_MST_WORK   SET PRAR_YMD = '@PRAR_YMD'  , CMPT_YMD = '@CMPT_YMD' , PROC_TYPE = '@PROC_TYPE'  , DEV_CONTENT = '@DEV_CONTENT' , TEST_REQ_YMD = '@TEST_REQ_YMD' , TEST_RESULT = '@TEST_RESULT'   , TEST_CMPT_YMD = '@TEST_CMPT_YMD'   , TEST_USR_ID	=  '@TEST_USR_ID' , REQ_SVC  ='@REQ_SVC' , REQ_SVC2 ='@REQ_SVC2' , REQ_SVC3 ='@REQ_SVC3' WHERE MNGT_NO   = '@MNGT_NO'   AND USR_ID = '@USR_ID'   AND SEQ = @SEQ;	UPDATE CRM_AS_MST	   SET DEV_CMPT_YMD = (		        	SELECT CASE WHEN  MIN(PROC_TYPE) IN ('3','4')			                    THEN TO_CHAR(SYSDATE,'YYYYMMDD')			                    ELSE ''			                    END  			          FROM CRM_AS_MST_WORK			        WHERE MNGT_NO= '@MNGT_NO')	WHERE MNGT_NO = '@MNGT_NO'; END ;
#CrmAsMgtDev@Update1
--CrmAsMgtDev@UpdateBEGIN UPDATE CRM_AS_MST   SET UPD_USR   = '@USR_ID'	 , UPD_YMD   = TO_CHAR(SYSDATE,'yyyyMMdd')	 , UPD_HM    = TO_CHAR(SYSDATE,'HH24MISS')	 , SAVE_CNT  = SAVE_CNT + 1	 [REQ_YMD], REQ_YMD   = '@REQ_YMD'[/REQ_YMD]	 [REQ_HM], REQ_HM    = '@REQ_HM'[/REQ_HM]	 [REQ_SVC], REQ_SVC   = '@REQ_SVC'[/REQ_SVC]	 [CUST_CD], CUST_CD   = '@CUST_CD'[/CUST_CD]	 [CONTENT], CONTENT   = '@CONTENT'[/CONTENT]	 [REQ_USR], REQ_USR   = '@REQ_USR'[/REQ_USR]	 [TEL_NO], TEL_NO    = '@TEL_NO'[/TEL_NO]	 [PROC_TYPE], PROC_TYPE = '@PROC_TYPE'[/PROC_TYPE]	 [REQ_TYPE], REQ_TYPE  = '@REQ_TYPE'[/REQ_TYPE]	 [PRIORITY], PRIORITY  = '@PRIORITY'[/PRIORITY]	 [WORK_USR], WORK_USR  = '@WORK_USR'[/WORK_USR]	 [PRAR_YMD], PRAR_YMD  = '@PRAR_YMD'[/PRAR_YMD]	 [CMPT_YMD], CMPT_YMD  = '@CMPT_YMD'[/CMPT_YMD]	 [RMK], RMK       = '@RMK'[/RMK]	 [CMPT_RMK], CMPT_RMK  = '@CMPT_RMK'[/CMPT_RMK]	 [FREE_YN], FREE_YN   = '@FREE_YN'[/FREE_YN] WHERE MNGT_NO   = '@MNGT_NO'   AND DEPT_CD = '@DEPT_CD';         END ;
#CrmAsMgtDev@Update2
--CrmAsMgtDev@Update2BEGIN 	 UPDATE CRM_AS_MST_WORK	     SET PRAR_YMD  = '@PRAR_YMD'  		--예정일자 	       [REQ_YMD], REQ_YMD  = '@REQ_YMD'[/REQ_YMD]	       [REQ_HM], REQ_HM = '@REQ_HM'[/REQ_HM]	       , CMPT_YMD  = '@CMPT_YMD'		--완료일자 	       , CMPT_HM = '@CMPT_HM'	       , PROC_TYPE = '@PROC_TYPE' 	       , REQ_SVC   ='@REQ_SVC'	       , REQ_SVC2  ='@REQ_SVC2'	       , REQ_SVC3  ='@REQ_SVC3'	       , RMK       ='@DEV_RMK'	       , RANK      ='@RANK'           , RANK1 = '@RANK1'           , RANK2 = '@RANK2'           , RANK3 = '@RANK3'           , RANK4 = '@RANK4'           , RANK5 = '@RANK5'           , RANK6 = '@RANK6'           , RANK7 = '@RANK7'           , RANK8 = '@RANK8'           , RANK9 = '@RANK9'           , RANK10 = '@RANK10'           , RANK11 = '@RANK11'           , RANK12 = '@RANK12'           , RANK13 = '@RANK13'           , RANK14 = '@RANK14'           , RANK15 = '@RANK15'           , RANK16 = '@RANK16'           , RANK17 = '@RANK17'           , QC_TEST_YN = '@QC_TEST_YN'           , QC_TESTER = '@QC_TESTER'           , DEV_SCORE = '@DEV_SCORE'           , DEV_SCORE_RMK = '@DEV_SCORE_RMK'	   WHERE MNGT_NO   = '@MNGT_NO'	     AND USR_ID = '@USR_ID' ;	  UPDATE CRM_AS_MST	     SET RMK = '@RMK'	       , SAVE_CNT  = SAVE_CNT + 1	       , DEV_CMPT_YMD = '@CMPT_YMD'	       , CMPT_RMK  = '@CMPT_RMK'	       , DEV_ERR_YN   ='@DEV_ERR_YN'	       , DEV_ERR_NM ='@DEV_ERR_NM'	       , SHARE_YN ='@SHARE_YN'	       , PGM_MDF = '@PGM_MDF'	   WHERE MNGT_NO = '@MNGT_NO';	  --처리중, 개발팀 공유완료, 공유자료 미생성시에만 온라인접수 건으로 업데이트      UPDATE CRM_AS_MST	A         SET A.ONLINE_YN = 'Y'           , A.PROC_TYPE = '7'       WHERE A.MNGT_NO = '@MNGT_NO'         AND A.PROC_TYPE IN ('7','1') --처리중 / 개발팀에서 완료 -> 공유완료 변경하는 경우 있음         AND '9' = '@PROC_TYPE' --개발팀 공유완료         AND NOT EXISTS (SELECT Z.MNGT_NO FROM CRM_AS_MST_WORK Z WHERE Z.MNGT_NO = A.MNGT_NO||'A');               --개발팀 완료시 메인자료도 완료처리      UPDATE CRM_AS_MST	A         SET A.PROC_TYPE = '1'            , A.ONLINE_YN = (CASE WHEN A.ONLINE_YN = 'Y' THEN 'A' ELSE A.ONLINE_YN END)       WHERE A.MNGT_NO = '@MNGT_NO'         AND A.PROC_TYPE IN ('7','1') --처리중         AND '1' = '@PROC_TYPE' --개발팀 완료         AND NOT EXISTS (SELECT Z.MNGT_NO FROM CRM_AS_MST_WORK Z WHERE Z.MNGT_NO = A.MNGT_NO||'A'); END ;
#CrmAsMgtDev@UpdateComplete
--CrmAsMgtDev@UpdateCompleteBEGIN       UPDATE CRM_AS_MST	A         SET A.ONLINE_YN = 'Y'       WHERE A.MNGT_NO = '@MNGT_NO'         AND A.PROC_TYPE = '7' --처리중         AND '9' = '@PROC_TYPE' --개발팀 공유완료         AND NOT EXISTS (SELECT Z.MNGT_NO FROM CRM_AS_MST_WORK Z WHERE Z.MNGT_NO = A.MNGT_NO||'A');END ;
#CrmAsMgtDev@UpdateMergeWorkUsr
--CrmAsMgtDev@UpdateMergeWorkUsr  MERGE INTO  CRM_AS_MST_WORK W        USING ( SELECT '@MNGT_NO' AS MNGT_NO                      ,'@USR_ID' AS USR_ID                       , 0 AS SEQ                      , ( SELECT DEPT_CD                            FROM CRM_USR_MST                           WHERE USR_ID = '@USR_ID') AS DEPT_CD                      , '@SSN_USR_ID' AS SSN_USR_ID                      , TO_CHAR(SYSDATE,'yyyyMMdd') AS USR_YMD                      , TO_CHAR(SYSDATE,'HH24MISS') AS USR_HM                 FROM DUAL )  A     ON (    W.MNGT_NO = A.MNGT_NO         AND W.SEQ = A.SEQ )WHEN MATCHED THEN     UPDATE SET W.USR_ID = A.USR_ID, W.DEPT_CD = A.DEPT_CD               , W.UPD_USR = A.SSN_USR_ID, W.UPD_YMD = A.USR_YMD, W.UPD_HM = A.USR_HMWHEN NOT MATCHED THEN     INSERT (W.MNGT_NO ,W.SEQ, W.USR_ID, W.DEPT_CD, INS_USR, INS_YMD, INS_HM, UPD_USR, UPD_YMD, UPD_HM)     VALUES (A.MNGT_NO ,A.SEQ, A.USR_ID, A.DEPT_CD, A.SSN_USR_ID, A.USR_YMD, A.USR_HM, A.SSN_USR_ID, A.USR_YMD, A.USR_HM)                
#CrmAsMgtDev@UpdateMergeWorkUsr2
--CrmAsMgtDev@UpdateMergeWorkUsr2BEGIN     MERGE INTO CRM_AS_MST_WORK W        USING ( SELECT '@MNGT_NO' AS MNGT_NO                     , '@USR_ID' AS USR_ID                      , 1 AS SEQ                     , ( SELECT DEPT_CD                           FROM CRM_USR_MST                          WHERE USR_ID = '@USR_ID') AS DEPT_CD                     , '@SSN_USR_ID' AS SSN_USR_ID                     , TO_CHAR(SYSDATE,'yyyyMMdd') AS USR_YMD                     , TO_CHAR(SYSDATE,'HH24MISS') AS USR_HM                 FROM DUAL )  A     ON ( W.MNGT_NO = A.MNGT_NO AND W.SEQ = A.SEQ )   WHEN MATCHED THEN        UPDATE SET W.USR_ID = A.USR_ID, W.DEPT_CD = A.DEPT_CD                   , W.UPD_USR = A.SSN_USR_ID, W.UPD_YMD = A.USR_YMD, W.UPD_HM = A.USR_HM   WHEN NOT MATCHED THEN	    INSERT (W.MNGT_NO ,W.SEQ, W.USR_ID, W.DEPT_CD, INS_USR, INS_YMD, INS_HM, UPD_USR, UPD_YMD, UPD_HM)	    VALUES (A.MNGT_NO ,A.SEQ, A.USR_ID, A.DEPT_CD, A.SSN_USR_ID, A.USR_YMD, A.USR_HM, A.SSN_USR_ID, A.USR_YMD, A.USR_HM);       END ;
